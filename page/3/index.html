<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="You think you can, you can.">
<meta property="og:type" content="website">
<meta property="og:title" content="向山看海">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="向山看海">
<meta property="og:description" content="You think you can, you can.">
<meta property="og:locale">
<meta property="article:author" content="qiantu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>向山看海</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">向山看海</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-zjump">

    <a href="/zjump/" rel="section"><i class="fa fa-zjump fa-fw"></i>zjump</a>

  </li>
        <li class="menu-item menu-item-envmanage">

    <a href="/envmanage/" rel="section"><i class="fa fa-envmanage fa-fw"></i>envmanage</a>

  </li>
        <li class="menu-item menu-item-nginxadmin">

    <a href="/nginxadmin/" rel="section"><i class="fa fa-nginxadmin fa-fw"></i>nginxadmin</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-archives fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-zjump fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-about fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-books">

    <a href="/books/" rel="section"><i class="fa fa-books fa-fw"></i>books</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/python/python%E5%AE%9E%E7%8E%B0websocket,%E5%AE%9E%E6%97%B6%E6%98%BE%E7%A4%BA%E6%97%A5%E5%BF%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/python/python%E5%AE%9E%E7%8E%B0websocket,%E5%AE%9E%E6%97%B6%E6%98%BE%E7%A4%BA%E6%97%A5%E5%BF%97/" class="post-title-link" itemprop="url">使用python简单的实现websocket服务器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/websocket/" itemprop="url" rel="index"><span itemprop="name">websocket</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<h4 id="一、开始的话"><a href="#一、开始的话" class="headerlink" title="一、开始的话"></a>一、开始的话</h4><p>使用python简单的实现websocket服务器，可以在浏览器上实时显示远程服务器的日志信息。<br>之前做了一个web版的发布系统，但没实现在线看日志，每次发布版本后，都需要登录到服务器上查看日志，非常麻烦，为了偷懒，能在页面点几下按钮完成工作，所以这几天查找了这方面的资料，实现了这个功能，瞬间觉的看日志什么的，太方便了，以后也可以给开发们查日志，再也不用麻烦运维了，废话少说，先看效果吧。<br>[图片]</p>
<h4 id="二、代码"><a href="#二、代码" class="headerlink" title="二、代码"></a>二、代码</h4><p>在实现这功能前，看过别人的代码，发现很多都是只能在web上显示本地的日志，不能看远程主机上的日志，有些能看远程日志的是引用了其他框架（例如bottle，tornado）来实现的，而且所有这些都是重写thread的run方法来实现的，由于本人技术太菜，不知道怎么改成自己需要的样子，而且我是用django这个web框架的，不想引用太多框架，搞的太复杂，所以用python来实现websocket服务器。由于技术问题，代码有点粗糙，不过能实现功能就行，先将就着用吧。<br>执行下面命令启动django和websocketserver<br>    nohup python manage.py runserver 10.1.12.110 &amp;<br>    nohup python websocketserver.py &amp;</p>
<h4 id="启动websocket后，接收到请求，起一个线程和客户端握手，然后根据客户端发送的ip和type，去数据库查找对应的日志路径，用paramiko模块ssh登录到远程服务器上tail查看日志，再推送给浏览器，服务端完整代码如下："><a href="#启动websocket后，接收到请求，起一个线程和客户端握手，然后根据客户端发送的ip和type，去数据库查找对应的日志路径，用paramiko模块ssh登录到远程服务器上tail查看日志，再推送给浏览器，服务端完整代码如下：" class="headerlink" title="启动websocket后，接收到请求，起一个线程和客户端握手，然后根据客户端发送的ip和type，去数据库查找对应的日志路径，用paramiko模块ssh登录到远程服务器上tail查看日志，再推送给浏览器，服务端完整代码如下："></a>启动websocket后，接收到请求，起一个线程和客户端握手，然后根据客户端发送的ip和type，去数据库查找对应的日志路径，用paramiko模块ssh登录到远程服务器上tail查看日志，再推送给浏览器，服务端完整代码如下：</h4><pre><code># coding:utf-8
import struct
import base64
import hashlib
import socket
import threading
from public.public import get_ssh
import os


def recv_data(conn):    # 服务器解析浏览器发送的信息
    try:
        all_data = conn.recv(1024)
        if not len(all_data):
            return False
    except:
        pass
    else:
        code_len = ord(all_data[1]) &amp; 127
        if code_len == 126:
            masks = all_data[4:8]
            data = all_data[8:]
        elif code_len == 127:
            masks = all_data[10:14]
            data = all_data[14:]
        else:
            masks = all_data[2:6]
            data = all_data[6:]
        raw_str = &quot;&quot;
        i = 0
        for d in data:
            raw_str += chr(ord(d) ^ ord(masks[i % 4]))
            i += 1
        return raw_str


def send_data(conn, data):   # 服务器处理发送给浏览器的信息
    if data:
        data = str(data)
    else:
        return False
    token = &quot;\x81&quot;
    length = len(data)
    if length &lt; 126:
        token += struct.pack(&quot;B&quot;, length)    # struct为Python中处理二进制数的模块，二进制流为C，或网络流的形式。
    elif length &lt;= 0xFFFF:
        token += struct.pack(&quot;!BH&quot;, 126, length)
    else:
        token += struct.pack(&quot;!BQ&quot;, 127, length)
    data = &#39;%s%s&#39; % (token, data)
    conn.send(data)
    return True


def handshake(conn, address, thread_name):
    headers = &#123;&#125;
    shake = conn.recv(1024)
    if not len(shake):
        return False

    print (&#39;%s : Socket start handshaken with %s:%s&#39; % (thread_name, address[0], address[1]))
    header, data = shake.split(&#39;\r\n\r\n&#39;, 1)
    for line in header.split(&#39;\r\n&#39;)[1:]:
        key, value = line.split(&#39;: &#39;, 1)
        headers[key] = value

    if &#39;Sec-WebSocket-Key&#39; not in headers:
        print (&#39;%s : This socket is not websocket, client close.&#39; % thread_name)
        conn.close()
        return False

    MAGIC_STRING = &#39;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&#39;
    HANDSHAKE_STRING = &quot;HTTP/1.1 101 Switching Protocols\r\n&quot; \
                    &quot;Upgrade:websocket\r\n&quot; \
                    &quot;Connection: Upgrade\r\n&quot; \
                    &quot;Sec-WebSocket-Accept: &#123;1&#125;\r\n&quot; \
                    &quot;WebSocket-Origin: &#123;2&#125;\r\n&quot; \
                    &quot;WebSocket-Location: ws://&#123;3&#125;/\r\n\r\n&quot;

    sec_key = headers[&#39;Sec-WebSocket-Key&#39;]
    res_key = base64.b64encode(hashlib.sha1(sec_key + MAGIC_STRING).digest())
    str_handshake = HANDSHAKE_STRING.replace(&#39;&#123;1&#125;&#39;, res_key).replace(&#39;&#123;2&#125;&#39;, headers[&#39;Origin&#39;]).replace(&#39;&#123;3&#125;&#39;, headers[&#39;Host&#39;])
    conn.send(str_handshake)
    print (&#39;%s : Socket handshaken with %s:%s success&#39; % (thread_name, address[0], address[1]))
    print &#39;Start transmitting data...&#39;
    print &#39;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - -&#39;
    return True


def dojob(conn, address, thread_name):
    from mode import models
    handshake(conn, address, thread_name)     # 握手
    log_info = recv_data(conn)
    log_ip = log_info.split(&quot;:&quot;)[0]
    log_type = log_info.split(&quot;:&quot;)[1]

    auth_ = models.Authentication.objects.get(ip=log_ip)
    user = auth_.a_user
    pwd = auth_.a_password
    try:
        log_path = models.LogPath.objects.get(ip=log_ip, type_name__contains=log_type).log_path
    except Exception, e:
        send_data(conn, e)
        conn.close()
        print &quot;Error:&quot; + str(e)
        print (&#39;%s : Socket close with %s:%s&#39; % (thread_name, address[0], address[1]))
        return
    conn.setblocking(0)                       # 设置socket为非阻塞
    ssh = get_ssh(log_ip, user, pwd)
    ssh_t = ssh.get_transport()
    chan = ssh_t.open_session()
    chan.setblocking(0)   # 设置非阻塞
    chan.exec_command(&#39;tail -f %s&#39; % log_path)
    while True:
        clientdata = recv_data(conn)
        if clientdata is not None and &#39;quit&#39; in clientdata:
            print (&#39;%s : Socket close with %s:%s&#39; % (thread_name, address[0], address[1]))
            send_data(conn, &#39;close connect&#39;)
            conn.close()
            break
        while True:
            while chan.recv_ready():
                clientdata1 = recv_data(conn)
                if clientdata1 is not None and &#39;quit&#39; in clientdata1:
                    print (&#39;%s : Socket close with %s:%s&#39; % (thread_name, address[0], address[1]))
                    send_data(conn, &#39;close connect&#39;)
                    conn.close()
                    break
                log_msg = chan.recv(10000).strip()
                print log_msg
                send_data(conn, log_msg)
            if chan.exit_status_ready():
                break
            clientdata2 = recv_data(conn)
            if clientdata2 is not None and &#39;quit&#39; in clientdata2:
                print (&#39;%s : Socket close with %s:%s&#39; % (thread_name, address[0], address[1]))
                send_data(conn, &#39;close connect&#39;)
                conn.close()
                break
        break


def ws_service():

    os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;lbg.settings&quot;)
    index = 1
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.bind((&quot;127.0.0.1&quot;, 12345))
    sock.listen(100)

    print (&#39;\r\n\r\nWebsocket server start, wait for connect!&#39;)
    print &#39;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - -&#39;
    while True:
        connection, address = sock.accept()
        thread_name = &#39;thread_%s&#39; % index
        print (&#39;%s : Connection from %s:%s&#39; % (thread_name, address[0], address[1]))
        t = threading.Thread(target=dojob, args=(connection, address, thread_name))
        t.start()
        index += 1


ws_service()
</code></pre>
<h4 id="get-ssh的代码如下："><a href="#get-ssh的代码如下：" class="headerlink" title="get_ssh的代码如下："></a>get_ssh的代码如下：</h4><pre><code>import paramiko
def get_ssh(ip, user, pwd):
    try:
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        ssh.connect(ip, 22, user, pwd, timeout=15)
        return ssh
    except Exception, e:
        print e
        return &quot;False&quot;
</code></pre>
<h4 id="打开页面时，自动连接websocket服务器，完成握手，并发送ip和type给服务端，所以可以看不同类型，不同机器上的日志，"><a href="#打开页面时，自动连接websocket服务器，完成握手，并发送ip和type给服务端，所以可以看不同类型，不同机器上的日志，" class="headerlink" title="打开页面时，自动连接websocket服务器，完成握手，并发送ip和type给服务端，所以可以看不同类型，不同机器上的日志，"></a>打开页面时，自动连接websocket服务器，完成握手，并发送ip和type给服务端，所以可以看不同类型，不同机器上的日志，</h4><p>图片</p>
<h4 id="页面代码如下"><a href="#页面代码如下" class="headerlink" title="页面代码如下:"></a>页面代码如下:</h4><pre><code>&lt;!DOCTYPE html&gt;  
&lt;html&gt;  
&lt;head&gt;
&#123;% include 'head_script.html' %&#125;
&lt;style&gt;
    #log &#123;
        width: 440px;
        height: 200px;
        border: 1px solid #7F9DB9;
        overflow: auto;
    &#125;
    pre &#123;
        margin: 0 0 0;
        padding: 0;
        border: hidden;
        background-color: #0c0c0c;
        color: #00ff00;
    &#125;
    #btns &#123;
        text-align: right;   
    &#125;
&lt;/style&gt;
    &lt;script&gt;
        var socket;
        function init() &#123;  
            var host = &quot;ws://127.0.0.1:12345/&quot;;
            var ips=&quot;&#123;&#123; ip &#125;&#125;&quot;;
            var types=&quot;&#123;&#123; type &#125;&#125;&quot;;
            var log_msg = ips +&quot;:&quot;+ types;

            console.log(log_msg);
            try &#123;
                socket = new WebSocket(host);  
                socket.onopen = function () &#123;
                    log(&#39;Connected&#39;);
                    socket.send(log_msg);
                &#125;;  
                socket.onmessage = function (msg) &#123;  
                    log(msg.data);
                    var obje = document.getElementById(&quot;log&quot;);   //日志过多时清屏
                    var textlength = obje.scrollHeight;
                    if (textlength &gt; 10000) &#123;
                        obje.innerHTML = &#39;&#39;;
                    &#125;
                &#125;;  
                socket.onclose = function () &#123;
                    log(&quot;Lose Connection!&quot;);
                    $(&quot;#start&quot;).attr(&#39;disabled&#39;, false);
                    $(&quot;#stop&quot;).attr(&#39;disabled&#39;, true);
                &#125;;
                $(&quot;#start&quot;).attr(&#39;disabled&#39;, true);
                $(&quot;#stop&quot;).attr(&#39;disabled&#39;, false);
            &#125;
            catch (ex) &#123;  
                log(ex);  
            &#125;
        &#125;
        window.onbeforeunload = function () &#123;  
            try &#123;  
                socket.send(&#39;quit&#39;);  
                socket.close();  
                socket = null;  
            &#125;  
            catch (ex) &#123;  
                log(ex);  
            &#125;  
        &#125;;
        function log(msg) &#123;
            var obje = document.getElementById(&quot;log&quot;);
            obje.innerHTML += &#39;&lt;pre&gt;&lt;code&gt;&#39; + msg + &#39;&lt;/code&gt;&lt;/pre&gt;&#39;;
            obje.scrollTop = obje.scrollHeight;   //滚动条显示最新数据
        &#125;
        function stop() &#123;
            try &#123;
                log(&#39;Close connection!&#39;);
                socket.send(&#39;quit&#39;);
                socket.close();
                socket = null;
                $(&quot;#start&quot;).attr(&#39;disabled&#39;, false);
                $(&quot;#stop&quot;).attr(&#39;disabled&#39;, true);
            &#125;
            catch (ex) &#123;
                log(ex);
            &#125;
        &#125;
        function closelayer() &#123;
            try &#123;
                log(&#39;Close connection!&#39;);
                socket.send(&#39;quit&#39;);
                socket.close();
                socket = null;
            &#125;
            catch (ex) &#123;
                log(ex);
            &#125;
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
        &#125;
    &lt;/script&gt;
&lt;/head&gt;  

&lt;body onload=&quot;init()&quot;&gt;  
    &lt;div class=&quot;row&quot;&gt;
        &lt;div class=&quot;col-lg-12&quot;&gt;
            &lt;div id=&quot;log&quot; style=&quot;width: 100%;height:440px;background-color: #0c0c0c;overflow:scroll;overflow-x: auto;&quot;&gt;&lt;/div&gt;
            &lt;br&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;row&quot;&gt;
        &lt;div class=&quot;col-lg-12&quot;&gt;
            &lt;div id=&quot;btns&quot;&gt;
                &lt;input disabled=&quot;disabled&quot; type=&quot;button&quot; class=&quot;btn btn-primary btn-sm&quot; value=&quot;start&quot; id=&quot;start&quot; onclick=&quot;init()&quot;&gt;
                &lt;input disabled=&quot;disabled&quot; type=&quot;button&quot; class=&quot;btn btn-primary btn-sm&quot; value=&quot;stop&quot; id=&quot;stop&quot; onclick=&quot;stop()&quot; &gt;
                &lt;input type=&quot;button&quot; class=&quot;btn btn-primary btn-sm&quot; value=&quot;close&quot; id=&quot;close&quot; onclick=&quot;closelayer()&quot; &gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;  
&#123;% include 'foot_script.html' %&#125;
&lt;/html&gt; 
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/cloud/cloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/cloud/cloud/" class="post-title-link" itemprop="url">kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kvm/" itemprop="url" rel="index"><span itemprop="name">kvm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->


<h2 id="kvm虚拟化管理平台WebVirtMgr部署-完整记录-1"><a href="#kvm虚拟化管理平台WebVirtMgr部署-完整记录-1" class="headerlink" title="kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)"></a>kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)</h2><p>公司机房有一台2U的服务器（64G内存，32核），由于近期新增业务比较多，测试机也要新增，服务器资源十分有限。所以打算在这台2U服务器上部署kvm虚拟化，虚出多台VM出来，以应对新的测试需求。<br>当KVM宿主机越来越多，需要对宿主机的状态进行调控，决定采用WebVirtMgr作为kvm虚拟化的web管理工具，图形化的WEB，让人能更方便的查看kvm 宿主机的情况和操作<br>WebVirtMgr是近两年来发展较快，比较活跃，非常清新的一个KVM管理平台，提供对宿主机和虚机的统一管理，它有别于kvm自带的图形管理工具（virtual machine manager），让kvm管理变得更为可视化，对中小型kvm应用场景带来了更多方便。<br>WebVirtMgr采用几乎纯Python开发，其前端是基于Python的Django，后端是基于Libvirt的Python接口，将日常kvm的管理操作变的更加的可视化。</p>
<h2 id="WebVirtMgr特点"><a href="#WebVirtMgr特点" class="headerlink" title="WebVirtMgr特点"></a>WebVirtMgr特点</h2><p>操作简单，易于使用<br>通过libvirt的API接口对kvm进行管理<br>提供对虚拟机生命周期管理<br>WebVirtMgr 功能</p>
<h2 id="宿主机管理支持以下功能"><a href="#宿主机管理支持以下功能" class="headerlink" title="宿主机管理支持以下功能"></a>宿主机管理支持以下功能</h2><p>CPU利用率<br>内存利用率<br>网络资源池管理<br>存储资源池管理<br>虚拟机镜像<br>虚拟机克隆<br>快照管理<br>日志管理<br>虚机迁移  </p>
<h2 id="虚拟机管理支持以下功能"><a href="#虚拟机管理支持以下功能" class="headerlink" title="虚拟机管理支持以下功能"></a>虚拟机管理支持以下功能</h2><p>CPU利用率<br>内存利用率<br>光盘管理<br>关&#x2F;开&#x2F;暂停虚拟机<br>安装虚拟机<br>VNC console连接<br>创建快照  </p>
<h2 id="下面对部署过程进行记录，希望能帮助到有用到的朋友们。"><a href="#下面对部署过程进行记录，希望能帮助到有用到的朋友们。" class="headerlink" title="下面对部署过程进行记录，希望能帮助到有用到的朋友们。"></a>下面对部署过程进行记录，希望能帮助到有用到的朋友们。</h2><p>这里我将webvirtmgr服务器和kvm服务器放在同一台机器上部署的，即单机部署<br>系统：Centos 6.8<br>内存:64G<br>CPU:32核<br>ip：192.168.1.17（内网），111.101.186.163（外网）  </p>
<h2 id="一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装："><a href="#一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装：" class="headerlink" title="一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装："></a>一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装：</h2><p>kvm虚拟化管理平台WebVirtMgr部署-虚拟化环境安装-完整记录(0)  </p>
<h2 id="二、Kvm的管理工具webvirtmgr安装和使用"><a href="#二、Kvm的管理工具webvirtmgr安装和使用" class="headerlink" title="二、Kvm的管理工具webvirtmgr安装和使用"></a>二、Kvm的管理工具webvirtmgr安装和使用</h2><h3 id="1）安装支持的软件源"><a href="#1）安装支持的软件源" class="headerlink" title="1）安装支持的软件源"></a>1）安装支持的软件源</h3><p>[root@openstack ops]#yum -y install <a href="http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm">http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm</a>  </p>
<h3 id="2）安装相关软件"><a href="#2）安装相关软件" class="headerlink" title="2）安装相关软件"></a>2）安装相关软件</h3><hr>
<h2 id="如果报错说没有下面安装的某些软件，则下载http-pan-baidu-com-s-1bX3vkE-（密码：6ucs）将下载的yum-tar-gz解压后的文件替换到-etc-yum-repos-d目录下，然后执行yum-clean-all-yum-makecache"><a href="#如果报错说没有下面安装的某些软件，则下载http-pan-baidu-com-s-1bX3vkE-（密码：6ucs）将下载的yum-tar-gz解压后的文件替换到-etc-yum-repos-d目录下，然后执行yum-clean-all-yum-makecache" class="headerlink" title="如果报错说没有下面安装的某些软件，则下载http://pan.baidu.com/s/1bX3vkE （密码：6ucs）将下载的yum.tar.gz解压后的文件替换到&#x2F;etc&#x2F;yum.repos.d目录下，然后执行yum clean all &amp;&amp; yum makecache  "></a>如果报错说没有下面安装的某些软件，则下载<a href="http://pan.baidu.com/s/1bX3vkE">http://pan.baidu.com/s/1bX3vkE</a> （密码：6ucs）<br>将下载的yum.tar.gz解压后的文件替换到&#x2F;etc&#x2F;yum.repos.d目录下，然后执行yum clean all &amp;&amp; yum makecache  </h2><p>[root@openstack ops]#yum -y install git python-pip libvirt-python libxml2-python python-websockify supervisor nginx  </p>
<h3 id="3）从git-hub中下载相关的webvirtmgr代码"><a href="#3）从git-hub中下载相关的webvirtmgr代码" class="headerlink" title="3）从git-hub中下载相关的webvirtmgr代码"></a>3）从git-hub中下载相关的webvirtmgr代码</h3><p>[root@openstack ops]#cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;<br>[root@openstack src]#git clone git:&#x2F;&#x2F;github.com&#x2F;retspen&#x2F;webvirtmgr.git    （下载地址：<a href="https://pan.baidu.com/s/1pLS3kCj">https://pan.baidu.com/s/1pLS3kCj</a>      获取密码：8efm）</p>
<h3 id="4）安装webvirtmgr"><a href="#4）安装webvirtmgr" class="headerlink" title="4）安装webvirtmgr"></a>4）安装webvirtmgr</h3><p>[root@openstack src]#cd webvirtmgr&#x2F;<br>[root@openstack webvirtmgr]#pip install -r requirements.txt  </p>
<h3 id="5）安装数据库"><a href="#5）安装数据库" class="headerlink" title="5）安装数据库"></a>5）安装数据库</h3><p>[root@openstack webvirtmgr]#yum install python-sqlite2   </p>
<h3 id="6）对django进行环境配置"><a href="#6）对django进行环境配置" class="headerlink" title="6）对django进行环境配置"></a>6）对django进行环境配置</h3><p>[root@openstack webvirtmgr]#pwd<br>&#x2F;usr&#x2F;local&#x2F;src&#x2F;webvirtmgr<br>[root@openstack webvirtmgr]#.&#x2F;manage.py syncdb           &#x2F;&#x2F;默认是python执行，如下报错，换用其他版本的python  </p>
<hr>
<p>注意此处用默认的python执行上面命令，一般会报错，如下：<br>ImportError: No module named django.core.management   </p>
<h3 id="这个一般是由于python版本引起的，因为系统自带有好几个版本的python"><a href="#这个一般是由于python版本引起的，因为系统自带有好几个版本的python" class="headerlink" title="这个一般是由于python版本引起的，因为系统自带有好几个版本的python"></a>这个一般是由于python版本引起的，因为系统自带有好几个版本的python</h3><p>[root@openstack webvirtmgr]# python       &#x2F;&#x2F;按Tab键自查找<br>python python2.6<br>python2 python2.6-config python-config<br>[root@openstack webvirtmgr]# python -V<br>Python 2.6.6  </p>
<p>由此可看出，系统默认的Python版本是2.6.6<br>说明上面命令默认是python2.6执行的  </p>
<p>既然使用python2.6执行上面的命令报错，那就换用其他版本python2执行（如果当前是python3.3.0，那么就将下面的&#x2F;usr&#x2F;bin&#x2F;python2换成&#x2F;usr&#x2F;bin&#x2F;python2.6）<br>[root@openstack webvirtmgr]#&#x2F;usr&#x2F;bin&#x2F;python2 manage.py syncdb     &#x2F;&#x2F;最终发现使用python2执行这个命令就不报错了<br>…………<br>…………<br>You just installed Django’s auth system, which means you don’t have any superusers defined.<br>Would you like to create one now? (yes&#x2F;no): yes<br>Username (leave blank to use ‘root’): admin<br>Email address: <a href="mailto:&#119;&#x61;&#x6e;&#x67;&#115;&#x68;&#105;&#x62;&#111;&#64;&#49;&#x36;&#x33;&#x2e;&#x63;&#111;&#x6d;">&#119;&#x61;&#x6e;&#x67;&#115;&#x68;&#105;&#x62;&#111;&#64;&#49;&#x36;&#x33;&#x2e;&#x63;&#111;&#x6d;</a><br>Password:*********<br>Password (again):*********  </p>
<hr>
<p>[root@openstack webvirtmgr]#&#x2F;usr&#x2F;bin&#x2F;python2 manage.py collectstatic          &#x2F;&#x2F;生成配置文件（同样使用python2版本执行，不要使用默认的python执行）<br>WARNING:root:No local_settings file found.</p>
<p>You have requested to collect static files at the destination<br>location as specified in your settings.</p>
<p>This will overwrite existing files!<br>Are you sure you want to do this?</p>
<p>Type ‘yes’ to continue, or ‘no’ to cancel: yes<br>……….<br>……….</p>
<p>[root@openstack webvirtmgr]#&#x2F;usr&#x2F;bin&#x2F;python2 manage.py createsuperuser  &#x2F;&#x2F;添加管理员账号（同样使用python2版本执行，不要使用默认的python执行）<br>WARNING:root:No local_settings file found.<br>Username: ops                                                   &#x2F;&#x2F;这个是管理员账号，用上面的admin和这个管理员账号都可以登陆webvirtmgr的web界面管理平台<br>Email address: <a href="mailto:&#x77;&#x61;&#x6e;&#x67;&#115;&#104;&#105;&#x62;&#111;&#x40;&#49;&#x36;&#x33;&#x2e;&#99;&#x6f;&#x6d;">&#x77;&#x61;&#x6e;&#x67;&#115;&#104;&#105;&#x62;&#111;&#x40;&#49;&#x36;&#x33;&#x2e;&#99;&#x6f;&#x6d;</a><br>Password:<br>Password (again):<br>Superuser created successfully.</p>
<h2 id="7）拷贝web到-相关目录"><a href="#7）拷贝web到-相关目录" class="headerlink" title="7）拷贝web到 相关目录"></a>7）拷贝web到 相关目录</h2><p>[root@openstack ops]#mkdir -pv &#x2F;var&#x2F;www<br>[root@openstack ops]#cp -Rv &#x2F;usr&#x2F;local&#x2F;src&#x2F;webvirtmgr &#x2F;var&#x2F;www&#x2F;webvirtmgr</p>
<h2 id="8）设置ssh"><a href="#8）设置ssh" class="headerlink" title="8）设置ssh"></a>8）设置ssh</h2><p>[root@openstack ops]#ssh-keygen -r rsa             &#x2F;&#x2F;产生公私钥<br>[root@openstack ops]#ssh-copy-id 192.168.1.17        &#x2F;&#x2F;由于这里webvirtmgr和kvm服务部署在同一台机器，所以这里本地信任。如果kvm部署在其他机器，那么这个是它的ip<br>[root@openstack ops]#ssh 192.168.1.17 -L localhost:8000:localhost:8000 -L localhost:6080:localhost:60</p>
<h2 id="9）编辑nginx配置文件"><a href="#9）编辑nginx配置文件" class="headerlink" title="9）编辑nginx配置文件"></a>9）编辑nginx配置文件</h2><p>提前确保&#x2F;etc&#x2F;nginx&#x2F;nginx.conf文件里开启了“include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;”</p>
<p>[root@openstack ops]#vim &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;webvirtmgr.conf           &#x2F;&#x2F;添加下面内容到文件中<br>server {<br>listen 80 default_server;</p>
<p>server_name $hostname;<br>#access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;webvirtmgr_access_log;</p>
<p>location &#x2F;static&#x2F; {<br>root &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;webvirtmgr; # or &#x2F;srv instead of &#x2F;var<br>expires max;<br>}</p>
<p>location &#x2F; {<br>proxy_pass <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000</a>;<br>proxy_set_header X-Real-IP $remote_addr;<br>proxy_set_header X-Forwarded-for $proxy_add_x_forwarded_for;<br>proxy_set_header Host $host:$server_port;<br>proxy_set_header X-Forwarded-Proto $remote_addr;<br>proxy_connect_timeout 600;<br>proxy_read_timeout 600;<br>proxy_send_timeout 600;<br>client_max_body_size 1024M; # Set higher depending on your needs<br>}<br>}</p>
<p>[root@openstack ops]#mv &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf.bak</p>
<h2 id="10）启动nginx"><a href="#10）启动nginx" class="headerlink" title="10）启动nginx"></a>10）启动nginx</h2><p>[root@openstack ops]#&#x2F;etc&#x2F;init.d&#x2F;nginx restart</p>
<h2 id="11）修改防火墙规则"><a href="#11）修改防火墙规则" class="headerlink" title="11）修改防火墙规则"></a>11）修改防火墙规则</h2><p>[root@ops ~]#vim &#x2F;etc&#x2F;sysconfig&#x2F;selinux<br>……<br>SELINUX&#x3D;disabled</p>
<p>[root@ops ~]#setenforce 0<br>setenforce: SELinux is disabled<br>[root@ops ~]#getenforce<br>Disabled</p>
<p>[root@openstack ops]#&#x2F;usr&#x2F;sbin&#x2F;setsebool httpd_can_network_connect true</p>
<h2 id="12）设置-supervisor-如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问"><a href="#12）设置-supervisor-如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问" class="headerlink" title="12）设置 supervisor (如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问)"></a>12）设置 supervisor (如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问)</h2><p>[root@openstack ops]#chown -R nginx:nginx &#x2F;var&#x2F;www&#x2F;webvirtmgr</p>
<p>[root@openstack ops]#vim &#x2F;etc&#x2F;supervisord.conf     &#x2F;&#x2F;在文件末尾添加,注意将默认的python改为python2，因为上面只有用这个版本执行才不报错！<br>[program:webvirtmgr]<br>command&#x3D;&#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;manage.py run_gunicorn -c &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py                     &#x2F;&#x2F;启动8000端口<br>directory&#x3D;&#x2F;var&#x2F;www&#x2F;webvirtmgr<br>autostart&#x3D;true<br>autorestart&#x3D;true<br>logfile&#x3D;&#x2F;var&#x2F;log&#x2F;supervisor&#x2F;webvirtmgr.log<br>log_stderr&#x3D;true<br>user&#x3D;nginx</p>
<p>[program:webvirtmgr-console]<br>command&#x3D;&#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;console&#x2F;webvirtmgr-console                               &#x2F;&#x2F;启动6080端口（这是控制台vnc端口）<br>directory&#x3D;&#x2F;var&#x2F;www&#x2F;webvirtmgr<br>autostart&#x3D;true<br>autorestart&#x3D;true<br>stdout_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;supervisor&#x2F;webvirtmgr-console.log<br>redirect_stderr&#x3D;true<br>user&#x3D;nginx<br>[root@openstack ops]#vim &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py    &#x2F;&#x2F;确保下面bind绑定的是本机的8000端口，这个在nginx配置中定义了，被代理的端口<br>bind &#x3D; ‘127.0.0.1:8000’</p>
<h2 id="13）设置开机启动"><a href="#13）设置开机启动" class="headerlink" title="13）设置开机启动"></a>13）设置开机启动</h2><p>[root@openstack ops]#chkconfig supervisord on<br>[root@openstack ops]#vim &#x2F;etc&#x2F;rc.local<br>&#x2F;usr&#x2F;sbin&#x2F;setsebool httpd_can_network_connect true</p>
<h2 id="14）启动进程"><a href="#14）启动进程" class="headerlink" title="14）启动进程"></a>14）启动进程</h2><p>[root@openstack ops]#&#x2F;etc&#x2F;init.d&#x2F;supervisord restart<br>15）查看进程<br>[root@openstack ops]#netstat -lnpt    &#x2F;&#x2F;即可以看到6080和8000已经启动<br>[root@openstack ops]# lsof -i:6080<br>COMMAND PID USER FD TYPE DEVICE SIZE&#x2F;OFF NODE NAME<br>python2 53476 nginx 3u IPv4 364124 0t0 TCP *:6080 (LISTEN)<br>[root@openstack ops]#lsof -i:8000</p>
<hr>
<p>一般来说，只要上面的supervisord服务启动了，8000和6080端口就起来了。<br>因为在&#x2F;etc&#x2F;supervisord.conf文件里配置了这两个端口的启动设置</p>
<h2 id="如果supervisord服务启动了，8000和6080端口还是没起来！那么就需要手动启动-etc-supervisord-conf文件里配置的这两个端口的启动命令，即：-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-manage-py-run-gunicorn-c-var-www-webvirtmgr-conf-gunicorn-conf-py-这个命令会一直在操作-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-console-webvirtmgr-console-这个命令会一直在操作-root-openstack-ops-etc-init-d-supervisord-restart-root-openstack-ops-lsof-i-8000-root-openstack-ops-lsof-i-6080"><a href="#如果supervisord服务启动了，8000和6080端口还是没起来！那么就需要手动启动-etc-supervisord-conf文件里配置的这两个端口的启动命令，即：-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-manage-py-run-gunicorn-c-var-www-webvirtmgr-conf-gunicorn-conf-py-这个命令会一直在操作-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-console-webvirtmgr-console-这个命令会一直在操作-root-openstack-ops-etc-init-d-supervisord-restart-root-openstack-ops-lsof-i-8000-root-openstack-ops-lsof-i-6080" class="headerlink" title="如果supervisord服务启动了，8000和6080端口还是没起来！那么就需要手动启动&#x2F;etc&#x2F;supervisord.conf文件里配置的这两个端口的启动命令，即：[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;manage.py run_gunicorn -c &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py       &#x2F;&#x2F;这个命令会一直在操作[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;console&#x2F;webvirtmgr-console                        &#x2F;&#x2F;这个命令会一直在操作[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;supervisord restart[root@openstack ops]# lsof -i:8000[root@openstack ops]# lsof -i:6080"></a>如果supervisord服务启动了，8000和6080端口还是没起来！<br>那么就需要手动启动&#x2F;etc&#x2F;supervisord.conf文件里配置的这两个端口的启动命令，即：<br>[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;manage.py run_gunicorn -c &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py       &#x2F;&#x2F;这个命令会一直在操作<br>[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;console&#x2F;webvirtmgr-console                        &#x2F;&#x2F;这个命令会一直在操作<br>[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;supervisord restart<br>[root@openstack ops]# lsof -i:8000<br>[root@openstack ops]# lsof -i:6080</h2><h2 id="16）web访问"><a href="#16）web访问" class="headerlink" title="16）web访问"></a>16）web访问</h2><p><a href="http://111.101.186.163/login/">http://111.101.186.163/login/</a></p>
<p>这里用超级管理员登陆，只有超级管理员登陆后才能看到“基础构架”窗口</p>
<p>普通用户登陆后，只能看到“WebVirtMgr”一个窗口</p>
<p>选择“SSH链接“，设置Label，IP，用户</p>
<p>注意：Label与IP要相同</p>
<p>打开后，有报错！看来在上面使用ssh连接的配置环节有误所致！</p>
<p>解决措施：</p>
<h2 id="1-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥"><a href="#1-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥" class="headerlink" title="1)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥"></a>1)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥</h2><p>[root@openstack ops]# cd &#x2F;home&#x2F;<br>[root@openstack home]# mkdir nginx<br>[root@openstack home]# chown nginx.nginx nginx&#x2F;<br>[root@openstack home]# chmod 700 nginx&#x2F; -R<br>[root@openstack home]# su - nginx -s &#x2F;bin&#x2F;bash<br>-bash-4.1$ ssh-keygen                             #期间输入yes后直接回车，回车<br>-bash-4.1$ touch ~&#x2F;.ssh&#x2F;config &amp;&amp; echo -e “StrictHostKeyChecking&#x3D;no\nUserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null” &gt;&gt; ~&#x2F;.ssh&#x2F;config<br>-bash-4.1$ chmod 0600 ~&#x2F;.ssh&#x2F;config</p>
<h2 id="2-在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户"><a href="#2-在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户" class="headerlink" title="2)在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户"></a>2)在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户</h2><hr>
<h2 id="如果采用其他用户，比如webvirtmgr，操作如下-root-openstack-ops-useradd-webvirtmgr-root-openstack-ops-echo-“123456”-passwd-–stdin-webvirtmgr-root-openstack-ops-groupadd-libvirt-root-openstack-ops-usermod-G-libvirt-a-webvirtmgr"><a href="#如果采用其他用户，比如webvirtmgr，操作如下-root-openstack-ops-useradd-webvirtmgr-root-openstack-ops-echo-“123456”-passwd-–stdin-webvirtmgr-root-openstack-ops-groupadd-libvirt-root-openstack-ops-usermod-G-libvirt-a-webvirtmgr" class="headerlink" title="如果采用其他用户，比如webvirtmgr，操作如下:[root@openstack ops]#useradd webvirtmgr[root@openstack ops]#echo “123456” | passwd –stdin webvirtmgr[root@openstack ops]#groupadd libvirt[root@openstack ops]#usermod -G libvirt -a webvirtmgr"></a>如果采用其他用户，比如webvirtmgr，操作如下:<br>[root@openstack ops]#useradd webvirtmgr<br>[root@openstack ops]#echo “123456” | passwd –stdin webvirtmgr<br>[root@openstack ops]#groupadd libvirt<br>[root@openstack ops]#usermod -G libvirt -a webvirtmgr</h2><h2 id="3-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）"><a href="#3-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）" class="headerlink" title="3)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）"></a>3)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）</h2><p>[root@openstack ops]# su - nginx -s &#x2F;bin&#x2F;bash<br>-bash-4.1$ ssh-copy-id <a href="mailto:&#114;&#x6f;&#x6f;&#116;&#x40;&#49;&#x39;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#49;&#x2e;&#x31;&#x37;">&#114;&#x6f;&#x6f;&#116;&#x40;&#49;&#x39;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#49;&#x2e;&#x31;&#x37;</a><br>Warning: Permanently added ‘192.168.1.17’ (RSA) to the list of known hosts.<br><a href="mailto:&#114;&#x6f;&#x6f;&#x74;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#56;&#46;&#x31;&#46;&#49;&#x37;">&#114;&#x6f;&#x6f;&#x74;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#56;&#46;&#x31;&#46;&#49;&#x37;</a>‘s password: #输入192.168.1.17即本机的root账号<br>Now try logging into the machine, with “ssh ‘<a href="mailto:&#x72;&#x6f;&#x6f;&#116;&#x40;&#49;&#x39;&#50;&#46;&#x31;&#54;&#x38;&#46;&#x31;&#x2e;&#49;&#55;">&#x72;&#x6f;&#x6f;&#116;&#x40;&#49;&#x39;&#50;&#46;&#x31;&#54;&#x38;&#46;&#x31;&#x2e;&#49;&#55;</a>‘“, and check in:</p>
<p>.ssh&#x2F;authorized_keys</p>
<h2 id="to-make-sure-we-haven’t-added-extra-keys-that-you-weren’t-expecting"><a href="#to-make-sure-we-haven’t-added-extra-keys-that-you-weren’t-expecting" class="headerlink" title="to make sure we haven’t added extra keys that you weren’t expecting."></a>to make sure we haven’t added extra keys that you weren’t expecting.</h2><h2 id="这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下-root-openstack-ops-su-nginx-s-bin-bash-bash-4-1-ssh-copy-id-x77-x65-98-x76-105-x72-116-109-103-x72-64-49-57-50-x2e-x31-x36-x38-46-48-46-50-51"><a href="#这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下-root-openstack-ops-su-nginx-s-bin-bash-bash-4-1-ssh-copy-id-x77-x65-98-x76-105-x72-116-109-103-x72-64-49-57-50-x2e-x31-x36-x38-46-48-46-50-51" class="headerlink" title="这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下:[root@openstack ops]#su - nginx -s &#x2F;bin&#x2F;bash-bash-4.1$ssh-copy-id &#x77;&#x65;&#98;&#x76;&#105;&#x72;&#116;&#109;&#103;&#x72;&#64;&#49;&#57;&#50;&#x2e;&#x31;&#x36;&#x38;&#46;&#48;&#46;&#50;&#51;"></a>这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下:<br>[root@openstack ops]#su - nginx -s &#x2F;bin&#x2F;bash<br>-bash-4.1$ssh-copy-id <a href="mailto:&#x77;&#x65;&#98;&#x76;&#105;&#x72;&#116;&#109;&#103;&#x72;&#64;&#49;&#57;&#50;&#x2e;&#x31;&#x36;&#x38;&#46;&#48;&#46;&#50;&#51;">&#x77;&#x65;&#98;&#x76;&#105;&#x72;&#116;&#109;&#103;&#x72;&#64;&#49;&#57;&#50;&#x2e;&#x31;&#x36;&#x38;&#46;&#48;&#46;&#50;&#51;</a></h2><h2 id="4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置-libvirt-ssh授权"><a href="#4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置-libvirt-ssh授权" class="headerlink" title="4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置 libvirt ssh授权"></a>4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置 libvirt ssh授权</h2><p>[root@openstack ops]# vim &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla<br>[Remote libvirt SSH access]<br>Identity&#x3D;unix-user:root #注意这里采用的是root用户<br>Action&#x3D;org.libvirt.unix.manage<br>ResultAny&#x3D;yes<br>ResultInactive&#x3D;yes<br>ResultActive&#x3D;yes</p>
<h2 id="root-openstack-ops-chown-R-root-root-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla"><a href="#root-openstack-ops-chown-R-root-root-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla" class="headerlink" title="[root@openstack ops]# chown -R root.root &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla"></a>[root@openstack ops]# chown -R root.root &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla</h2><p>这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下:<br>[root@openstack ops]#vim &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla<br>[Remote libvirt SSH access]<br>Identity&#x3D;unix-user:webvirtmgr #这里就设定webvirtmgr用户<br>Action&#x3D;org.libvirt.unix.manage<br>ResultAny&#x3D;yes<br>ResultInactive&#x3D;yes<br>ResultActive&#x3D;yes</p>
<h2 id="root-openstack-ops-chown-R-webvirtmgr-webvirtmgr-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla"><a href="#root-openstack-ops-chown-R-webvirtmgr-webvirtmgr-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla" class="headerlink" title="[root@openstack ops]#chown -R webvirtmgr.webvirtmgr &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla"></a>[root@openstack ops]#chown -R webvirtmgr.webvirtmgr &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla</h2><h2 id="5）重启-libvirtd-服务"><a href="#5）重启-libvirtd-服务" class="headerlink" title="5）重启 libvirtd 服务"></a>5）重启 libvirtd 服务</h2><p>&#x2F;etc&#x2F;init.d&#x2F;libvirtd restart</p>
<p>这样上面报错的问题就迎仍而解了！</p>
<p>然后重新ssh方式连接就ok了，就不会有上面那个报错了~</p>
<p>但是，又出现了其他报错（如下）！尼玛～～  接续排查！</p>
<p>解决措施：</p>
<p> 在WebVirtMgr服务器本地使用ssh方式连接，在终端命令行里：</p>
<p>[root@openstack .ssh]# virsh -c qemu+ssh:&#x2F;&#x2F;103.10.86.17&#x2F;system list<br>The authenticity of host ‘103.10.86.17 (103.10.86.17)’ can’t be established.<br>RSA key fingerprint is 3d:c1:2e:70:e9:e5:1d:84:40:a2:63:82:af:e5:cc:cd.<br>Are you sure you want to continue connecting (yes&#x2F;no)? yes<br>error: End of file while reading data: Warning: Permanently added ‘103.10.86.17’ (RSA) to the list of known hosts.: Input&#x2F;output error<br>error: failed to connect to the hypervisor</p>
<p>看日志 tail &#x2F;var&#x2F;log&#x2F;secure | grep sshd 发现是我这里主动发出断开的.有可能检测到libvirtd有些问题导致的。<br>当时使用virt-manage可以查询到远程的信息.估计是sshd出现的问题把.</p>
<p>折腾一会，暂时没找到解决方案</p>
<p>决定先选用通过tcp协议进行迁移的（但是这种方式没有用ssh连接方式安全——）<br>等后面有时间了，再想办法解决上面ssh方式连接的错误吧</p>
<p>使用tcp进行对远程libvirtd进行连接访问的配置如下：</p>
<p>1）修改文件&#x2F;etc&#x2F;sysconfig&#x2F;libvirtd，用来启用tcp的端口<br>[root@openstack ops]# cat &#x2F;etc&#x2F;sysconfig&#x2F;libvirtd<br>……..<br>LLIBVIRTD_CONFIG&#x3D;&#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>LIBVIRTD_ARGS&#x3D;”–listen”</p>
<p>2)修改文件&#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>[root@openstack ops]#vim &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>listen_tls &#x3D; 0<br>listen_tcp &#x3D; 1<br>tcp_port &#x3D; “16509”<br>listen_addr &#x3D; “0.0.0.0”<br>auth_tcp &#x3D; “none”</p>
<p>3)运行 libvirtd<br>[root@openstack ops]#service libvirtd restart</p>
<p>如果没起效果(我的就没有生效，那么使用命令行.如果生效了，执行下面命令就会报错<br>[root@openstack ops]#libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf</p>
<p>4)查看运行进程<br>[root@openstack ops]# ps aux | grep libvirtd<br>root 16563 1.5 0.1 925880 7056 ? Sl 16:01 0:28 libvirtd -d -l –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf</p>
<p>5)查看端口<br>[root@openstack ops]# lsof -i:16509</p>
<p>6）在source host连接dest host远程libvirtd查看信息（也可以用公网ip）<br>[root@openstack ops]# virsh -c qemu+tcp:&#x2F;&#x2F;192.168.1.17&#x2F;system<br>Welcome to virsh, the virtualization interactive terminal.</p>
<p>Type: ‘help’ for help with commands<br>‘quit’ to quit</p>
<p>virsh #</p>
<p>成功使用tcp去访问libvirtd。</p>
<p>注意：</p>
<p>在使用tcp方式连接后，会出现连接终端的情况！</p>
<p>[root@openstack .ssh]# virsh -c qemu+tcp:&#x2F;&#x2F;192.168.1.17&#x2F;system<br>error: Cannot recv data: Connection reset by peer<br>error: failed to connect to the hypervisor</p>
<p>连接断开，重新连接便可。</p>
<p>[root@openstack ops]# ps aux | grep libvirtd<br>root 59619 0.6 0.0 1008128 22048 ? Sl 19:17 0:06 libvirtd –daemon –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf –listen<br>root 61081 0.0 0.0 103316 1004 pts&#x2F;2 S+ 19:33 0:00 grep –color libvirtd<br>[root@openstack ops]# kill -9 59619<br>[root@openstack ops]# ps aux | grep libvirtd<br>root 61083 0.0 0.0 103312 904 pts&#x2F;2 S+ 19:33 0:00 grep –color libvirtd<br>[root@openstack ops]# libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>[root@openstack ops]# ps aux | grep libvirtd<br>root 61086 13.5 0.0 418240 6576 ? Sl 19:33 0:00 libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>root 61176 0.0 0.0 103312 908 pts&#x2F;2 S+ 19:33 0:00 grep –color libvirtd<br>[root@openstack ops]# virsh -c qemu+tcp:&#x2F;&#x2F;192.168.1.17&#x2F;system<br>Welcome to virsh, the virtualization interactive terminal.</p>
<p>Type: ‘help’ for help with commands<br>‘quit’ to quit</p>
<p>virsh #</p>
<p>后续发现，webvirtmgr连上后，过一会儿就会断开！</p>
<p>针对这个情况，可以可以写个定时脚本，如下：</p>
<p>[root@openstack ops]# cat &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh</p>
<p>#!&#x2F;bin&#x2F;bash<br>ps -ef | grep “libvirtd –daemon –listen”|grep -v grep|awk -F” “ ‘{print $2}’|xargs kill -9<br>&#x2F;usr&#x2F;sbin&#x2F;libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf</p>
<p>[root@openstack ops]# crontab -l</p>
<ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 10;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 20;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 30;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 40;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 50;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p>一般如上配置后，webvirtmgr里的控制台是可以正常连接虚拟机的。</p>
<p>但如果webvirtmgr里通过控制台页面(vnc)连接虚拟机失败，可以按照下面的操作方法尝试解决：</p>
<p>kvm原来的安装方式是客户端需要安装vncviewer，才能看到安装页面，而webvirtmgr使用了novnc，页面通过websocket进行通信。</p>
<p>1）首先需要安装novnc<br>[root@openstack ops]# yum install -y novnc</p>
<p>2）防火墙打开vnc的6080端口<br>[root@openstack ops]# vim &#x2F;etc&#x2F;sysconfig&#x2F;iptables<br>…….<br>-A INPUT -p tcp -m state –state NEW -m tcp –dport 6080 -j ACCEPT<br>…….</p>
<p>[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;iptables restart</p>
<p>3）由上面可知，webvirtmgr进程通过supervisor管理。这里需要重启supervisor进程<br>[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;supervisord restart</p>
<p>这样，再次打开Webvirtmgr的控制台，发现就能连上虚拟机了！</p>
<hr>
<p>可以在webvirtmgr服务器上通过命令行尝试下连接：<br>[root@openstack ops]# novnc_server –help<br>Usage: novnc_server [–listen PORT] [–vnc VNC_HOST:PORT] [–cert CERT]</p>
<p>Starts the WebSockets proxy and a mini-webserver and<br>provides a cut-and-paste URL to go to.</p>
<p>–listen PORT Port for proxy&#x2F;webserver to listen on<br>Default: 6080<br>–vnc VNC_HOST:PORT VNC server host:port proxy target<br>Default: localhost:5900<br>–cert CERT Path to combined cert&#x2F;key file<br>Default: self.pem<br>–web WEB Path to web files (e.g. vnc.html)<br>Default: .&#x2F;</p>
<p>[root@openstack ops]# novnc_server –listen 192.168.1.17:6086           #端口在6080后的都可以用<br>Warning: could not find self.pem<br>Starting webserver and WebSockets proxy on port 192.168.1.17:6086<br>WARNING: no ‘numpy’ module, HyBi protocol will be slower<br>WebSocket server settings:</p>
<ul>
<li>Listen on 192.168.1.17:6086</li>
<li>Flash security policy server</li>
<li>Web server. Web root: &#x2F;usr&#x2F;share&#x2F;novnc</li>
<li>No SSL&#x2F;TLS support (no cert file)</li>
<li>proxying from 192.168.1.17:6086 to localhost:5900</li>
</ul>
<p>Navigate to this URL:</p>
<p><a href="http://kvm-server:192.168.1.17:6086/vnc.html?host=kvm-server&port=192.168.1.17:6086">http://kvm-server:192.168.1.17:6086/vnc.html?host=kvm-server&amp;port=192.168.1.17:6086</a></p>
<p>Press Ctrl-C to exit</p>
<hr>
<p><em><strong><strong><strong><strong><strong><strong><strong>当你发现自己的才华撑不起野心时，就请安静下来学习吧</strong></strong></strong></strong></strong></strong></strong></em></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/cloud/ceph%E8%BF%99%E6%AC%BE%E4%BA%91%E5%AD%98%E5%82%A8%E6%8A%80%E6%9C%AF%E6%80%8E%E4%B9%88%E6%A0%B7%EF%BC%9F%E5%92%8Cswift%E3%80%81hdfs%E7%9B%B8%E6%AF%94%E5%A6%82%E4%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/cloud/ceph%E8%BF%99%E6%AC%BE%E4%BA%91%E5%AD%98%E5%82%A8%E6%8A%80%E6%9C%AF%E6%80%8E%E4%B9%88%E6%A0%B7%EF%BC%9F%E5%92%8Cswift%E3%80%81hdfs%E7%9B%B8%E6%AF%94%E5%A6%82%E4%BD%95/" class="post-title-link" itemprop="url">ceph这款云存储技术怎么样？和swift、hdfs相比如何</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">分布式文件系统</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<p>Ceph是一套高性能，易扩展的，无单点的分布式文件存储系统，基于Sage A. Weil的论文开发，主要提供以下三个存储服务：</p>
<ul>
<li><blockquote>
<p>对象存储(Object Storage)，既可以通过使用Ceph的库，利用C, C++, Java, Python, PHP代码，也可以通过Restful网关以对象的形式访问或存储数据，兼容亚马逊的S3和OpenStack的Swift。</p>
</blockquote>
</li>
<li><blockquote>
<p>块存储(Block Storage)，作为块设备像硬盘一样直接挂载。</p>
</blockquote>
</li>
<li><blockquote>
<p>文件系统(File System) ，如同网络文件系统一样挂载，兼容POSIX接口。</p>
</blockquote>
</li>
</ul>
<p>Ceph的结构，对象存储由LIBRADOS和RADOSGW提供，块存储由RBD提供，文件系统由CEPH FS提供，而RADOSGW, RBD, CEPH FS均需要调用LIBRADOS的接口，而最终都是以对象的形式存储于RADOS里。</p>
<p>Ceph集群的节点有三种角色：</p>
<ul>
<li><blockquote>
<p>Monitor，监控集群的健康状况，向客户端发送最新的CRUSH map(含有当前网络的拓扑结构)</p>
</blockquote>
</li>
<li><blockquote>
<p>OSD，维护节点上的对象，响应客户端请求，与其他OSD节点同步</p>
</blockquote>
</li>
<li><blockquote>
<p>MDS，提供文件的Metadata，如果不使用CephFS可以不安装</p>
</blockquote>
</li>
</ul>
<p>Ceph是分布式的存储，它将文件分割后均匀随机地分散在各个节点上，Ceph采用了CRUSH算法来确定对象的存储位置，<br>只要有当前集群的拓扑结构，Ceph客户端就能直接计算出文件的存储位置，<br>直接跟OSD节点通信获取文件而不需要询问中心节点获得文件位置，这样就避免了单点风险。<br>更多Ceph架构方面的内容可以参看官方介绍：<br>ArchitectureCeph目前已经是一套比较成熟的存储系统了，<br>是OpenStack比较理想的存储后端，也可以作为Hadoop的存储后端，这就涉及到与Swift和HDFS的比较。</p>
<h3 id="Ceph与Swift"><a href="#Ceph与Swift" class="headerlink" title="Ceph与Swift"></a>Ceph与Swift</h3><p>Ceph用C++编写而Swift用Python编写，性能上应当是Ceph占优。<br>但是与Ceph不同，Swift专注于对象存储，作为OpenStack组件之一经过大量生产实践的验证，<br>与OpenStack结合很好，目前不少人使用Ceph为OpenStack提供块存储，但仍旧使用Swift提供对象存储。<br>Swift的开发者曾写过文章对比Ceph和Swift: Ceph and Swift: Why we are not fighting.</p>
<h3 id="Ceph与HDFS"><a href="#Ceph与HDFS" class="headerlink" title="Ceph与HDFS"></a>Ceph与HDFS</h3><p>Ceph对比HDFS优势在于易扩展，无单点。HDFS是专门为Hadoop这样的云计算而生，<br>在离线批量处理大数据上有先天的优势，而Ceph是一个通用的实时存储系统。<br>虽然Hadoop可以利用Ceph作为存储后端（根据Ceph官方的教程死活整合不了，自己写了个简洁的步骤:<a href="http://www.kai-zhang.com/cloud-computing/Running-Hadoop-on-CEPH/%EF%BC%89%EF%BC%8C">http://www.kai-zhang.com/cloud-computing/Running-Hadoop-on-CEPH/），</a><br>但执行计算任务上性能还是略逊于HDFS（时间上慢30%左右 Haceph: Scalable Meta- data Management for Hadoop using Ceph）。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/zabbix/zabbix3.2.1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/zabbix/zabbix3.2.1/" class="post-title-link" itemprop="url">zabbix3.2.1分布式监控，采用agent主动模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zabbix/" itemprop="url" rel="index"><span itemprop="name">zabbix</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<h1 id="zabbix3-2-1分布式监控，采用agent主动模式"><a href="#zabbix3-2-1分布式监控，采用agent主动模式" class="headerlink" title="zabbix3.2.1分布式监控，采用agent主动模式"></a>zabbix3.2.1分布式监控，采用agent主动模式</h1><p>有点：1、分布式，全部agent先提交到各个机房的zabbix_proxy，再有zabbix_proxy提交到到server，减少					zabbix_server压力</p>
<p>服务端 安装参考  Zabbix 3.2.0 yum或编译安装 on CentOS 7.note<br>配置制动注册让agent自动注册，免去一个个手动添加</p>
<p>proxy 安装参考 zabbix分布式监控proxy部署.note</p>
<p>cd &#x2F;root&#x2F;zabbix-3.2.1<br>.&#x2F;configure –prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;zabbix_agent –enable-agent<br> make install<br>修改 vim &#x2F;usr&#x2F;local&#x2F;zabbix_agent&#x2F;etc&#x2F;zabbix_agentd.conf<br>#Server 写proxy的ip<br>Server&#x3D;172.16.1.198 </p>
<p>useradd zabbix<br>&#x2F;usr&#x2F;local&#x2F;zabbix_agent&#x2F;sbin&#x2F;zabbix_agentd -c &#x2F;usr&#x2F;local&#x2F;zabbix_agent&#x2F;etc&#x2F;zabbix_agentd.conf</p>
<p>错误1 没发现host，如果是被动模式的话就是就是server上没配对应的host，但是我用的是主动模式，不需要手动添加，只要添加自动加host的action就行，我遇到的问题是这个action没启动，我记得是启用了得。不知道什么时候被禁用了！！！<br>[图片]<br>解决方法：<br>[图片]</p>
<p>测试方法：<br>[root@xs_proxy ~]# &#x2F;usr&#x2F;local&#x2F;zabbix&#x2F;bin&#x2F;zabbix_get -s 172.17.2.201 -p20050 -k”system.uptime”<br>16936953</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/cloud/k8s/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/cloud/k8s/" class="post-title-link" itemprop="url">Kubernetes 安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<h4 id="Kubernetes-Components"><a href="#Kubernetes-Components" class="headerlink" title="Kubernetes Components"></a>Kubernetes Components</h4><p>Kubernetes works in server-client setup, where it has a master providing centralized control for a number of minions. We will be deploying a Kubernetes master with three minions, as illustrated in the diagram further below.</p>
<p>Kubernetes has several components: </p>
<ul>
<li>etcd - A highly available key-value store for shared configuration and service discovery.</li>
<li>flannel - An etcd backed network fabric for containers.</li>
<li>kube-apiserver - Provides the API for Kubernetes orchestration.</li>
<li>kube-controller-manager - Enforces Kubernetes services.</li>
<li>kube-scheduler - Schedules containers on hosts.</li>
<li>kubelet - Processes a container manifest so the containers are launched according to how they are described.</li>
<li>kube-proxy - Provides network proxy services.</li>
</ul>
<h4 id="Deployment-on-CentOS-7"><a href="#Deployment-on-CentOS-7" class="headerlink" title="Deployment on CentOS 7"></a>Deployment on CentOS 7</h4><p>We will need 4 servers, running on CentOS 7.1 64 bit with minimal install. All components are available directly from the CentOS extras repository which is enabled by default. The following architecture diagram illustrates where the Kubernetes components should reside:</p>
<p><img src="http://note.youdao.com/favicon.ico" alt="image"></p>
<h4 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h4><ol>
<li><p>Disable iptables on each node to avoid conflicts with Docker iptables rules:</p>
<p> $ systemctl stop firewalld<br> $ systemctl disable firewalld</p>
</li>
<li><p>Install NTP and make sure it is enabled and running:</p>
<p> $ yum -y install ntp<br> $ systemctl start ntpd<br> $ systemctl enable ntpd</p>
</li>
</ol>
<h4 id="Setting-up-the-Kubernetes-Master"><a href="#Setting-up-the-Kubernetes-Master" class="headerlink" title="Setting up the Kubernetes Master"></a>Setting up the Kubernetes Master</h4><p>The following steps should be performed on the master.</p>
<ol>
<li><p>Install etcd and Kubernetes through yum:</p>
<p> $ yum -y install etcd kubernetes</p>
</li>
<li><p>Configure etcd to listen to all IP addresses inside &#x2F;etc&#x2F;etcd&#x2F;etcd.conf. Ensure the following lines are uncommented, and assign the following values:</p>
<p> ETCD_NAME&#x3D;default<br> ETCD_DATA_DIR&#x3D;”&#x2F;var&#x2F;lib&#x2F;etcd&#x2F;default.etcd”<br> ETCD_LISTEN_CLIENT_URLS&#x3D;”<a href="http://0.0.0.0:2379/">http://0.0.0.0:2379</a>“<br> ETCD_ADVERTISE_CLIENT_URLS&#x3D;”<a href="http://localhost:2379/">http://localhost:2379</a>“</p>
</li>
<li><p>Configure Kubernetes API server inside &#x2F;etc&#x2F;kubernetes&#x2F;apiserver. Ensure the following lines are uncommented, and assign the following values:</p>
<p> KUBE_API_ADDRESS&#x3D;”–address&#x3D;0.0.0.0”<br> KUBE_API_PORT&#x3D;”–port&#x3D;8080”<br> KUBELET_PORT&#x3D;”–kubelet_port&#x3D;10250”<br> KUBE_ETCD_SERVERS&#x3D;”–etcd_servers&#x3D;<a href="http://0.0.0.127/">http://127</a>    .0.0.1:2379”<br> KUBE_SERVICE_ADDRESSES&#x3D;”–service-cluster-ip    -range&#x3D;10.254.0.0&#x2F;16”<br> KUBE_ADMISSION_CONTROL&#x3D;”–admission_control&#x3D;    NamespaceLifecycle,NamespaceExists,LimitRang    er,SecurityContextDeny,ResourceQuota”<br> KUBE_API_ARGS&#x3D;””</p>
</li>
<li><p>Start and enable etcd, kube-apiserver, kube-controller-manager and kube-scheduler:</p>
<p> $ for SERVICES in etcd kube-apiserver kube-controller-manager kube-scheduler; do<br> systemctl restart $SERVICES<br> systemctl enable $SERVICES<br> systemctl status $SERVICES<br> done</p>
</li>
<li><p>Define flannel network configuration in etcd. This configuration will be pulled by flannel service on minions:</p>
<p> $ etcdctl mk &#x2F;atomic.io&#x2F;network&#x2F;config ‘{“Network”:”172.17.0.0&#x2F;16”}’</p>
</li>
<li><p>At this point, we should notice that nodes’ status returns nothing because we haven’t started any of them yet:</p>
<p> $ kubectl get nodes</p>
</li>
</ol>
<p>NAME             LABELS              STATUS</p>
<h4 id="Setting-up-Kubernetes-Minions-Nodes"><a href="#Setting-up-Kubernetes-Minions-Nodes" class="headerlink" title="Setting up Kubernetes Minions (Nodes)"></a>Setting up Kubernetes Minions (Nodes)</h4><p>The following steps should be performed on minion1, minion2 and minion3 unless specified otherwise.</p>
<ol>
<li><p>Install flannel and Kubernetes using yum:</p>
<p> $ yum -y install flannel kubernetes</p>
</li>
<li><p>Configure etcd server for flannel service. Update the following line inside &#x2F;etc&#x2F;sysconfig&#x2F;flanneld to connect to the respective master:</p>
<p> FLANNEL_ETCD&#x3D;”<a href="http://192.168.50.130:2379/">http://192.168.50.130:2379</a>“<br> FLANNEL_OPTIONS&#x3D;”-iface&#x3D;ens160”</p>
</li>
<li><p>Configure Kubernetes default config at &#x2F;etc&#x2F;kubernetes&#x2F;config, ensure you update the KUBE_MASTER value to connect to the Kubernetes master API server:</p>
<p> KUBE_MASTER&#x3D;”–master&#x3D;<a href="http://192.168.50.130:8080/">http://192.168.50.130:8080</a>“</p>
</li>
<li><p>Configure kubelet service inside &#x2F;etc&#x2F;kubernetes&#x2F;kubelet as below:<br>minion1:</p>
<p> KUBELET_ADDRESS&#x3D;”–address&#x3D;0.0.0.0”<br> KUBELET_PORT&#x3D;”–port&#x3D;10250”</p>
<h1 id="change-the-hostname-to-this-host’s-IP-address"><a href="#change-the-hostname-to-this-host’s-IP-address" class="headerlink" title="change the hostname to this host’s IP     address"></a>change the hostname to this host’s IP     address</h1><p> KUBELET_HOSTNAME&#x3D;”–hostname_override&#x3D;192.1    68.50.131”<br> KUBELET_API_SERVER&#x3D;”–api_servers&#x3D;<a href="http://0.0.0.19/">http://19</a>    2.168.50.130:8080”<br> KUBELET_ARGS&#x3D;””</p>
</li>
</ol>
<p>minion2:</p>
<pre><code>KUBELET_ADDRESS=&quot;--address=0.0.0.0&quot;
KUBELET_PORT=&quot;--port=10250&quot;
# change the hostname to this host’s IP     address
KUBELET_HOSTNAME=&quot;--hostname_override=192.1    68.50.132&quot;
KUBELET_API_SERVER=&quot;--api_servers=http://19    2.168.50.130:8080&quot;
KUBELET_ARGS=&quot;&quot;
</code></pre>
<p>minion3:</p>
<pre><code>KUBELET_ADDRESS=&quot;--address=0.0.0.0&quot;
KUBELET_PORT=&quot;--port=10250&quot;
# change the hostname to this host’s IP     address
KUBELET_HOSTNAME=&quot;--hostname_override=192.1    68.50.133&quot;
KUBELET_API_SERVER=&quot;--api_servers=http://19    2.168.50.130:8080&quot;
KUBELET_ARGS=&quot;&quot;
</code></pre>
<ol start="5">
<li><p>Start and enable kube-proxy, kubelet, docker and flanneld services:</p>
<p> $ for SERVICES in kube-proxy kubelet docker     flanneld; do<br> systemctl restart $SERVICES<br> systemctl enable $SERVICES<br> systemctl status $SERVICES<br> done    </p>
</li>
<li><p>On each minion, you should notice that you will have two new interfaces added, docker0 and flannel0. You should get different range of IP addresses on flannel0 interface on each minion, similar to below:<br>minion1:</p>
<p> $ ip a | grep flannel | grep inet<br> inet 172.17.45.0&#x2F;16 scope global flannel0</p>
</li>
</ol>
<p>minion2:</p>
<pre><code>$ ip a | grep flannel | grep inet
inet 172.17.38.0/16 scope global flannel0
</code></pre>
<p>minion3:</p>
<pre><code>$ ip a | grep flannel | grep inet
inet 172.17.93.0/16 scope global flannel0
</code></pre>
<ol start="6">
<li><p>Now login to Kubernetes master node and verify the minions’ status:</p>
<p> $ kubectl get nodes<br> NAME             LABELS                                  STATUS<br> 192.168.50.131   kubernetes.io&#x2F;hostname&#x3D;192.168.50.131   Ready<br> 192.168.50.132   kubernetes.io&#x2F;hostname&#x3D;192.168.50.132   Ready<br> 192.168.50.133   kubernetes.io&#x2F;hostname&#x3D;192.168.50.133   Ready</p>
</li>
</ol>
<p>You are now set. The Kubernetes cluster is now configured and running. We can start to play around with pods.</p>
<h4 id="Creating-Pods-Containers"><a href="#Creating-Pods-Containers" class="headerlink" title="Creating Pods (Containers)"></a>Creating Pods (Containers)</h4><p>To create a pod, we need to define a yaml file in the Kubernetes master, and use the kubectl command to create it based on the definition. Create a mysql.yaml file: </p>
<pre><code>$ mkdir pods
$ cd pods
$ vim mysql.yaml
</code></pre>
<p>And add the following lines:</p>
<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: mysql
  labels:
    name: mysql
spec:
  containers:
    - resources:
        limits :
          cpu: 1
      image: mysql
      name: mysql
      env:
        - name: MYSQL_ROOT_PASSWORD
          # change this
          value: yourpassword
      ports:
        - containerPort: 3306
          name: mysql
          
</code></pre>
<p>Create the pod:</p>
<pre><code>$ kubectl create -f mysql.yaml
</code></pre>
<p>It may take a short period before the new pod reaches the Running state. Verify the pod is created and running:</p>
<pre><code>$ kubectl get pods
POD       IP            CONTAINER(S)   IMAGE(S)   HOST                            LABELS       STATUS    CREATED
mysql     172.17.38.2   mysql          mysql      192.168.50.132/192.168.50.132   name=mysql   Running   3 hours
</code></pre>
<p>So, Kubernetes just created a Docker container on 192.168.50.132. We now need to create a Service that lets other pods access the mysql database on a known port and host.</p>
<h4 id="Creating-Service"><a href="#Creating-Service" class="headerlink" title="Creating Service"></a>Creating Service</h4><p>At this point, we have a MySQL pod inside 192.168.50.132. Define a mysql-service.yaml as below:</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  labels:
    name: mysql
  name: mysql
spec:
  externalIPs:
    - 192.168.50.132
  ports:
    # the port that this service should serve on
    - port: 3306
    # label keys and values that must match in order to receive traffic for this service
  selector:
    name: mysql
</code></pre>
<p>Start the service:</p>
<pre><code>$ kubectl create -f mysql-service.yaml
</code></pre>
<p>You should get a 10.254.x.x IP range assigned to the mysql service. This is the Kubernetes internal IP address defined in &#x2F;etc&#x2F;kubernetes&#x2F;apiserver. This IP is not routable outside, so we defined the public IP instead (the interface that connected to external network for that minion):</p>
<pre><code>$ kubectl get services
NAME            LABELS                                    SELECTOR     IP               PORT(S)
kubernetes      component=apiserver,provider=kubernetes   &lt;none&gt;       10.254.0.2       443/TCP
kubernetes-ro   component=apiserver,provider=kubernetes   &lt;none&gt;       10.254.0.1       80/TCP
mysql           name=mysql                                name=mysql   10.254.13.156    3306/TCP
                                                                       192.168.50.132
                                                                       
                                                                       
</code></pre>
<p>Let’s connect to our database server from outside (we used MariaDB client on CentOS 7):</p>
<pre><code>$ mysql -uroot -p -h192.168.50.132
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 4
Server version: 5.6.24 MySQL Community Server (GPL)
 
Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others.
 
Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
 
MySQL [(none)]&gt; show variables like &#39;%version%&#39;;
+-------------------------+------------------------------+
| Variable_name           | Value                        |
+-------------------------+------------------------------+
| innodb_version          | 5.6.24                       |
| protocol_version        | 10                           |
| slave_type_conversions  |                              |
| version                 | 5.6.24                       |
| version_comment         | MySQL Community Server (GPL) |
| version_compile_machine | x86_64                       |
| version_compile_os      | Linux                        |
+-------------------------+------------------------------+
7 rows in set (0.01 sec)
</code></pre>
<p>That’s it! You should now be able to connect to the MySQL container that resides on minion2. </p>
<p>Check out the Kubernetes guestbook example on how to build a simple, multi-tier web application with Redis in master-slave setup. In a follow-up blog post, we are going to play around with Galera cluster containers on Kubernetes. Stay tuned!</p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ul>
<li>Creating a Kubernetes Cluster to Run Docker Formatted Container Images - <a href="https://access.redhat.com/articles/1353773">https://access.redhat.com/articles/1353773</a></li>
<li>Kubernetes Github - <a href="https://github.com/googlecloudplatform/kubernetes">https://github.com/googlecloudplatform/kubernetes</a></li>
<li>Persistent Installation of MySQL and WordPress on Kubernetes - <a href="https://github.com/GoogleCloudPlatform/kubernetes/tree/master/examples/mysql-wordpress-pd">https://github.com/GoogleCloudPlatform/kubernetes/tree/master/examples/mysql-wordpress-pd</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/zabbix/%E8%87%AA%E5%8A%A8%E5%B7%A1%E6%A3%80%E8%84%9A%E6%9C%AC(%E8%B0%83%E7%94%A8zabbix%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0)%20-%20%E5%89%AF%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/zabbix/%E8%87%AA%E5%8A%A8%E5%B7%A1%E6%A3%80%E8%84%9A%E6%9C%AC(%E8%B0%83%E7%94%A8zabbix%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0)%20-%20%E5%89%AF%E6%9C%AC/" class="post-title-link" itemprop="url">自动巡检脚本(调用zabbix接口实现)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zabbix/" itemprop="url" rel="index"><span itemprop="name">zabbix</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<pre><code>crontab: no changes made to crontab
[root@autoyunwei ~]# vim /etc/crontab 
[root@autoyunwei ~]# vim /root/script/xunjian.py
[root@autoyunwei ~]# cat  /root/script/xunjian.py
#!/usr/bin/env python
# -*- coding:utf-8 -*- 
#Author: qiantu
#qq 261767353

import os
import time
import shutil
import MySQLdb
import smtplib
import requests
import datetime

from email.MIMEText import MIMEText
from email.MIMEImage import MIMEImage
from email.MIMEMultipart import MIMEMultipart

# based on zabbix 2.4.4
ZABBIX_HOST = &#39;192.168.2.91&#39;
ZABBIX_USER = &#39;Admin&#39;
ZABBIX_PWD = &#39;zzjr#2015&#39;

ZABBIX_DB_HOST = &#39;192.168.2.91&#39;
ZABBIX_DB_USER = &#39;zabbix&#39;
ZABBIX_DB_PWD = &#39;zabbix&#39;
ZABBIX_DB_NAME = &#39;zabbix&#39;

GRAPH_PATH = &quot;zabbix_img&quot;
GRAPH_PERIOD = 86400  # one day

EMAIL_DOMAIN = &#39;zuozh.com&#39;
EMAIL_USERNAME = &#39;wangqiantu&#39;
EMAIL_PASSWORD = &#39;Lht1111&#39;


def query_screens(screen_name):
    conn = MySQLdb.connect(host=ZABBIX_DB_HOST, user=ZABBIX_DB_USER, passwd=ZABBIX_DB_PWD,
                        db=ZABBIX_DB_NAME, charset=&#39;utf8&#39;, connect_timeout=20)
    cur = conn.cursor()
    count = cur.execute(&quot;&quot;&quot;
            select a.name, a.screenid, b.resourceid, b.width, b.height
                from screens a, screens_items as b
                where a.screenid=b.screenid and a.templateid&lt;=&gt;NULL and a.name=&#39;%s&#39;
                order by a.screenid;
            &quot;&quot;&quot; % screen_name)
    if count == 0:
        result = 0
    else:
        result = cur.fetchall()

    cur.close()
    conn.close()

    return result


def generate_graphs(screens):
    login_resp = requests.post(&#39;http://%s/zabbix/index.php&#39; % ZABBIX_HOST, data=&#123;
        &#39;name&#39;: ZABBIX_USER,
        &#39;password&#39;: ZABBIX_PWD,
        &#39;enter&#39;: &#39;Sign in&#39;,
        &#39;autologin&#39;: 1,
    &#125;)
    session_id = login_resp.cookies[&#39;zbx_sessionid&#39;]

    graphs = []
    for i, (screen_name, screen_id, graph_id, width, height) in enumerate(screens):
        params = &#123;
            &#39;screenid&#39;: screen_id,
            &#39;graphid&#39;: graph_id,
            &#39;width&#39;: width * 2,
            &#39;height&#39;: height * 2,
            &#39;period&#39;: GRAPH_PERIOD,
            &#39;stime&#39;: datetime.datetime.utcnow().strftime(&#39;%Y%m%d%H%M%S&#39;),
        &#125;
        resp = requests.get(&#39;http://%s/zabbix/chart2.php&#39; % ZABBIX_HOST, params=params,
                            cookies=&#123;&#39;zbx_sessionid&#39;: session_id&#125;)
        file_name = &#39;_&#39;.join(map(str, screens[i][:3])).replace(&#39; &#39;, &#39;_&#39;) + &#39;.png&#39;
        with open(os.path.join(GRAPH_PATH, file_name), &#39;wb&#39;) as fp:
            fp.write(resp.content)
        graphs.append(file_name)

    return graphs


def send_mail(screen_name, graphs, to_list):
    me = u&#39;巡检报告 &lt;%s@%s&gt;&#39; % (EMAIL_USERNAME, EMAIL_DOMAIN)

    def _create_msg():
        msg = MIMEMultipart(&#39;related&#39;)
        title=u&quot;每日巡检报告&quot;
        msg[&#39;Subject&#39;] = &#39;%s: %s&#39; % (title,screen_name)
        msg[&#39;From&#39;] = me
        msg[&#39;To&#39;] = &#39;;&#39;.join(to_list)
        msg.preamble = &#39;This is a multi-part message in MIME format.&#39;

        contents = &quot;&lt;h1&gt;Screen %s&lt;/h1&gt;&lt;br&gt;&quot; % screen_name
        contents += &quot;&lt;table&gt;&quot;
        for g_name in graphs:
            with open(os.path.join(GRAPH_PATH, g_name), &#39;rb&#39;) as fp:
                msg_image = MIMEImage(fp.read())
                msg_image.add_header(&#39;Content-ID&#39;, &quot;&lt;%s&gt;&quot; % g_name)
                msg.attach(msg_image)

            contents += &#39;&#39;
            contents += &quot;&lt;tr&gt;&lt;td&gt;&lt;img src=&#39;cid:%s&#39;&gt;&lt;/td&gt;&lt;/tr&gt;&quot; % g_name
        contents += &quot;&lt;/table&gt;&quot;

        msg_text = MIMEText(contents, &#39;html&#39;)
        msg_alternative = MIMEMultipart(&#39;alternative&#39;)
        msg_alternative.attach(msg_text)
        msg.attach(msg_alternative)

        return msg

    try:
        server = smtplib.SMTP()
        server.connect(&#39;smtp.%s&#39; % EMAIL_DOMAIN)
        server.login(&#39;%s@%s&#39; % (EMAIL_USERNAME, EMAIL_DOMAIN), EMAIL_PASSWORD)
        server.sendmail(me, to_list, _create_msg().as_string())
        server.close()
        print &#39;send mail Ok!&#39;
    except Exception, e:
        print e


if __name__ == &#39;__main__&#39;:
    # remove old dirs
    if os.path.exists(GRAPH_PATH):
        shutil.rmtree(GRAPH_PATH)
    os.makedirs(GRAPH_PATH)

    for srn_name in (u&#39;All databases machine cpu&#39;,u&#39;All virtual machine io&#39;,u&#39;All virtual machine memory&#39;,u&#39;All virtual machine traffic&#39;,u&#39;ALL nginx connections&#39;):
        # get screens
        all_screens = query_screens(srn_name)
        print all_screens

        # generate graphs
        graphs = generate_graphs(all_screens)

        send_mail(srn_name, graphs, [&#39;monitor@zuozh.com&#39;])
        #send_mail(srn_name, graphs, [&#39;wangqiantu@zuozh.com&#39;])
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/mysql/Percona%20XtraDB%20Cluster%20%E5%A4%9A%E4%B8%BB%E9%9B%86%E7%BE%A4%E7%A0%94%E7%A9%B6%E5%AE%9E%E7%8E%B0MYSQL%E8%B4%9F%E8%BD%BD%E5%88%86%E6%B5%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/mysql/Percona%20XtraDB%20Cluster%20%E5%A4%9A%E4%B8%BB%E9%9B%86%E7%BE%A4%E7%A0%94%E7%A9%B6%E5%AE%9E%E7%8E%B0MYSQL%E8%B4%9F%E8%BD%BD%E5%88%86%E6%B5%81/" class="post-title-link" itemprop="url">mysql群集</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->


<p>QXtraDB是MySQL开源的一个分支，在数据操作层面上，和MYSQL基本一样。其集群与常用的MYSQL集群特性如下：</p>
<p>个人认为XtraDB最大的优点，解决了传统集群的两个问题，<br>         一是，数据同步的及时性，解决了MYSQL做分步式方案时的时间差问题。<br>         二是实现了多主，各节点可同时读写，这样一来的话，在需要对大并发，大数据量的频繁操作处理的情况下，达到数据库层面负载分流的目的，且实现方便。同时有效的最大化利用了硬件资源。</p>
<p>局限性<br>1.目前的复制仅仅支持InnoDB存储引擎。任何写入其他引擎的表，包括mysql.*表将不会复制。但是DDL语句会被复制的，因此创建用户将会被复制，但是insert into mysql.user…将不会被复制的。</p>
<p>2.DELETE操作不支持没有主键的表。没有主键的表在不同的节点顺序将不同，如果执行SELECT…LIMIT… 将出现不同的结果集。</p>
<p>3.在多主环境下LOCK&#x2F;UNLOCK TABLES不支持。以及锁函数GET_LOCK(), RELEASE_LOCK()…</p>
<p>4.查询日志不能保存在表中。如果开启查询日志，只能保存到文件中。</p>
<p>5.允许最大的事务大小由wsrep_max_ws_rows和wsrep_max_ws_size定义。任何大型操作将被拒绝。如大型的LOAD DATA操作。</p>
<p>6.由于集群是乐观的并发控制，事务commit可能在该阶段中止。如果有两个事务向在集群中不同的节点向同一行写入并提交，失败的节点将中止。对于集群级别的中止，集群返回死锁错误代码(Error: 1213 SQLSTATE: 40001 (ER_LOCK_DEADLOCK)).</p>
<p>7.XA事务不支持，由于在提交上可能回滚。</p>
<p>8.整个集群的写入吞吐量是由最弱的节点限制，如果有一个节点变得缓慢，那么整个集群将是缓慢的。为了稳定的高性能要求，所有的节点应使用统一的硬件。</p>
<p>9.集群节点建议最少3个。</p>
<p>10.如果DDL语句有问题将破坏集群。</p>
<p>***********************      以下是配置步骤   *******************************<br>以下测试在 redhat6.4 64bit下实现【RPM方式安装】，采用三台机器，信息如下：<br>     db1  192.168.163.189<br>     db2  192.168.163.190<br>      db3  192.168.163.191<br>1、各节点配置和安装 2个 YUM 源<br>[EPEL]<br>name&#x3D;EPEL<br>baseurl&#x3D;<a href="http://mirror.neu.edu.cn/fedora/epel//6Server/x86_64/">http://mirror.neu.edu.cn/fedora/epel//6Server/x86_64/</a><br>enabled&#x3D;1<br>gpgcheck&#x3D;0<br>rpm -Uhv <a href="http://www.percona.com/downloads/percona-release/percona-release-0.0-1.x86_64.rpm">http://www.percona.com/downloads/percona-release/percona-release-0.0-1.x86_64.rpm</a></p>
<p>2、各节点删除系统自带的相关软件包<br>  rpm -e –nodeps  mysql-libs-5.1.66-2.el6_3.x86_64</p>
<p>3、各节点安装相关软件<br>yum install Percona-XtraDB-Cluster-server -y<br>正常情况下应该会安装以下相关软件包<br>     Percona-XtraDB-Cluster-server-55<br>     Percona-Server-shared-51<br>     Percona-XtraDB-Cluster-client-55<br>     Percona-XtraDB-Cluster-galera-2<br>     Percona-XtraDB-Cluster-shared-55<br>    percona-xtrabackup<br>    perl-DBD-MySQL</p>
<p>4、各节点my.cnf最基本的配置<br>[mysqld]<br>basedir&#x3D;&#x2F;usr #可修改<br>datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql #可修改<br>wsrep_provider&#x3D;&#x2F;usr&#x2F;lib64&#x2F;libgalera_smm.so #需确认路径是否正常<br>wsrep_cluster_address&#x3D;gcomm:&#x2F;&#x2F;  #首次运行不指定，等整个集群启动后，再修改，否则集群无法启动<br>wsrep_slave_threads&#x3D;8<br>wsrep_sst_method&#x3D;rsync<br>binlog_format&#x3D;ROW<br>default_storage_engine&#x3D;InnoDB<br>innodb_locks_unsafe_for_binlog&#x3D;1<br>innodb_autoinc_lock_mode&#x3D;2<br>wsrep_sst_auth&#x3D;wsuser:redhat   #同步时使用的用户名及密码，格式为用户名：密码</p>
<p>5、集群中第一个节点192.168.163.189首次启动，启动时留意数据库错误日志信息<br>&#x2F;etc&#x2F;init.d&#x2F;mysql  bootstrap-pxc</p>
<p>6、第二个节点192.168.163.190首次启动<br>&#x2F;etc&#x2F;init.d&#x2F;mysql start wsrep_cluster_address&#x3D;gcomm:&#x2F;&#x2F;192.168.163.189,192.168.163.190</p>
<p>7 、第三个节点192.168.163.190首次启动<br>&#x2F;etc&#x2F;init.d&#x2F;mysql start wsrep_cluster_address&#x3D;gcomm:&#x2F;&#x2F;192.168.163.189,192.168.163.190,192.168.163.191</p>
<p>【注】以下各节点在启动前后，可用命令查看集群信息情况<br>mySQL&gt;show status like ‘wsrep%’;</p>
<p>8、各节点授权<br>授权：<br>MYSQL&gt;CREATE USER ‘wsuser‘@’localhost’ IDENTIFIED BY ‘redhat’;<br> GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT ON <em>.</em> TO ‘wsuser‘@’localhost’;<br> FLUSH PRIVILEGES;</p>
<p>当所有节点启动后，修改各节点的MY.CNF修改参数wsrep_cluster_address&#x3D;gcomm:&#x2F;&#x2F;192.168.163.189,192.168.163.190,192.168.163.191</p>
<p>9、测试集群可用性<br>    1、在其中任意一个节点创建一个INNodb库，到其它节点检查是否已有库生成。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/mysql/mysql_%E4%B8%BB%E4%B8%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/mysql/mysql_%E4%B8%BB%E4%B8%BB/" class="post-title-link" itemprop="url">mysql主主同步配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->




<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><pre><code>setenforce 0  
service iptables stop
yum -y install mysql-server mysql-devel mysql
service mysqld start
service mysqld stop
</code></pre>
<h4 id="192-168-128-140上操作"><a href="#192-168-128-140上操作" class="headerlink" title="192.168.128.140上操作"></a>192.168.128.140上操作</h4><pre><code>[root@localhost ~]# vim /etc/my.cnf 

[client]
default-character-set=utf8
[mysqld]
wait_timeout         = 864000
interactive_timeout  = 864000
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
user=mysql
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

auto_increment_offset=1
auto-increment-increment=2
server_id = 140
log-bin=mysql-bin
character_set_server=utf8
replicate_wild_ignore_table=information_schema.%
replicate-wild_ignore_table=performance_schema.%
replicate-wild_ignore_table=test.%

[mysqld_safe]
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid

[root@localhost ~]# service mysqld restart
</code></pre>
<h4 id="192-168-128-137-上操作"><a href="#192-168-128-137-上操作" class="headerlink" title="192.168.128.137 上操作"></a>192.168.128.137 上操作</h4><p>[root@localhost ~]# vi &#x2F;etc&#x2F;my.cnf </p>
<pre><code>[client]
default-character-set=utf8
[mysqld]
wait_timeout         = 864000
interactive_timeout  = 864000
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
user=mysql
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

auto_increment_offset=2
auto-increment-increment=2
server_id = 053
log-bin=mysql-bin
character_set_server=utf8
replicate_wild_ignore_table=information_schema.%
replicate-wild_ignore_table=performance_schema.%
replicate-wild_ignore_table=test.%

[mysqld_safe]
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid

[root@localhost ~]# service mysqld restart
</code></pre>
<h4 id="192-168-128-140-上操作"><a href="#192-168-128-140-上操作" class="headerlink" title="192.168.128.140 上操作"></a>192.168.128.140 上操作</h4><pre><code>mysql&gt; GRANT REPLICATION SLAVE ON *.* TO &#39;repl&#39;@&#39;192.168.128.137&#39; IDENTIFIED BY &#39;twlqccr&#39;;
mysql&gt; GRANT REPLICATION SLAVE ON *.* TO &#39;repl&#39;@&#39;192.168.128.140&#39; IDENTIFIED BY &#39;twlqccr&#39;;
mysql&gt; flush tables with read lock; 
mysql&gt; show master status\G
*************************** 1. row ***************************
            File: mysql-bin.000001
        Position: 430
    Binlog_Do_DB:
Binlog_Ignore_DB:
1 row in set (0.00 sec)

导出数据，scp到192.168.128..137
mysqldump qiantu &gt;/tmp/qiantu.sql 
scp /tmp/qiantu.sql 192.168.128.137:/tmp/

mysql&gt;UNLOCK TABLES;


192.168.128.137 上操作
mysql&gt; GRANT REPLICATION SLAVE ON *.* TO &#39;repl&#39;@&#39;192.168.128.137&#39; IDENTIFIED BY &#39;twlqccr&#39;;
mysql&gt; GRANT REPLICATION SLAVE ON *.* TO &#39;repl&#39;@&#39;192.168.128.140&#39; IDENTIFIED BY &#39;twlqccr&#39;;
mysql&gt; create database qiantu ;
mysql&gt; use qiantu;
mysql&gt; source /tmp/qiantu.sql;

stop slave;
reset slave;
change master to master_host=&#39;192.168.128.140&#39;,master_user=&#39;repl&#39;, master_password=&#39;twlqccr&#39;, master_port=3306, master_log_file=&#39;mysql-bin.000001&#39;, master_log_pos=430;
start slave;
show slave status\G
</code></pre>
<h4 id="在192-168-128-137看到两个yes就代表192-168-128-140-主-192-168-128-137-从-成功了"><a href="#在192-168-128-137看到两个yes就代表192-168-128-140-主-192-168-128-137-从-成功了" class="headerlink" title="在192.168.128.137看到两个yes就代表192.168.128.140(主)192.168.128.137(从)成功了"></a>在192.168.128.137看到两个yes就代表192.168.128.140(主)192.168.128.137(从)成功了</h4><p>反过来再做一次，就是主主了</p>
<h4 id="192-168-128-137-查看"><a href="#192-168-128-137-查看" class="headerlink" title="192.168.128.137 查看"></a>192.168.128.137 查看</h4><pre><code>mysql&gt; flush tables with read lock; 
mysql&gt; show master status\G
*************************** 1. row ***************************
            File: mysql-bin.000001
        Position: 1500
    Binlog_Do_DB:
Binlog_Ignore_DB:
1 row in set (0.00 sec)



192.168.128.140 上操作
stop slave;
reset slave;
change master to master_host=&#39;192.168.128.137&#39;,master_user=&#39;repl&#39;, master_password=&#39;twlqccr&#39;, master_port=3306, master_log_file=&#39;mysql-bin.000001&#39;, master_log_pos=1500;
start slave;
show slave status\G
</code></pre>
<h4 id="在192-168-128-140看到两个yes就代表主从192-168-128-137-主-192-168-128-140-从-成功了"><a href="#在192-168-128-140看到两个yes就代表主从192-168-128-137-主-192-168-128-140-从-成功了" class="headerlink" title="在192.168.128.140看到两个yes就代表主从192.168.128.137(主)192.168.128.140(从)成功了"></a>在192.168.128.140看到两个yes就代表主从192.168.128.137(主)192.168.128.140(从)成功了</h4><p>测试，新建一个数据库 去另一台机器看看是否有生成</p>
<h4 id="测试脚本"><a href="#测试脚本" class="headerlink" title="测试脚本"></a>测试脚本</h4><pre><code>#!/bin/bash
mysql -e &quot;create database qiantu;&quot;
mysql -e &quot;create table qiantu.demo(addtime timestamp);&quot;
while true
do
mysql -e &quot;select * from qiantu.demo;&quot;
sleep 3
mysql -e &quot;insert into qiantu.demo values(null);&quot;
done
</code></pre>
<p>#如果是克隆的第二台机器，要改下uuid，不然会报错<br>vim &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;auto.cnf<br>[auto]<br>server-uuid&#x3D;99424caf-4807-11e6-a88d-005056806ac1</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/mysql/mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/mysql/mysql/" class="post-title-link" itemprop="url">DQL、DML、DDL、DCL的概念与区别</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<h1 id="DQL、DML、DDL、DCL的概念与区别"><a href="#DQL、DML、DDL、DCL的概念与区别" class="headerlink" title="DQL、DML、DDL、DCL的概念与区别"></a>DQL、DML、DDL、DCL的概念与区别</h1><p>SQL(Structure Query Language)语言是数据库的核心语言。</p>
<p>SQL的发展是从1974年开始的，其发展过程如下：<br>1974年—–由Boyce和Chamberlin提出，当时称SEQUEL。<br>1976年—–IBM公司的Sanjase研究所在研制RDBMS SYSTEM R<br>时改为SQL。<br>1979年—–Oracle公司发表第一个基于SQL的商业化RDBMS产品。<br>1982年—–IBM公司出版第一个RDBMS语言SQL&#x2F;DS。<br>1985年—–IBM公司出版第一个RDBMS语言DB2。<br>1986年—–美国国家标准化组织ANSI宣布SQL作为数据库工业标准。<br>SQL是一个标准的数据库语言，是面向集合的描述性非过程化语言。<br>它功能强，效率高，简单易学易维护（迄今为止，我还没见过比它还好<br>学的语言）。然而SQL语言由于以上优点，同时也出现了这样一个问题：<br>它是非过程性语言，即大多数语句都是独立执行的，与上下文无关，而<br>绝大部分应用都是一个完整的过程，显然用SQL完全实现这些功能是很困<br>难的。所以大多数数据库公司为了解决此问题，作了如下两方面的工作：<br>(1)扩充SQL，在SQL中引入过程性结构；(2)把SQL嵌入到高级语言中，<br>以便一起完成一个完整的应用。</p>
<p>二. SQL语言的分类</p>
<p>SQL语言共分为四大类：数据查询语言DQL，数据操纵语言DML，数据定义语言DDL，数据控制语言DCL。</p>
<ol>
<li>数据查询语言DQL<br>数据查询语言DQL基本结构是由SELECT子句，FROM子句，WHERE<br>子句组成的查询块：<br>SELECT &lt;字段名表&gt;<br>FROM &lt;表或视图名&gt;<br>WHERE &lt;查询条件&gt;</li>
</ol>
<p>2 .数据操纵语言DML<br>数据操纵语言DML主要有三种形式：</p>
<ol>
<li>插入：INSERT</li>
<li>更新：UPDATE</li>
<li>删除：DELETE</li>
</ol>
<ol start="3">
<li>数据定义语言DDL<br>数据定义语言DDL用来创建数据库中的各种对象—–表、视图、<br>索引、同义词、聚簇等如：<br>CREATE TABLE&#x2F;VIEW&#x2F;INDEX&#x2F;SYN&#x2F;CLUSTER<br>| | | | |<br>表 视图 索引 同义词 簇</li>
</ol>
<p>DDL操作是隐性提交的！不能rollback</p>
<ol start="4">
<li>数据控制语言DCL<br>数据控制语言DCL用来授予或回收访问数据库的某种特权，并控制<br>数据库操纵事务发生的时间及效果，对数据库实行监视等。如：</li>
</ol>
<ol>
<li><p>GRANT：授权。</p>
</li>
<li><p>ROLLBACK [WORK] TO [SAVEPOINT]：回退到某一点。<br>回滚—ROLLBACK<br>回滚命令使数据库状态回到上次最后提交的状态。其格式为：<br>SQL&gt;ROLLBACK;</p>
</li>
<li><p>COMMIT [WORK]：提交。</p>
<p> 在数据库的插入、删除和修改操作时，只有当事务在提交到数据</p>
</li>
</ol>
<p>库时才算完成。在事务提交前，只有操作数据库的这个人才能有权看<br>到所做的事情，别人只有在最后提交完成后才可以看到。<br>提交数据有三种类型：显式提交、隐式提交及自动提交。下面分<br>别说明这三种类型。</p>
<p>(1) 显式提交<br>用COMMIT命令直接完成的提交为显式提交。其格式为：<br>SQL&gt;COMMIT；</p>
<p>(2) 隐式提交<br>用SQL命令间接完成的提交为隐式提交。这些命令是：<br>ALTER，AUDIT，COMMENT，CONNECT，CREATE，DISCONNECT，DROP，<br>EXIT，GRANT，NOAUDIT，QUIT，REVOKE，RENAME。</p>
<p>(3) 自动提交<br>若把AUTOCOMMIT设置为ON，则在插入、修改、删除语句执行后，<br>系统将自动进行提交，这就是自动提交。其格式为：<br>SQL&gt;SET AUTOCOMMIT ON；</p>
<h1 id="mysql上利用通配符模糊匹配数据库进行grant"><a href="#mysql上利用通配符模糊匹配数据库进行grant" class="headerlink" title="mysql上利用通配符模糊匹配数据库进行grant"></a>mysql上利用通配符模糊匹配数据库进行grant</h1><p> 给业务搭建数据库时由于采用的时分库策略，导致每个服务器上都有上百个数据库，新用户需要只对这些库有权限读写，由于服务器多，数据库多，如果采用逐个赋权限会很麻烦<br>在mysql中，当我们想对某个用户赋予权限时，对于数据库可以利用通配符（_和%）指定一类数据库进行操作，这样就可以避免逐个操作啦。<br>举例如下，假设我们有数据库，</p>
<pre><code>root@(none) 09:41:16&gt;show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| bp_crm             |
| dp_0007            |
| dp_0019            |
| dp_normandie_0028  |
| dp_p4p_0082        |
| dp_p4p_0169        |
| home               |
| mysql              |
| test               |
+--------------------+
10 rows in set (0.00 sec)
</code></pre>
<p>大家可以看到除了系统db（mysql,information_schema,test）之外，我们有一批报表库是以“dp”开头的，如果我们想创建一个用户，只对这些db可以进行操作，那么可以利用通配符%</p>
<pre><code>root@(none) 09:52:13&gt;select host,user,password     from mysql.user;
+------------------------+--------+-------------    ------------------------------+
| host                   | user   | password                                      |
+------------------------+--------+-------------    ------------------------------+
| localhost              | root   |                                               |
| linezing128042.sqa.cm4 | root   |                                               |
| 127.0.0.1              | root   |                                               |
| localhost              |        |                                               |
| linezing128042.sqa.cm4 |        |                                               |
| %                      | lzstat |     *23AE809DDACAF96AF0FD78ED04B6A265E05AA257 |
| %                      | admin  |     *4ACFE3202A5FF5CF467898FC58AAB1D615029441 |
| %                      | crm    |     *46E75F13B7337A95AAEB7680B6C52280D9CDF5D2 |
+------------------------+--------+-------------    ------------------------------+
8 rows in set (0.01 sec)

root@(none) 09:52:17&gt;grant all privileges on     `dp%`.* to dp_admin identified by &#39;mypasswd&#39;;
Query OK, 0 rows affected (0.00 sec)
</code></pre>
<p>注意这里不是单引号’，而是反单引号&#96;</p>
<pre><code>root@(none) 09:53:56&gt;flush privileges;
Query OK, 0 rows affected (0.01 sec)

root@(none) 09:54:38&gt;select host,user,password     from mysql.user;
+------------------------+----------+-----------    --------------------------------+
| host                   | user     | password                                      |
+------------------------+----------+-----------    --------------------------------+
| localhost              | root     |                                               |
| linezing128042.sqa.cm4 | root     |                                               |
| 127.0.0.1              | root     |                                               |
| localhost              |          |                                               |
| linezing128042.sqa.cm4 |          |                                               |
| %                      | lzstat   |     *23AE809DDACAF96AF0FD78ED04B6A265E05AA257 |
| %                      | admin    |     *4ACFE3202A5FF5CF467898FC58AAB1D615029441 |
| %                      | crm      |     *46E75F13B7337A95AAEB7680B6C52280D9CDF5D2 |
| %                      | dp_admin |     *85E26B8AB29FEE8453201A3511DAE24A24059109 |
+------------------------+----------+-----------    --------------------------------+
9 rows in set (0.00 sec)
</code></pre>
<p>我们测试一下远程登录，是否可以访问：</p>
<pre><code>[mysql@testdb2 ~]$ mysql -udp_admin     -h10.232.128.42 -pmypasswd

mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| dp_0007            |
| dp_0019            |
| dp_normandie_0028  |
| dp_p4p_0082        |
| dp_p4p_0169        |
| test               |
+--------------------+
7 rows in set (0.00 sec)
</code></pre>
<p>可以看到mysql db是无法看到的，这正符合我们的初衷。</p>
<pre><code>mysql&gt; use dp_0007
Reading table information for completion of     table and column names
You can turn off this feature to get a quicker     startup with -A

Database changed
mysql&gt; show tables;
+--------------------------------------+
| Tables_in_dp_0007                    |
+--------------------------------------+
| dpunit_p4p_campaign_d__201006        |
| dpunit_p4p_effect_contrast_d__201006 |
| dpunit_p4p_effect_contrast_d__201007 |
| mytest2                              |
| mytesttab                            |
+--------------------------------------+
5 rows in set (0.00 sec)

mysql&gt; select count(*) from     dpunit_p4p_campaign_d__201006;
+----------+
| count(*) |
+----------+
|    16622 |
+----------+
1 row in set (0.00 sec)

mysql&gt; use dp_p4p_0082
Reading table information for completion of     table and column names
You can turn off this feature to get a quicker     startup with -A

Database changed
mysql&gt; show tables;
+---------------------------------------------+
| Tables_in_dp_p4p_0082                       |
+---------------------------------------------+
| dim_m_star                                  |
。。。。。
| dpunit_p4p_platform_d__201006               |
| dpunit_p4p_platform_d__201007               |
| dpunit_p4p_platform_d__201008               |
| lz_dim_category_level1                      |
| mytest2                                     |
| mytesttab                                   |
+---------------------------------------------+
74 rows in set (0.00 sec)

mysql&gt; select count(*) from     dpunit_p4p_platform_d__201008;
+----------+
| count(*) |
+----------+
|    38640 |
+----------+
1 row in set (0.00 sec)
</code></pre>
<p>看到可以访问操作“dp”开头的数据库。</p>
<p>注意：_也是通配符，在你grant “dp_p4p”开头的数据库权限时需要用”&quot;做一下转义。</p>
<pre><code>root@(none) 10:18:15&gt;grant all privileges on     `dp\_p4p%`.* to dp_admin2 identified by     &#39;mypasswd&#39;;
Query OK, 0 rows affected (0.00 sec)

root@(none) 10:22:41&gt;flush privileges;
Query OK, 0 rows affected (0.01 sec)

root@(none) 10:22:46&gt;select host,user,password     from mysql.user;
+------------------------+-----------+----------    ---------------------------------+
| host                   | user      | password                                      |
+------------------------+-----------+----------    ---------------------------------+
| localhost              | root      |                                               |
| linezing128042.sqa.cm4 | root      |                                               |
| 127.0.0.1              | root      |                                               |
| localhost              |           |                                               |
| linezing128042.sqa.cm4 |           |                                               |
| %                      | lzstat    |     *23AE809DDACAF96AF0FD78ED04B6A265E05AA257 |
| %                      | admin     |     *4ACFE3202A5FF5CF467898FC58AAB1D615029441 |
| %                      | crm       |     *46E75F13B7337A95AAEB7680B6C52280D9CDF5D2 |
| %                      | dp_admin  |     *85E26B8AB29FEE8453201A3511DAE24A24059109 |
| %                      | dp_admin2 |     *85E26B8AB29FEE8453201A3511DAE24A24059109 |
+------------------------+-----------+----------    ---------------------------------+
10 rows in set (0.00 sec)
</code></pre>
<p>我们测试一下远程登录，是否可以访问：</p>
<pre><code>[mysql@testdb2 ~]$ mysql -udp_admin2     -h10.232.128.42 -pmypasswd

mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| dp_p4p_0082        |
| dp_p4p_0169        |
| test               |
+--------------------+
4 rows in set (0.00 sec)
</code></pre>
<p>注意，dp_admin2只有权限看到”dp_p4p”开头的数据库，dp_p4p_0082和dp_p4p_0169</p>
<p>同样你也可以在hostname中指定通配符，但不可以在user中指定：</p>
<pre><code>root@(none) 10:36:53&gt;grant all privileges on     `dp\_p4p%`.* to dp_admin3@&#39;10.254.3.%&#39;     identified by &#39;mypasswd&#39;;
Query OK, 0 rows affected (0.00 sec)

root@(none) 10:37:25&gt;flush privileges;
</code></pre>
<p>表示10.254.3子网段的服务器都可以访问”dp_p4p”这类数据库，注意这里是单引号</p>
<p>另外，使用反勾号(&#96;)为数据库、表、列和子程序名称加引号。使用单引号(‘)为hostnames、usernames和password加引号。</p>
<pre><code>root@(none) 10:58:26&gt;grant select on     dp_p4p_0082.`dpunit_p4p_effect_adgroup_bidword_d    __201006` to dp_admin4@&#39;10.254.3.%&#39; identified     by &#39;mypasswd&#39;;
Query OK, 0 rows affected (0.00 sec)

root@(none) 10:58:22&gt;flush privileges;
Query OK, 0 rows affected (0.00 sec)
</code></pre>
<p>例子中，表用的是反引号&#96;，而给hostname和密码用的是单引号’    </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/zjump/zjump/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/zjump/zjump/" class="post-title-link" itemprop="url">zjump</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sql%E5%AE%A1%E6%A0%B8/" itemprop="url" rel="index"><span itemprop="name">sql审核</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<h2 id="项目开发背景"><a href="#项目开发背景" class="headerlink" title="项目开发背景"></a>项目开发背景</h2><pre><code>由于最近线上补单，数据修改，等人工操作频繁。每次都要发邮件手动执行，很容易导致出错，  
没有很好的历史纪录。而且浪费时间。虽然后台系统在不停完善，但是那些功能都是死的，无法针对所有sql。  
所以本人就写了dbtool这个web数据库管理后台。  
</code></pre>
<h2 id="项目开发目标"><a href="#项目开发目标" class="headerlink" title="项目开发目标"></a>项目开发目标</h2><pre><code>web端数据查询
web端sql检测，保证每次线上执行的sql准确性，时实性
每次检测sql将在从库执行，但不commit，返回sql将会影响的行数，sql执行状态等。然后rollback。
开发提交sql，主管审核，最后运维确认执行或者作废。所有sql提交，审核，执行。等状态记录。（后续添加更详细的流程，比如修改数据超过1000行需要总监审核等）
Sql执行时间记录
统计哪些表修改最频繁，说明涉及该表的需要优化（后续计划）
Sql语法高亮(后续计划)
</code></pre>
<h2 id="项目的开发方法"><a href="#项目的开发方法" class="headerlink" title="项目的开发方法"></a>项目的开发方法</h2><pre><code>本系统采用在jumpserver开源堡垒机上面二次开发。省去大量开发时间。  
登陆，权限验证等都采用jumpserver的。快速实现公司需要的功能  
</code></pre>
<h2 id="项目用到的知识"><a href="#项目用到的知识" class="headerlink" title="项目用到的知识"></a>项目用到的知识</h2><pre><code>Python,django, tornado,javascript, jquery,easyui等  
</code></pre>
<h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><pre><code>Git 地址  https://github.com/xskh2007/zjump 
QQ群：391096485
</code></pre>
<h2 id="项目心得"><a href="#项目心得" class="headerlink" title="项目心得"></a>项目心得</h2><pre><code>这是我第一次做项目，也是第一次二次开发开源项目，在这之前我甚至不会jq，不会js,但是看看网上demo,依葫芦画瓢也算实现基本功能了。
我觉的看别人的代码对提高自己有很大帮助。有一次跟一同事聊高中学习的事，他说他以前都不会写作文，至从跟语文课代表坐一起，
看了他的作文后，忽然恍然大悟，原来作文可以这么写。其实都是套路，写代码也差不多。jumpserver的注释并不是很多，但命名还是能看出大概作用。
</code></pre>
<h2 id="项目功能附图"><a href="#项目功能附图" class="headerlink" title="项目功能附图"></a>项目功能附图</h2><h4 id="线上sql查询界面"><a href="#线上sql查询界面" class="headerlink" title="线上sql查询界面"></a>线上sql查询界面</h4><p><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/zjump/select.jpg" alt="Screenshot"> </p>
<h4 id="线上sql检测界面"><a href="#线上sql检测界面" class="headerlink" title="线上sql检测界面"></a>线上sql检测界面</h4><p><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/zjump/check.png" alt="Screenshot"> </p>
<h4 id="线上sql提交界面"><a href="#线上sql提交界面" class="headerlink" title="线上sql提交界面"></a>线上sql提交界面</h4><p><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/zjump/submit.png" alt="Screenshot"> </p>
<h4 id="线上sql操作界面，可以执行，和作废"><a href="#线上sql操作界面，可以执行，和作废" class="headerlink" title="线上sql操作界面，可以执行，和作废"></a>线上sql操作界面，可以执行，和作废</h4><p><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/zjump/deail_list.png" alt="Screenshot"> </p>
<h4 id="具体sql查看界面"><a href="#具体sql查看界面" class="headerlink" title="具体sql查看界面"></a>具体sql查看界面</h4><p><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/zjump/deail.png" alt="Screenshot"> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">qiantu</p>
  <div class="site-description" itemprop="description">You think you can, you can.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qiantu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
