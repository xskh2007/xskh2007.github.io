<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="You think you can, you can.">
<meta property="og:type" content="website">
<meta property="og:title" content="向山看海">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="向山看海">
<meta property="og:description" content="You think you can, you can.">
<meta property="og:locale">
<meta property="article:author" content="qiantu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>向山看海</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">向山看海</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-zjump">

    <a href="/zjump/" rel="section"><i class="fa fa-zjump fa-fw"></i>zjump</a>

  </li>
        <li class="menu-item menu-item-envmanage">

    <a href="/envmanage/" rel="section"><i class="fa fa-envmanage fa-fw"></i>envmanage</a>

  </li>
        <li class="menu-item menu-item-nginxadmin">

    <a href="/nginxadmin/" rel="section"><i class="fa fa-nginxadmin fa-fw"></i>nginxadmin</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-archives fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-zjump fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-about fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-books">

    <a href="/books/" rel="section"><i class="fa fa-books fa-fw"></i>books</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/PowerCLI%20%E6%89%B9%E9%87%8F%E5%85%8B%E9%9A%86%EF%BC%8C%E6%89%B9%E9%87%8F%E9%85%8Dip%EF%BC%8C%E6%89%B9%E9%87%8F%E9%87%8D%E5%90%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/PowerCLI%20%E6%89%B9%E9%87%8F%E5%85%8B%E9%9A%86%EF%BC%8C%E6%89%B9%E9%87%8F%E9%85%8Dip%EF%BC%8C%E6%89%B9%E9%87%8F%E9%87%8D%E5%90%AF/" class="post-title-link" itemprop="url">PowerCLI 批量克隆，批量配ip，批量重启</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PowerCLI/" itemprop="url" rel="index"><span itemprop="name">PowerCLI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<h3 id="PowerCLI-批量克隆，批量配ip，批量重启"><a href="#PowerCLI-批量克隆，批量配ip，批量重启" class="headerlink" title="PowerCLI 批量克隆，批量配ip，批量重启"></a>PowerCLI 批量克隆，批量配ip，批量重启</h3><pre><code>#          Welcome to VMware vSphere PowerCLI!
#
#Log in to a vCenter Server or ESX host:              Connect-VIServer
#To find out what commands are available, type:       Get-VICommand
#To show searchable help for all PowerCLI commands:   Get-PowerCLIHelp
#Once you&#39;ve connected, display all virtual machines: Get-VM
#If you need more help, visit the PowerCLI community: Get-PowerCLICommunity


$vc = &#39;172.17.1.2&#39;
Connect-VIServer -Server $vc -username &quot;administrator&quot; -Password &quot;12345&quot;

$vmhost=&quot;172.17.1.10&quot;
$template=&quot;172.17.2.12.tomcat_template&quot;
$datastore=&quot;datastore2 (2)&quot;
#$datastore=&quot;datastore2 (1)&quot;
#$custsysprep = Get-OSCustomizationSpec myCustSpec
$resourcepool=&quot;server1&quot;
$sourcefile=&quot;C:\powercli\vmlist1.txt&quot;
$desfile=&quot;/tmp/&quot;
$vm_list=&quot;C:\powercli\vmlist2.txt&quot;
#Copy-VMGuestFile -Source C:\powercli\vmlist1.txt -Destination /tmp/ -VM 172.17.2.101_weapon -LocalToGuest -GuestUser nbj -GuestPassword Zzjr@2016

function MyCopyFile()
&#123;
for($file=[IO.File]::OpenText($vm_list);!($file.EndOfStream);$line=$file.ReadLine() )
&#123;
    #$line;
    #New-vm -vmhost $vmhost -Name $line -Template $template -Datastore $datastore -ResourcePool $resourcepool
    #start-vm $line
    CreateEth0($line)
    Copy-VMGuestFile -Source C:\powercli\ifcfg-eth0 -Destination /etc/sysconfig/network-scripts/ -VM $line -LocalToGuest -Force -GuestUser root -GuestPassword Zzjr#2016
    Copy-VMGuestFile -Source C:\powercli\70-persistent-net.rules -Destination /etc/udev/rules.d/ -VM $line -LocalToGuest -Force -GuestUser root -GuestPassword Zzjr#2016
    #stop-vm $line
    #Copy-VMGuestFile -Source $Sourcefile -Destination 
    #Copy-VMGuestFile -Source C:\powercli\vmlist1.txt -Destination /tmp/ -VM 172.17.2.101_weapon  -GuestUser nbj -GuestPassword Zzjr@2016

&#125;
$file.Close()
&#125;

function CreateEth0($vmname)
&#123;
$str = @&quot;
DEVICE=eth0
TYPE=Ethernet
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=static
NETMASK=255.255.255.0
GATEWAY=172.17.2.1
&quot;@

$ipaddr=&quot;IPADDR=&quot;
$ip=$vmname -replace &quot;_.*$&quot;
$ip_str=$ipaddr + $ip
$str|Out-File -filepath C:\powercli\ifcfg-eth0 -Encoding ascii 
$ip_str|Out-File  -filepath C:\powercli\ifcfg-eth0 -Encoding ascii -Append
[IO.File]::ReadAllText(&quot;C:\powercli\ifcfg-eth0&quot;) -replace &quot;`r`n&quot;, &quot;`n&quot;|Out-File -filepath C:\powercli\ifcfg-eth0 -Encoding ascii
$rules=&quot;#create by qiantu&quot;
$rules|Out-File  -filepath C:\powercli\70-persistent-net.rules -Encoding ascii
&#125;


function restart()
&#123;
for($file=[IO.File]::OpenText($vm_list);!($file.EndOfStream);$line=$file.ReadLine() )
&#123;
    #$line;
    #New-vm -vmhost $vmhost -Name $line -Template $template -Datastore $datastore -ResourcePool $resourcepool
    restart-vm $line
    #stop-vm $line
    #Copy-VMGuestFile -Source $Sourcefile -Destination 
    #Copy-VMGuestFile -Source C:\powercli\vmlist1.txt -Destination /tmp/ -VM 172.17.2.101_weapon  -GuestUser nbj -GuestPassword Zzjr@2016

&#125;
$file.Close()
&#125;

restart
#MyCopyFile
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/rocketmq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/rocketmq/" class="post-title-link" itemprop="url">RocketMQ-Console-Ng  how to install</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/rocketmq/" itemprop="url" rel="index"><span itemprop="name">rocketmq</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->




<h1 id="RocketMQ-Console-Ng-how-to-install"><a href="#RocketMQ-Console-Ng-how-to-install" class="headerlink" title="RocketMQ-Console-Ng  how to install"></a>RocketMQ-Console-Ng  how to install</h1><pre><code>git clone https://github.com/apache/incubator-rocketmq-externals.git
cd incubator-rocketmq-externals
cd rocketmq-console
mvn clean package -Dmaven.test.skip=true
java -jar -Drocketmq.namesrv.addr=192.168.1.24:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false rocketmq-console-ng-1.0.0.jar
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/hadoop%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/hadoop%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">hadoop群集安装(亲测)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hadoop/" itemprop="url" rel="index"><span itemprop="name">hadoop</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->




<h4 id="基本说明"><a href="#基本说明" class="headerlink" title="基本说明"></a>基本说明</h4><p>原文地址： <a href="http://blog.csdn.net/vinsuan1993/article/details/70155112">http://blog.csdn.net/vinsuan1993/article/details/70155112</a></p>
<p>hadoop2.0已经发布了稳定版本了，增加了很多特性，比如HDFS HA、YARN等。</p>
<p>注意：apache提供的hadoop-2.2.0的安装包是在32位操作系统编译的，因为hadoop依赖一些C++的本地库，<br>所以如果在64位的操作上安装hadoop-2.2.0就需要重新在64操作系统上重新编译<br>（建议第一次安装用32位的系统，我将编译好的64位的也上传到群共享里了，如果有兴趣的可以自己编译一下）</p>
<h4 id="前期准备就不详细说了，课堂上都介绍了"><a href="#前期准备就不详细说了，课堂上都介绍了" class="headerlink" title="前期准备就不详细说了，课堂上都介绍了"></a>前期准备就不详细说了，课堂上都介绍了</h4><ul>
<li>1.修改Linux主机名</li>
<li>2.修改IP</li>
<li>3.修改主机名和IP的映射关系<br>   ######注意######如果你们公司是租用的服务器或是使用的云主机（如华为用主机、阿里云主机等）<br>   &#x2F;etc&#x2F;hosts里面要配置的是内网IP地址和主机名的映射关系    </li>
<li>4.关闭防火墙</li>
<li>5.ssh免登陆</li>
<li>6.安装JDK，配置环境变量等</li>
</ul>
<h4 id="集群规划："><a href="#集群规划：" class="headerlink" title="集群规划："></a>集群规划：</h4><pre><code> 主机名          IP                    安装的软件                                        运行的进程
 itcast01     192.168.1.201     jdk、hadoop                             NameNode、DFSZKFailoverController
 itcast02     192.168.1.202     jdk、hadoop                             NameNode、DFSZKFailoverController
 itcast03     192.168.1.203     jdk、hadoop                             ResourceManager
 itcast04     192.168.1.204     jdk、hadoop、zookeeper          DataNode、NodeManager、JournalNode、QuorumPeerMain
 itcast05     192.168.1.205     jdk、hadoop、zookeeper          DataNode、NodeManager、JournalNode、QuorumPeerMain
 itcast06     192.168.1.206     jdk、hadoop、zookeeper          DataNode、NodeManager、JournalNode、QuorumPeerMain
</code></pre>
<h4 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h4><pre><code> 在hadoop2.0中通常由两个NameNode组成，一个处于active状态，另一个处于standby状态。Active NameNode对外提供服务，而Standby NameNode则不对外提供服务，仅同步active namenode的状态，以便能够在它失败时快速进行切换。
 hadoop2.0官方提供了两种HDFS HA的解决方案，一种是NFS，另一种是QJM。这里我们使用简单的QJM。在该方案中，主备NameNode之间通过一组JournalNode同步元数据信息，一条数据只要成功写入多数JournalNode即认为写入成功。通常配置奇数个JournalNode
 这里还配置了一个zookeeper集群，用于ZKFC（DFSZKFailoverController）故障转移，当Active NameNode挂掉了，会自动切换Standby NameNode为standby状态
</code></pre>
<h4 id="安装步骤："><a href="#安装步骤：" class="headerlink" title="安装步骤："></a>安装步骤：</h4><pre><code> 1.安装配置zooekeeper集群
      1.1解压
           tar -zxvf zookeeper-3.4.5.tar.gz -C /itcast/
      1.2修改配置
           cd /itcast/zookeeper-3.4.5/conf/
           cp zoo_sample.cfg zoo.cfg
           vim zoo.cfg
           修改：dataDir=/itcast/zookeeper-3.4.5/tmp
           在最后添加：
           server.1=itcast04:2888:3888
           server.2=itcast05:2888:3888
           server.3=itcast06:2888:3888
           保存退出
           然后创建一个tmp文件夹
           mkdir /itcast/zookeeper-3.4.5/tmp
           再创建一个空文件
           touch /itcast/zookeeper-3.4.5/tmp/myid
           最后向该文件写入ID
           echo 1 &gt; /itcast/zookeeper-3.4.5/tmp/myid
      1.3将配置好的zookeeper拷贝到其他节点(首先分别在itcast05、itcast06根目录下创建一个itcast目录：mkdir /itcast)
           scp -r /itcast/zookeeper-3.4.5/ itcast05:/itcast/
           scp -r /itcast/zookeeper-3.4.5/ itcast06:/itcast/
          
           注意：修改itcast05、itcast06对应/itcast/zookeeper-3.4.5/tmp/myid内容
           itcast05：
                echo 2 &gt; /itcast/zookeeper-3.4.5/tmp/myid
           itcast06：
                echo 3 &gt; /itcast/zookeeper-3.4.5/tmp/myid

 2.安装配置hadoop集群
      2.1解压
           tar -zxvf hadoop-2.2.0.tar.gz -C /itcast/
      2.2配置HDFS（hadoop2.0所有的配置文件都在$HADOOP_HOME/etc/hadoop目录下）
           #将hadoop添加到环境变量中
           vim /etc/profile
           export JAVA_HOME=/usr/java/jdk1.7.0_55
           export HADOOP_HOME=/itcast/hadoop-2.2.0
           export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin
          
           #hadoop2.0的配置文件全部在$HADOOP_HOME/etc/hadoop下
           cd /itcast/hadoop-2.2.0/etc/hadoop
          
           2.2.1修改hadoo-env.sh
                export JAVA_HOME=/usr/java/jdk1.7.0_55
               
           2.2.2修改core-site.xml
                &lt;configuration&gt;
                     &lt;!-- 指定hdfs的nameservice为ns1 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;fs.defaultFS&lt;/name&gt;
                          &lt;value&gt;hdfs://ns1&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 指定hadoop临时目录 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
                          &lt;value&gt;/itcast/hadoop-2.2.0/tmp&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 指定zookeeper地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;ha.zookeeper.quorum&lt;/name&gt;
                          &lt;value&gt;itcast04:2181,itcast05:2181,itcast06:2181&lt;/value&gt;
                     &lt;/property&gt;
                &lt;/configuration&gt;
               
           2.2.3修改hdfs-site.xml
                &lt;configuration&gt;
                     &lt;!--指定hdfs的nameservice为ns1，需要和core-site.xml中的保持一致 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.nameservices&lt;/name&gt;
                          &lt;value&gt;ns1&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- ns1下面有两个NameNode，分别是nn1，nn2 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.ha.namenodes.ns1&lt;/name&gt;
                          &lt;value&gt;nn1,nn2&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- nn1的RPC通信地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.namenode.rpc-address.ns1.nn1&lt;/name&gt;
                          &lt;value&gt;itcast01:9000&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- nn1的http通信地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.namenode.http-address.ns1.nn1&lt;/name&gt;
                          &lt;value&gt;itcast01:50070&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- nn2的RPC通信地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.namenode.rpc-address.ns1.nn2&lt;/name&gt;
                          &lt;value&gt;itcast02:9000&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- nn2的http通信地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.namenode.http-address.ns1.nn2&lt;/name&gt;
                          &lt;value&gt;itcast02:50070&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 指定NameNode的元数据在JournalNode上的存放位置 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt;
                          &lt;value&gt;qjournal://itcast04:8485;itcast05:8485;itcast06:8485/ns1&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 指定JournalNode在本地磁盘存放数据的位置 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.journalnode.edits.dir&lt;/name&gt;
                          &lt;value&gt;/itcast/hadoop-2.2.0/journal&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 开启NameNode失败自动切换 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt;
                          &lt;value&gt;true&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 配置失败自动切换实现方式 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.client.failover.proxy.provider.ns1&lt;/name&gt;
                          &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 配置隔离机制方法，多个机制用换行分割，即每个机制暂用一行--&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.ha.fencing.methods&lt;/name&gt;
                          &lt;value&gt;
                               sshfence
                               shell(/bin/true)
                          &lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 使用sshfence隔离机制时需要ssh免登陆 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.ha.fencing.ssh.private-key-files&lt;/name&gt;
                          &lt;value&gt;/root/.ssh/id_rsa&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 配置sshfence隔离机制超时时间 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.ha.fencing.ssh.connect-timeout&lt;/name&gt;
                          &lt;value&gt;30000&lt;/value&gt;
                     &lt;/property&gt;
                &lt;/configuration&gt;
          
           2.2.4修改mapred-site.xml
                &lt;configuration&gt;
                     &lt;!-- 指定mr框架为yarn方式 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
                          &lt;value&gt;yarn&lt;/value&gt;
                     &lt;/property&gt;
                &lt;/configuration&gt;    
          
           2.2.5修改yarn-site.xml
                &lt;configuration&gt;
                     &lt;!-- 指定resourcemanager地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;
                          &lt;value&gt;itcast03&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 指定nodemanager启动时加载server的方式为shuffle server --&gt;
                     &lt;property&gt;
                          &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
                          &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
                     &lt;/property&gt;
                &lt;/configuration&gt;
          
               
           2.2.6修改slaves(slaves是指定子节点的位置，因为要在itcast01上启动HDFS、在itcast03启动yarn，所以itcast01上的slaves文件指定的是datanode的位置，itcast03上的slaves文件指定的是nodemanager的位置)
                itcast04
                itcast05
                itcast06

           2.2.7配置免密码登陆
                #首先要配置itcast01到itcast02、itcast03、itcast04、itcast05、itcast06的免密码登陆
                #在itcast01上生产一对钥匙
                ssh-keygen -t rsa
                #将公钥拷贝到其他节点，包括自己
                ssh-coyp-id itcast01
                ssh-coyp-id itcast02
                ssh-coyp-id itcast03
                ssh-coyp-id itcast04
                ssh-coyp-id itcast05
                ssh-coyp-id itcast06
               
                #配置itcast03到itcast04、itcast05、itcast06的免密码登陆
                #在itcast03上生产一对钥匙
                ssh-keygen -t rsa
                #将公钥拷贝到其他节点
                ssh-coyp-id itcast04
                ssh-coyp-id itcast05
                ssh-coyp-id itcast06
               
                #注意：两个namenode之间要配置ssh免密码登陆，别忘了配置itcast02到itcast01的免登陆
                在itcast02上生产一对钥匙
                ssh-keygen -t rsa
                ssh-coyp-id -i itcast01                   
     
      2.4将配置好的hadoop拷贝到其他节点
           scp -r /itcast/ itcast02:/
           scp -r /itcast/ itcast03:/
           scp -r /itcast/hadoop-2.2.0/ root@itcast04:/itcast/
           scp -r /itcast/hadoop-2.2.0/ root@itcast05:/itcast/
           scp -r /itcast/hadoop-2.2.0/ root@itcast06:/itcast/
     
      ###注意：严格按照下面的步骤
      2.5启动zookeeper集群（分别在itcast04、itcast05、itcast06上启动zk）
           cd /itcast/zookeeper-3.4.5/bin/
           ./zkServer.sh start
           #查看状态：一个leader，两个follower
           ./zkServer.sh status
          
      2.6启动journalnode（在itcast01上启动所有journalnode，注意：是调用的hadoop-daemons.sh这个脚本，注意是复数s的那个脚本）
           cd /itcast/hadoop-2.2.0
           sbin/hadoop-daemons.sh start journalnode  先执行这个，再执行 hdfs namenode -format
           #运行jps命令检验，itcast04、itcast05、itcast06上多了JournalNode进程
     
      2.7格式化HDFS
           #在itcast01上执行命令:
           hdfs namenode -format
           #格式化后会在根据core-site.xml中的hadoop.tmp.dir配置生成个文件，这里我配置的是/itcast/hadoop-2.2.0/tmp，然后将/itcast/hadoop-2.2.0/tmp拷贝到itcast02的/itcast/hadoop-2.2.0/下。
           scp -r tmp/ itcast02:/itcast/hadoop-2.2.0/
     
      2.8格式化ZK(在itcast01上执行即可)
           hdfs zkfc -formatZK
     
      2.9启动HDFS(在itcast01上执行)
           sbin/start-dfs.sh

      2.10启动YARN(#####注意#####：是在itcast03上执行start-yarn.sh，把namenode和resourcemanager分开是因为性能问题，因为他们都要占用大量资源，所以把他们分开了，他们分开了就要分别在不同的机器上启动)
           sbin/start-yarn.sh

 到此，hadoop2.2.0配置完毕，可以统计浏览器访问:
      http://192.168.1.201:50070
      NameNode &#39;itcast01:9000&#39; (active)
      http://192.168.1.202:50070
      NameNode &#39;itcast02:9000&#39; (standby)

 验证HDFS HA
      首先向hdfs上传一个文件
      hadoop fs -put /etc/profile /profile
      hadoop fs -ls /
      然后再kill掉active的NameNode
      kill -9 &lt;pid of NN&gt;
      通过浏览器访问：http://192.168.1.202:50070
      NameNode &#39;itcast02:9000&#39; (active)
      这个时候itcast02上的NameNode变成了active
      在执行命令：
      hadoop fs -ls /
      -rw-r--r--   3 root supergroup       1926 2014-02-06 15:36 /profile
      刚才上传的文件依然存在！！！
      手动启动那个挂掉的NameNode
      sbin/hadoop-daemon.sh start namenode
      通过浏览器访问：http://192.168.1.201:50070
      NameNode &#39;itcast01:9000&#39; (standby)

 验证YARN：
      运行一下hadoop提供的demo中的WordCount程序：
      hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.2.0.jar wordcount /profile /out

 OK，大功告成！！！
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/sls_api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/sls_api/" class="post-title-link" itemprop="url">sls_api</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 18:20:33" itemprop="dateModified" datetime="2023-12-05T18:20:33+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sls-api/" itemprop="url" rel="index"><span itemprop="name">sls_api</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->


<p><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/sls/sls1.jpg" alt="Screenshot"><br><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/sls/sls2.jpg" alt="Screenshot"><br><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/sls/sls3.jpg" alt="Screenshot"> </p>
<h1 id="3分钟内api接口耗时超过200ms，且数量超过10个（不包括apiname为精品-从购物车或商品详情页下单订单确认页数据）"><a href="#3分钟内api接口耗时超过200ms，且数量超过10个（不包括apiname为精品-从购物车或商品详情页下单订单确认页数据）" class="headerlink" title="3分钟内api接口耗时超过200ms，且数量超过10个（不包括apiname为精品_从购物车或商品详情页下单订单确认页数据）"></a>3分钟内api接口耗时超过200ms，且数量超过10个（不包括apiname为精品_从购物车或商品详情页下单订单确认页数据）</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* and apiGroupName : lkmall_prod and totalLatency &gt;200 not apiName:&#x27;精品_从购物车或商品详情页下单订单确认页数据&#x27; |select apiName ,COUNT(*) as apicount ,max(totalLatency) as apimax group by apiName HAVING apicount &gt; 10</span><br></pre></td></tr></table></figure>

<h1 id="15分钟内api接口状态非200，且数量超过10个"><a href="#15分钟内api接口状态非200，且数量超过10个" class="headerlink" title="15分钟内api接口状态非200，且数量超过10个"></a>15分钟内api接口状态非200，且数量超过10个</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* and apiGroupName : lkmall_prod and not statusCode : 200  |select path ,statusCode as statusCode, COUNT(*) as apicount group by path,statusCode HAVING apicount &gt; 10</span><br></pre></td></tr></table></figure>

<h1 id="1分钟内api接口总数量超过1000个"><a href="#1分钟内api接口总数量超过1000个" class="headerlink" title="1分钟内api接口总数量超过1000个"></a>1分钟内api接口总数量超过1000个</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* and apiGroupName : lkmall_prod  |select apiName ,COUNT(*) as apicount   group by apiName HAVING apicount &gt; 1000</span><br></pre></td></tr></table></figure>

<h1 id="1分钟-接口响应超过5秒-10次-或者1分钟-接口状态-503、504、500-10次-或者1分钟-接口状态不为-200-50次"><a href="#1分钟-接口响应超过5秒-10次-或者1分钟-接口状态-503、504、500-10次-或者1分钟-接口状态不为-200-50次" class="headerlink" title="1分钟 接口响应超过5秒 10次 或者1分钟 接口状态 503、504、500 10次 或者1分钟 接口状态不为 200 50次"></a>1分钟 接口响应超过5秒 10次 或者1分钟 接口状态 503、504、500 10次 或者1分钟 接口状态不为 200 50次</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">*</span><br><span class="line">and apiGroupName : lkmall_prod |(</span><br><span class="line">select</span><br><span class="line">        path , statusCode as statusCode, COUNT(*) as apicount</span><br><span class="line">from</span><br><span class="line">        log</span><br><span class="line">group by</span><br><span class="line">        path, statusCode</span><br><span class="line">HAVING</span><br><span class="line">        apicount &gt; 50</span><br><span class="line">        and statusCode &lt;&gt; 200)</span><br><span class="line">UNION (</span><br><span class="line">select</span><br><span class="line">path , statusCode as statusCode, COUNT(*) as apicount</span><br><span class="line">from</span><br><span class="line">log</span><br><span class="line">group by</span><br><span class="line">path, statusCode</span><br><span class="line">HAVING</span><br><span class="line">apicount &gt; 10</span><br><span class="line">and statusCode in(503, 504, 500)</span><br><span class="line">UNION (</span><br><span class="line">select</span><br><span class="line">apiName , COUNT(*) as apicount , max(totalLatency) as apimax</span><br><span class="line">from</span><br><span class="line">log</span><br><span class="line">where</span><br><span class="line">totalLatency &gt;5000</span><br><span class="line">group by</span><br><span class="line">apiName</span><br><span class="line">HAVING</span><br><span class="line">apicount &gt; 10 ))</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/%E9%A2%86%E5%85%8B%E7%B2%BE%E9%80%89api%E6%AF%8F%E7%A7%92%E8%AF%B7%E6%B1%82%E6%95%B0(1%E5%88%86%E9%92%9F%E5%86%85%E6%9C%80%E5%A4%A7%E5%80%BC)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/%E9%A2%86%E5%85%8B%E7%B2%BE%E9%80%89api%E6%AF%8F%E7%A7%92%E8%AF%B7%E6%B1%82%E6%95%B0(1%E5%88%86%E9%92%9F%E5%86%85%E6%9C%80%E5%A4%A7%E5%80%BC)/" class="post-title-link" itemprop="url">领克精选api每秒请求数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 17:51:39" itemprop="dateModified" datetime="2023-12-05T17:51:39+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sls/" itemprop="url" rel="index"><span itemprop="name">sls</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">* and apiGroupName:lkmall_prod |</span><br><span class="line">select</span><br><span class="line">  max(apicount) as maxcount,</span><br><span class="line">  substr(a1, 1, 16)</span><br><span class="line">from</span><br><span class="line">  (</span><br><span class="line">    SELECT</span><br><span class="line">      count(1) as apicount,</span><br><span class="line">      date_format(</span><br><span class="line">        date_add(</span><br><span class="line">          &#x27;hour&#x27;,</span><br><span class="line">          8,</span><br><span class="line">          date_parse (</span><br><span class="line">            split_part (requestHandleTime, &#x27;.&#x27;, 1),</span><br><span class="line">            &#x27;%Y-%m-%dT%H:%i:%s&#x27;</span><br><span class="line">          )</span><br><span class="line">        ),</span><br><span class="line">        &#x27;%Y-%m-%d %H:%i:%s&#x27;</span><br><span class="line">      ) as a1</span><br><span class="line">    from</span><br><span class="line">      log</span><br><span class="line">    GROUP by</span><br><span class="line">      split_part (requestHandleTime, &#x27;.&#x27;, 1)</span><br><span class="line">  ) as qiantu</span><br><span class="line">group by</span><br><span class="line">  substr(a1, 1, 16)</span><br></pre></td></tr></table></figure>
<h1 id="优化后显示具体path-top5"><a href="#优化后显示具体path-top5" class="headerlink" title="优化后显示具体path top5"></a>优化后显示具体path top5</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">* and apiGroupName:lkmall_prod | </span><br><span class="line">with</span><br><span class="line">  T1 AS (</span><br><span class="line">    SELECT</span><br><span class="line">      count(1) as apicount,</span><br><span class="line">      DATE_FORMAT(__time__, &#x27;%Y-%m-%d %H:%i:%s&#x27;) as apitime</span><br><span class="line">    from</span><br><span class="line">      log</span><br><span class="line">    where</span><br><span class="line">      __time__ &lt; to_unixtime(date_add(&#x27;minute&#x27;, -1, now()))  AND __time__ &gt; to_unixtime(date_add(&#x27;minute&#x27;, -2, now()))</span><br><span class="line">    GROUP by</span><br><span class="line">      DATE_FORMAT(__time__, &#x27;%Y-%m-%d %H:%i:%s&#x27;)</span><br><span class="line">  ),</span><br><span class="line">  T2 AS (</span><br><span class="line">    SELECT</span><br><span class="line">      max(T1.apicount) as maxcount</span><br><span class="line">    FROM</span><br><span class="line">      T1</span><br><span class="line">  ),</span><br><span class="line">  T3 AS (</span><br><span class="line">    SELECT</span><br><span class="line">      count(1) as apicount,</span><br><span class="line">      DATE_FORMAT(__time__, &#x27;%Y-%m-%d %H:%i:%s&#x27;) as apitime,</span><br><span class="line">      path</span><br><span class="line">    from</span><br><span class="line">      log</span><br><span class="line">    GROUP by</span><br><span class="line">      DATE_FORMAT(__time__, &#x27;%Y-%m-%d %H:%i:%s&#x27;),</span><br><span class="line">      path</span><br><span class="line">  )</span><br><span class="line">select</span><br><span class="line">  T2.maxcount,</span><br><span class="line">  T3.*</span><br><span class="line">from</span><br><span class="line">  T1</span><br><span class="line">  JOIN T2 ON T1.apicount = T2.maxcount</span><br><span class="line">  JOIN T3 ON T1.apitime = T3.apitime</span><br><span class="line">order by</span><br><span class="line">  T3.apicount desc</span><br><span class="line">limit</span><br><span class="line">  5</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/cloud/ceph%E8%BF%99%E6%AC%BE%E4%BA%91%E5%AD%98%E5%82%A8%E6%8A%80%E6%9C%AF%E6%80%8E%E4%B9%88%E6%A0%B7%EF%BC%9F%E5%92%8Cswift%E3%80%81hdfs%E7%9B%B8%E6%AF%94%E5%A6%82%E4%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/cloud/ceph%E8%BF%99%E6%AC%BE%E4%BA%91%E5%AD%98%E5%82%A8%E6%8A%80%E6%9C%AF%E6%80%8E%E4%B9%88%E6%A0%B7%EF%BC%9F%E5%92%8Cswift%E3%80%81hdfs%E7%9B%B8%E6%AF%94%E5%A6%82%E4%BD%95/" class="post-title-link" itemprop="url">ceph这款云存储技术怎么样？和swift、hdfs相比如何</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">分布式文件系统</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<p>Ceph是一套高性能，易扩展的，无单点的分布式文件存储系统，基于Sage A. Weil的论文开发，主要提供以下三个存储服务：</p>
<ul>
<li><blockquote>
<p>对象存储(Object Storage)，既可以通过使用Ceph的库，利用C, C++, Java, Python, PHP代码，也可以通过Restful网关以对象的形式访问或存储数据，兼容亚马逊的S3和OpenStack的Swift。</p>
</blockquote>
</li>
<li><blockquote>
<p>块存储(Block Storage)，作为块设备像硬盘一样直接挂载。</p>
</blockquote>
</li>
<li><blockquote>
<p>文件系统(File System) ，如同网络文件系统一样挂载，兼容POSIX接口。</p>
</blockquote>
</li>
</ul>
<p>Ceph的结构，对象存储由LIBRADOS和RADOSGW提供，块存储由RBD提供，文件系统由CEPH FS提供，而RADOSGW, RBD, CEPH FS均需要调用LIBRADOS的接口，而最终都是以对象的形式存储于RADOS里。</p>
<p>Ceph集群的节点有三种角色：</p>
<ul>
<li><blockquote>
<p>Monitor，监控集群的健康状况，向客户端发送最新的CRUSH map(含有当前网络的拓扑结构)</p>
</blockquote>
</li>
<li><blockquote>
<p>OSD，维护节点上的对象，响应客户端请求，与其他OSD节点同步</p>
</blockquote>
</li>
<li><blockquote>
<p>MDS，提供文件的Metadata，如果不使用CephFS可以不安装</p>
</blockquote>
</li>
</ul>
<p>Ceph是分布式的存储，它将文件分割后均匀随机地分散在各个节点上，Ceph采用了CRUSH算法来确定对象的存储位置，<br>只要有当前集群的拓扑结构，Ceph客户端就能直接计算出文件的存储位置，<br>直接跟OSD节点通信获取文件而不需要询问中心节点获得文件位置，这样就避免了单点风险。<br>更多Ceph架构方面的内容可以参看官方介绍：<br>ArchitectureCeph目前已经是一套比较成熟的存储系统了，<br>是OpenStack比较理想的存储后端，也可以作为Hadoop的存储后端，这就涉及到与Swift和HDFS的比较。</p>
<h3 id="Ceph与Swift"><a href="#Ceph与Swift" class="headerlink" title="Ceph与Swift"></a>Ceph与Swift</h3><p>Ceph用C++编写而Swift用Python编写，性能上应当是Ceph占优。<br>但是与Ceph不同，Swift专注于对象存储，作为OpenStack组件之一经过大量生产实践的验证，<br>与OpenStack结合很好，目前不少人使用Ceph为OpenStack提供块存储，但仍旧使用Swift提供对象存储。<br>Swift的开发者曾写过文章对比Ceph和Swift: Ceph and Swift: Why we are not fighting.</p>
<h3 id="Ceph与HDFS"><a href="#Ceph与HDFS" class="headerlink" title="Ceph与HDFS"></a>Ceph与HDFS</h3><p>Ceph对比HDFS优势在于易扩展，无单点。HDFS是专门为Hadoop这样的云计算而生，<br>在离线批量处理大数据上有先天的优势，而Ceph是一个通用的实时存储系统。<br>虽然Hadoop可以利用Ceph作为存储后端（根据Ceph官方的教程死活整合不了，自己写了个简洁的步骤:<a href="http://www.kai-zhang.com/cloud-computing/Running-Hadoop-on-CEPH/%EF%BC%89%EF%BC%8C">http://www.kai-zhang.com/cloud-computing/Running-Hadoop-on-CEPH/），</a><br>但执行计算任务上性能还是略逊于HDFS（时间上慢30%左右 Haceph: Scalable Meta- data Management for Hadoop using Ceph）。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/cloud/k8s/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/cloud/k8s/" class="post-title-link" itemprop="url">Kubernetes 安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<h4 id="Kubernetes-Components"><a href="#Kubernetes-Components" class="headerlink" title="Kubernetes Components"></a>Kubernetes Components</h4><p>Kubernetes works in server-client setup, where it has a master providing centralized control for a number of minions. We will be deploying a Kubernetes master with three minions, as illustrated in the diagram further below.</p>
<p>Kubernetes has several components: </p>
<ul>
<li>etcd - A highly available key-value store for shared configuration and service discovery.</li>
<li>flannel - An etcd backed network fabric for containers.</li>
<li>kube-apiserver - Provides the API for Kubernetes orchestration.</li>
<li>kube-controller-manager - Enforces Kubernetes services.</li>
<li>kube-scheduler - Schedules containers on hosts.</li>
<li>kubelet - Processes a container manifest so the containers are launched according to how they are described.</li>
<li>kube-proxy - Provides network proxy services.</li>
</ul>
<h4 id="Deployment-on-CentOS-7"><a href="#Deployment-on-CentOS-7" class="headerlink" title="Deployment on CentOS 7"></a>Deployment on CentOS 7</h4><p>We will need 4 servers, running on CentOS 7.1 64 bit with minimal install. All components are available directly from the CentOS extras repository which is enabled by default. The following architecture diagram illustrates where the Kubernetes components should reside:</p>
<p><img src="http://note.youdao.com/favicon.ico" alt="image"></p>
<h4 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h4><ol>
<li><p>Disable iptables on each node to avoid conflicts with Docker iptables rules:</p>
<p> $ systemctl stop firewalld<br> $ systemctl disable firewalld</p>
</li>
<li><p>Install NTP and make sure it is enabled and running:</p>
<p> $ yum -y install ntp<br> $ systemctl start ntpd<br> $ systemctl enable ntpd</p>
</li>
</ol>
<h4 id="Setting-up-the-Kubernetes-Master"><a href="#Setting-up-the-Kubernetes-Master" class="headerlink" title="Setting up the Kubernetes Master"></a>Setting up the Kubernetes Master</h4><p>The following steps should be performed on the master.</p>
<ol>
<li><p>Install etcd and Kubernetes through yum:</p>
<p> $ yum -y install etcd kubernetes</p>
</li>
<li><p>Configure etcd to listen to all IP addresses inside &#x2F;etc&#x2F;etcd&#x2F;etcd.conf. Ensure the following lines are uncommented, and assign the following values:</p>
<p> ETCD_NAME&#x3D;default<br> ETCD_DATA_DIR&#x3D;”&#x2F;var&#x2F;lib&#x2F;etcd&#x2F;default.etcd”<br> ETCD_LISTEN_CLIENT_URLS&#x3D;”<a href="http://0.0.0.0:2379/">http://0.0.0.0:2379</a>“<br> ETCD_ADVERTISE_CLIENT_URLS&#x3D;”<a href="http://localhost:2379/">http://localhost:2379</a>“</p>
</li>
<li><p>Configure Kubernetes API server inside &#x2F;etc&#x2F;kubernetes&#x2F;apiserver. Ensure the following lines are uncommented, and assign the following values:</p>
<p> KUBE_API_ADDRESS&#x3D;”–address&#x3D;0.0.0.0”<br> KUBE_API_PORT&#x3D;”–port&#x3D;8080”<br> KUBELET_PORT&#x3D;”–kubelet_port&#x3D;10250”<br> KUBE_ETCD_SERVERS&#x3D;”–etcd_servers&#x3D;<a href="http://0.0.0.127/">http://127</a>    .0.0.1:2379”<br> KUBE_SERVICE_ADDRESSES&#x3D;”–service-cluster-ip    -range&#x3D;10.254.0.0&#x2F;16”<br> KUBE_ADMISSION_CONTROL&#x3D;”–admission_control&#x3D;    NamespaceLifecycle,NamespaceExists,LimitRang    er,SecurityContextDeny,ResourceQuota”<br> KUBE_API_ARGS&#x3D;””</p>
</li>
<li><p>Start and enable etcd, kube-apiserver, kube-controller-manager and kube-scheduler:</p>
<p> $ for SERVICES in etcd kube-apiserver kube-controller-manager kube-scheduler; do<br> systemctl restart $SERVICES<br> systemctl enable $SERVICES<br> systemctl status $SERVICES<br> done</p>
</li>
<li><p>Define flannel network configuration in etcd. This configuration will be pulled by flannel service on minions:</p>
<p> $ etcdctl mk &#x2F;atomic.io&#x2F;network&#x2F;config ‘{“Network”:”172.17.0.0&#x2F;16”}’</p>
</li>
<li><p>At this point, we should notice that nodes’ status returns nothing because we haven’t started any of them yet:</p>
<p> $ kubectl get nodes</p>
</li>
</ol>
<p>NAME             LABELS              STATUS</p>
<h4 id="Setting-up-Kubernetes-Minions-Nodes"><a href="#Setting-up-Kubernetes-Minions-Nodes" class="headerlink" title="Setting up Kubernetes Minions (Nodes)"></a>Setting up Kubernetes Minions (Nodes)</h4><p>The following steps should be performed on minion1, minion2 and minion3 unless specified otherwise.</p>
<ol>
<li><p>Install flannel and Kubernetes using yum:</p>
<p> $ yum -y install flannel kubernetes</p>
</li>
<li><p>Configure etcd server for flannel service. Update the following line inside &#x2F;etc&#x2F;sysconfig&#x2F;flanneld to connect to the respective master:</p>
<p> FLANNEL_ETCD&#x3D;”<a href="http://192.168.50.130:2379/">http://192.168.50.130:2379</a>“<br> FLANNEL_OPTIONS&#x3D;”-iface&#x3D;ens160”</p>
</li>
<li><p>Configure Kubernetes default config at &#x2F;etc&#x2F;kubernetes&#x2F;config, ensure you update the KUBE_MASTER value to connect to the Kubernetes master API server:</p>
<p> KUBE_MASTER&#x3D;”–master&#x3D;<a href="http://192.168.50.130:8080/">http://192.168.50.130:8080</a>“</p>
</li>
<li><p>Configure kubelet service inside &#x2F;etc&#x2F;kubernetes&#x2F;kubelet as below:<br>minion1:</p>
<p> KUBELET_ADDRESS&#x3D;”–address&#x3D;0.0.0.0”<br> KUBELET_PORT&#x3D;”–port&#x3D;10250”</p>
<h1 id="change-the-hostname-to-this-host’s-IP-address"><a href="#change-the-hostname-to-this-host’s-IP-address" class="headerlink" title="change the hostname to this host’s IP     address"></a>change the hostname to this host’s IP     address</h1><p> KUBELET_HOSTNAME&#x3D;”–hostname_override&#x3D;192.1    68.50.131”<br> KUBELET_API_SERVER&#x3D;”–api_servers&#x3D;<a href="http://0.0.0.19/">http://19</a>    2.168.50.130:8080”<br> KUBELET_ARGS&#x3D;””</p>
</li>
</ol>
<p>minion2:</p>
<pre><code>KUBELET_ADDRESS=&quot;--address=0.0.0.0&quot;
KUBELET_PORT=&quot;--port=10250&quot;
# change the hostname to this host’s IP     address
KUBELET_HOSTNAME=&quot;--hostname_override=192.1    68.50.132&quot;
KUBELET_API_SERVER=&quot;--api_servers=http://19    2.168.50.130:8080&quot;
KUBELET_ARGS=&quot;&quot;
</code></pre>
<p>minion3:</p>
<pre><code>KUBELET_ADDRESS=&quot;--address=0.0.0.0&quot;
KUBELET_PORT=&quot;--port=10250&quot;
# change the hostname to this host’s IP     address
KUBELET_HOSTNAME=&quot;--hostname_override=192.1    68.50.133&quot;
KUBELET_API_SERVER=&quot;--api_servers=http://19    2.168.50.130:8080&quot;
KUBELET_ARGS=&quot;&quot;
</code></pre>
<ol start="5">
<li><p>Start and enable kube-proxy, kubelet, docker and flanneld services:</p>
<p> $ for SERVICES in kube-proxy kubelet docker     flanneld; do<br> systemctl restart $SERVICES<br> systemctl enable $SERVICES<br> systemctl status $SERVICES<br> done    </p>
</li>
<li><p>On each minion, you should notice that you will have two new interfaces added, docker0 and flannel0. You should get different range of IP addresses on flannel0 interface on each minion, similar to below:<br>minion1:</p>
<p> $ ip a | grep flannel | grep inet<br> inet 172.17.45.0&#x2F;16 scope global flannel0</p>
</li>
</ol>
<p>minion2:</p>
<pre><code>$ ip a | grep flannel | grep inet
inet 172.17.38.0/16 scope global flannel0
</code></pre>
<p>minion3:</p>
<pre><code>$ ip a | grep flannel | grep inet
inet 172.17.93.0/16 scope global flannel0
</code></pre>
<ol start="6">
<li><p>Now login to Kubernetes master node and verify the minions’ status:</p>
<p> $ kubectl get nodes<br> NAME             LABELS                                  STATUS<br> 192.168.50.131   kubernetes.io&#x2F;hostname&#x3D;192.168.50.131   Ready<br> 192.168.50.132   kubernetes.io&#x2F;hostname&#x3D;192.168.50.132   Ready<br> 192.168.50.133   kubernetes.io&#x2F;hostname&#x3D;192.168.50.133   Ready</p>
</li>
</ol>
<p>You are now set. The Kubernetes cluster is now configured and running. We can start to play around with pods.</p>
<h4 id="Creating-Pods-Containers"><a href="#Creating-Pods-Containers" class="headerlink" title="Creating Pods (Containers)"></a>Creating Pods (Containers)</h4><p>To create a pod, we need to define a yaml file in the Kubernetes master, and use the kubectl command to create it based on the definition. Create a mysql.yaml file: </p>
<pre><code>$ mkdir pods
$ cd pods
$ vim mysql.yaml
</code></pre>
<p>And add the following lines:</p>
<pre><code>apiVersion: v1
kind: Pod
metadata:
  name: mysql
  labels:
    name: mysql
spec:
  containers:
    - resources:
        limits :
          cpu: 1
      image: mysql
      name: mysql
      env:
        - name: MYSQL_ROOT_PASSWORD
          # change this
          value: yourpassword
      ports:
        - containerPort: 3306
          name: mysql
          
</code></pre>
<p>Create the pod:</p>
<pre><code>$ kubectl create -f mysql.yaml
</code></pre>
<p>It may take a short period before the new pod reaches the Running state. Verify the pod is created and running:</p>
<pre><code>$ kubectl get pods
POD       IP            CONTAINER(S)   IMAGE(S)   HOST                            LABELS       STATUS    CREATED
mysql     172.17.38.2   mysql          mysql      192.168.50.132/192.168.50.132   name=mysql   Running   3 hours
</code></pre>
<p>So, Kubernetes just created a Docker container on 192.168.50.132. We now need to create a Service that lets other pods access the mysql database on a known port and host.</p>
<h4 id="Creating-Service"><a href="#Creating-Service" class="headerlink" title="Creating Service"></a>Creating Service</h4><p>At this point, we have a MySQL pod inside 192.168.50.132. Define a mysql-service.yaml as below:</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  labels:
    name: mysql
  name: mysql
spec:
  externalIPs:
    - 192.168.50.132
  ports:
    # the port that this service should serve on
    - port: 3306
    # label keys and values that must match in order to receive traffic for this service
  selector:
    name: mysql
</code></pre>
<p>Start the service:</p>
<pre><code>$ kubectl create -f mysql-service.yaml
</code></pre>
<p>You should get a 10.254.x.x IP range assigned to the mysql service. This is the Kubernetes internal IP address defined in &#x2F;etc&#x2F;kubernetes&#x2F;apiserver. This IP is not routable outside, so we defined the public IP instead (the interface that connected to external network for that minion):</p>
<pre><code>$ kubectl get services
NAME            LABELS                                    SELECTOR     IP               PORT(S)
kubernetes      component=apiserver,provider=kubernetes   &lt;none&gt;       10.254.0.2       443/TCP
kubernetes-ro   component=apiserver,provider=kubernetes   &lt;none&gt;       10.254.0.1       80/TCP
mysql           name=mysql                                name=mysql   10.254.13.156    3306/TCP
                                                                       192.168.50.132
                                                                       
                                                                       
</code></pre>
<p>Let’s connect to our database server from outside (we used MariaDB client on CentOS 7):</p>
<pre><code>$ mysql -uroot -p -h192.168.50.132
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MySQL connection id is 4
Server version: 5.6.24 MySQL Community Server (GPL)
 
Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others.
 
Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
 
MySQL [(none)]&gt; show variables like &#39;%version%&#39;;
+-------------------------+------------------------------+
| Variable_name           | Value                        |
+-------------------------+------------------------------+
| innodb_version          | 5.6.24                       |
| protocol_version        | 10                           |
| slave_type_conversions  |                              |
| version                 | 5.6.24                       |
| version_comment         | MySQL Community Server (GPL) |
| version_compile_machine | x86_64                       |
| version_compile_os      | Linux                        |
+-------------------------+------------------------------+
7 rows in set (0.01 sec)
</code></pre>
<p>That’s it! You should now be able to connect to the MySQL container that resides on minion2. </p>
<p>Check out the Kubernetes guestbook example on how to build a simple, multi-tier web application with Redis in master-slave setup. In a follow-up blog post, we are going to play around with Galera cluster containers on Kubernetes. Stay tuned!</p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ul>
<li>Creating a Kubernetes Cluster to Run Docker Formatted Container Images - <a href="https://access.redhat.com/articles/1353773">https://access.redhat.com/articles/1353773</a></li>
<li>Kubernetes Github - <a href="https://github.com/googlecloudplatform/kubernetes">https://github.com/googlecloudplatform/kubernetes</a></li>
<li>Persistent Installation of MySQL and WordPress on Kubernetes - <a href="https://github.com/GoogleCloudPlatform/kubernetes/tree/master/examples/mysql-wordpress-pd">https://github.com/GoogleCloudPlatform/kubernetes/tree/master/examples/mysql-wordpress-pd</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/cloud/cloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/cloud/cloud/" class="post-title-link" itemprop="url">kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kvm/" itemprop="url" rel="index"><span itemprop="name">kvm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->


<h2 id="kvm虚拟化管理平台WebVirtMgr部署-完整记录-1"><a href="#kvm虚拟化管理平台WebVirtMgr部署-完整记录-1" class="headerlink" title="kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)"></a>kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)</h2><p>公司机房有一台2U的服务器（64G内存，32核），由于近期新增业务比较多，测试机也要新增，服务器资源十分有限。所以打算在这台2U服务器上部署kvm虚拟化，虚出多台VM出来，以应对新的测试需求。<br>当KVM宿主机越来越多，需要对宿主机的状态进行调控，决定采用WebVirtMgr作为kvm虚拟化的web管理工具，图形化的WEB，让人能更方便的查看kvm 宿主机的情况和操作<br>WebVirtMgr是近两年来发展较快，比较活跃，非常清新的一个KVM管理平台，提供对宿主机和虚机的统一管理，它有别于kvm自带的图形管理工具（virtual machine manager），让kvm管理变得更为可视化，对中小型kvm应用场景带来了更多方便。<br>WebVirtMgr采用几乎纯Python开发，其前端是基于Python的Django，后端是基于Libvirt的Python接口，将日常kvm的管理操作变的更加的可视化。</p>
<h2 id="WebVirtMgr特点"><a href="#WebVirtMgr特点" class="headerlink" title="WebVirtMgr特点"></a>WebVirtMgr特点</h2><p>操作简单，易于使用<br>通过libvirt的API接口对kvm进行管理<br>提供对虚拟机生命周期管理<br>WebVirtMgr 功能</p>
<h2 id="宿主机管理支持以下功能"><a href="#宿主机管理支持以下功能" class="headerlink" title="宿主机管理支持以下功能"></a>宿主机管理支持以下功能</h2><p>CPU利用率<br>内存利用率<br>网络资源池管理<br>存储资源池管理<br>虚拟机镜像<br>虚拟机克隆<br>快照管理<br>日志管理<br>虚机迁移  </p>
<h2 id="虚拟机管理支持以下功能"><a href="#虚拟机管理支持以下功能" class="headerlink" title="虚拟机管理支持以下功能"></a>虚拟机管理支持以下功能</h2><p>CPU利用率<br>内存利用率<br>光盘管理<br>关&#x2F;开&#x2F;暂停虚拟机<br>安装虚拟机<br>VNC console连接<br>创建快照  </p>
<h2 id="下面对部署过程进行记录，希望能帮助到有用到的朋友们。"><a href="#下面对部署过程进行记录，希望能帮助到有用到的朋友们。" class="headerlink" title="下面对部署过程进行记录，希望能帮助到有用到的朋友们。"></a>下面对部署过程进行记录，希望能帮助到有用到的朋友们。</h2><p>这里我将webvirtmgr服务器和kvm服务器放在同一台机器上部署的，即单机部署<br>系统：Centos 6.8<br>内存:64G<br>CPU:32核<br>ip：192.168.1.17（内网），111.101.186.163（外网）  </p>
<h2 id="一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装："><a href="#一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装：" class="headerlink" title="一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装："></a>一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装：</h2><p>kvm虚拟化管理平台WebVirtMgr部署-虚拟化环境安装-完整记录(0)  </p>
<h2 id="二、Kvm的管理工具webvirtmgr安装和使用"><a href="#二、Kvm的管理工具webvirtmgr安装和使用" class="headerlink" title="二、Kvm的管理工具webvirtmgr安装和使用"></a>二、Kvm的管理工具webvirtmgr安装和使用</h2><h3 id="1）安装支持的软件源"><a href="#1）安装支持的软件源" class="headerlink" title="1）安装支持的软件源"></a>1）安装支持的软件源</h3><p>[root@openstack ops]#yum -y install <a href="http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm">http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm</a>  </p>
<h3 id="2）安装相关软件"><a href="#2）安装相关软件" class="headerlink" title="2）安装相关软件"></a>2）安装相关软件</h3><hr>
<h2 id="如果报错说没有下面安装的某些软件，则下载http-pan-baidu-com-s-1bX3vkE-（密码：6ucs）将下载的yum-tar-gz解压后的文件替换到-etc-yum-repos-d目录下，然后执行yum-clean-all-yum-makecache"><a href="#如果报错说没有下面安装的某些软件，则下载http-pan-baidu-com-s-1bX3vkE-（密码：6ucs）将下载的yum-tar-gz解压后的文件替换到-etc-yum-repos-d目录下，然后执行yum-clean-all-yum-makecache" class="headerlink" title="如果报错说没有下面安装的某些软件，则下载http://pan.baidu.com/s/1bX3vkE （密码：6ucs）将下载的yum.tar.gz解压后的文件替换到&#x2F;etc&#x2F;yum.repos.d目录下，然后执行yum clean all &amp;&amp; yum makecache  "></a>如果报错说没有下面安装的某些软件，则下载<a href="http://pan.baidu.com/s/1bX3vkE">http://pan.baidu.com/s/1bX3vkE</a> （密码：6ucs）<br>将下载的yum.tar.gz解压后的文件替换到&#x2F;etc&#x2F;yum.repos.d目录下，然后执行yum clean all &amp;&amp; yum makecache  </h2><p>[root@openstack ops]#yum -y install git python-pip libvirt-python libxml2-python python-websockify supervisor nginx  </p>
<h3 id="3）从git-hub中下载相关的webvirtmgr代码"><a href="#3）从git-hub中下载相关的webvirtmgr代码" class="headerlink" title="3）从git-hub中下载相关的webvirtmgr代码"></a>3）从git-hub中下载相关的webvirtmgr代码</h3><p>[root@openstack ops]#cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;<br>[root@openstack src]#git clone git:&#x2F;&#x2F;github.com&#x2F;retspen&#x2F;webvirtmgr.git    （下载地址：<a href="https://pan.baidu.com/s/1pLS3kCj">https://pan.baidu.com/s/1pLS3kCj</a>      获取密码：8efm）</p>
<h3 id="4）安装webvirtmgr"><a href="#4）安装webvirtmgr" class="headerlink" title="4）安装webvirtmgr"></a>4）安装webvirtmgr</h3><p>[root@openstack src]#cd webvirtmgr&#x2F;<br>[root@openstack webvirtmgr]#pip install -r requirements.txt  </p>
<h3 id="5）安装数据库"><a href="#5）安装数据库" class="headerlink" title="5）安装数据库"></a>5）安装数据库</h3><p>[root@openstack webvirtmgr]#yum install python-sqlite2   </p>
<h3 id="6）对django进行环境配置"><a href="#6）对django进行环境配置" class="headerlink" title="6）对django进行环境配置"></a>6）对django进行环境配置</h3><p>[root@openstack webvirtmgr]#pwd<br>&#x2F;usr&#x2F;local&#x2F;src&#x2F;webvirtmgr<br>[root@openstack webvirtmgr]#.&#x2F;manage.py syncdb           &#x2F;&#x2F;默认是python执行，如下报错，换用其他版本的python  </p>
<hr>
<p>注意此处用默认的python执行上面命令，一般会报错，如下：<br>ImportError: No module named django.core.management   </p>
<h3 id="这个一般是由于python版本引起的，因为系统自带有好几个版本的python"><a href="#这个一般是由于python版本引起的，因为系统自带有好几个版本的python" class="headerlink" title="这个一般是由于python版本引起的，因为系统自带有好几个版本的python"></a>这个一般是由于python版本引起的，因为系统自带有好几个版本的python</h3><p>[root@openstack webvirtmgr]# python       &#x2F;&#x2F;按Tab键自查找<br>python python2.6<br>python2 python2.6-config python-config<br>[root@openstack webvirtmgr]# python -V<br>Python 2.6.6  </p>
<p>由此可看出，系统默认的Python版本是2.6.6<br>说明上面命令默认是python2.6执行的  </p>
<p>既然使用python2.6执行上面的命令报错，那就换用其他版本python2执行（如果当前是python3.3.0，那么就将下面的&#x2F;usr&#x2F;bin&#x2F;python2换成&#x2F;usr&#x2F;bin&#x2F;python2.6）<br>[root@openstack webvirtmgr]#&#x2F;usr&#x2F;bin&#x2F;python2 manage.py syncdb     &#x2F;&#x2F;最终发现使用python2执行这个命令就不报错了<br>…………<br>…………<br>You just installed Django’s auth system, which means you don’t have any superusers defined.<br>Would you like to create one now? (yes&#x2F;no): yes<br>Username (leave blank to use ‘root’): admin<br>Email address: <a href="mailto:&#119;&#97;&#x6e;&#103;&#x73;&#x68;&#x69;&#98;&#111;&#x40;&#x31;&#x36;&#51;&#46;&#99;&#x6f;&#x6d;">&#119;&#97;&#x6e;&#103;&#x73;&#x68;&#x69;&#98;&#111;&#x40;&#x31;&#x36;&#51;&#46;&#99;&#x6f;&#x6d;</a><br>Password:*********<br>Password (again):*********  </p>
<hr>
<p>[root@openstack webvirtmgr]#&#x2F;usr&#x2F;bin&#x2F;python2 manage.py collectstatic          &#x2F;&#x2F;生成配置文件（同样使用python2版本执行，不要使用默认的python执行）<br>WARNING:root:No local_settings file found.</p>
<p>You have requested to collect static files at the destination<br>location as specified in your settings.</p>
<p>This will overwrite existing files!<br>Are you sure you want to do this?</p>
<p>Type ‘yes’ to continue, or ‘no’ to cancel: yes<br>……….<br>……….</p>
<p>[root@openstack webvirtmgr]#&#x2F;usr&#x2F;bin&#x2F;python2 manage.py createsuperuser  &#x2F;&#x2F;添加管理员账号（同样使用python2版本执行，不要使用默认的python执行）<br>WARNING:root:No local_settings file found.<br>Username: ops                                                   &#x2F;&#x2F;这个是管理员账号，用上面的admin和这个管理员账号都可以登陆webvirtmgr的web界面管理平台<br>Email address: <a href="mailto:&#119;&#x61;&#x6e;&#103;&#x73;&#x68;&#x69;&#x62;&#x6f;&#64;&#x31;&#x36;&#51;&#x2e;&#x63;&#x6f;&#109;">&#119;&#x61;&#x6e;&#103;&#x73;&#x68;&#x69;&#x62;&#x6f;&#64;&#x31;&#x36;&#51;&#x2e;&#x63;&#x6f;&#109;</a><br>Password:<br>Password (again):<br>Superuser created successfully.</p>
<h2 id="7）拷贝web到-相关目录"><a href="#7）拷贝web到-相关目录" class="headerlink" title="7）拷贝web到 相关目录"></a>7）拷贝web到 相关目录</h2><p>[root@openstack ops]#mkdir -pv &#x2F;var&#x2F;www<br>[root@openstack ops]#cp -Rv &#x2F;usr&#x2F;local&#x2F;src&#x2F;webvirtmgr &#x2F;var&#x2F;www&#x2F;webvirtmgr</p>
<h2 id="8）设置ssh"><a href="#8）设置ssh" class="headerlink" title="8）设置ssh"></a>8）设置ssh</h2><p>[root@openstack ops]#ssh-keygen -r rsa             &#x2F;&#x2F;产生公私钥<br>[root@openstack ops]#ssh-copy-id 192.168.1.17        &#x2F;&#x2F;由于这里webvirtmgr和kvm服务部署在同一台机器，所以这里本地信任。如果kvm部署在其他机器，那么这个是它的ip<br>[root@openstack ops]#ssh 192.168.1.17 -L localhost:8000:localhost:8000 -L localhost:6080:localhost:60</p>
<h2 id="9）编辑nginx配置文件"><a href="#9）编辑nginx配置文件" class="headerlink" title="9）编辑nginx配置文件"></a>9）编辑nginx配置文件</h2><p>提前确保&#x2F;etc&#x2F;nginx&#x2F;nginx.conf文件里开启了“include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;”</p>
<p>[root@openstack ops]#vim &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;webvirtmgr.conf           &#x2F;&#x2F;添加下面内容到文件中<br>server {<br>listen 80 default_server;</p>
<p>server_name $hostname;<br>#access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;webvirtmgr_access_log;</p>
<p>location &#x2F;static&#x2F; {<br>root &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;webvirtmgr; # or &#x2F;srv instead of &#x2F;var<br>expires max;<br>}</p>
<p>location &#x2F; {<br>proxy_pass <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000</a>;<br>proxy_set_header X-Real-IP $remote_addr;<br>proxy_set_header X-Forwarded-for $proxy_add_x_forwarded_for;<br>proxy_set_header Host $host:$server_port;<br>proxy_set_header X-Forwarded-Proto $remote_addr;<br>proxy_connect_timeout 600;<br>proxy_read_timeout 600;<br>proxy_send_timeout 600;<br>client_max_body_size 1024M; # Set higher depending on your needs<br>}<br>}</p>
<p>[root@openstack ops]#mv &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf.bak</p>
<h2 id="10）启动nginx"><a href="#10）启动nginx" class="headerlink" title="10）启动nginx"></a>10）启动nginx</h2><p>[root@openstack ops]#&#x2F;etc&#x2F;init.d&#x2F;nginx restart</p>
<h2 id="11）修改防火墙规则"><a href="#11）修改防火墙规则" class="headerlink" title="11）修改防火墙规则"></a>11）修改防火墙规则</h2><p>[root@ops ~]#vim &#x2F;etc&#x2F;sysconfig&#x2F;selinux<br>……<br>SELINUX&#x3D;disabled</p>
<p>[root@ops ~]#setenforce 0<br>setenforce: SELinux is disabled<br>[root@ops ~]#getenforce<br>Disabled</p>
<p>[root@openstack ops]#&#x2F;usr&#x2F;sbin&#x2F;setsebool httpd_can_network_connect true</p>
<h2 id="12）设置-supervisor-如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问"><a href="#12）设置-supervisor-如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问" class="headerlink" title="12）设置 supervisor (如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问)"></a>12）设置 supervisor (如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问)</h2><p>[root@openstack ops]#chown -R nginx:nginx &#x2F;var&#x2F;www&#x2F;webvirtmgr</p>
<p>[root@openstack ops]#vim &#x2F;etc&#x2F;supervisord.conf     &#x2F;&#x2F;在文件末尾添加,注意将默认的python改为python2，因为上面只有用这个版本执行才不报错！<br>[program:webvirtmgr]<br>command&#x3D;&#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;manage.py run_gunicorn -c &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py                     &#x2F;&#x2F;启动8000端口<br>directory&#x3D;&#x2F;var&#x2F;www&#x2F;webvirtmgr<br>autostart&#x3D;true<br>autorestart&#x3D;true<br>logfile&#x3D;&#x2F;var&#x2F;log&#x2F;supervisor&#x2F;webvirtmgr.log<br>log_stderr&#x3D;true<br>user&#x3D;nginx</p>
<p>[program:webvirtmgr-console]<br>command&#x3D;&#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;console&#x2F;webvirtmgr-console                               &#x2F;&#x2F;启动6080端口（这是控制台vnc端口）<br>directory&#x3D;&#x2F;var&#x2F;www&#x2F;webvirtmgr<br>autostart&#x3D;true<br>autorestart&#x3D;true<br>stdout_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;supervisor&#x2F;webvirtmgr-console.log<br>redirect_stderr&#x3D;true<br>user&#x3D;nginx<br>[root@openstack ops]#vim &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py    &#x2F;&#x2F;确保下面bind绑定的是本机的8000端口，这个在nginx配置中定义了，被代理的端口<br>bind &#x3D; ‘127.0.0.1:8000’</p>
<h2 id="13）设置开机启动"><a href="#13）设置开机启动" class="headerlink" title="13）设置开机启动"></a>13）设置开机启动</h2><p>[root@openstack ops]#chkconfig supervisord on<br>[root@openstack ops]#vim &#x2F;etc&#x2F;rc.local<br>&#x2F;usr&#x2F;sbin&#x2F;setsebool httpd_can_network_connect true</p>
<h2 id="14）启动进程"><a href="#14）启动进程" class="headerlink" title="14）启动进程"></a>14）启动进程</h2><p>[root@openstack ops]#&#x2F;etc&#x2F;init.d&#x2F;supervisord restart<br>15）查看进程<br>[root@openstack ops]#netstat -lnpt    &#x2F;&#x2F;即可以看到6080和8000已经启动<br>[root@openstack ops]# lsof -i:6080<br>COMMAND PID USER FD TYPE DEVICE SIZE&#x2F;OFF NODE NAME<br>python2 53476 nginx 3u IPv4 364124 0t0 TCP *:6080 (LISTEN)<br>[root@openstack ops]#lsof -i:8000</p>
<hr>
<p>一般来说，只要上面的supervisord服务启动了，8000和6080端口就起来了。<br>因为在&#x2F;etc&#x2F;supervisord.conf文件里配置了这两个端口的启动设置</p>
<h2 id="如果supervisord服务启动了，8000和6080端口还是没起来！那么就需要手动启动-etc-supervisord-conf文件里配置的这两个端口的启动命令，即：-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-manage-py-run-gunicorn-c-var-www-webvirtmgr-conf-gunicorn-conf-py-这个命令会一直在操作-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-console-webvirtmgr-console-这个命令会一直在操作-root-openstack-ops-etc-init-d-supervisord-restart-root-openstack-ops-lsof-i-8000-root-openstack-ops-lsof-i-6080"><a href="#如果supervisord服务启动了，8000和6080端口还是没起来！那么就需要手动启动-etc-supervisord-conf文件里配置的这两个端口的启动命令，即：-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-manage-py-run-gunicorn-c-var-www-webvirtmgr-conf-gunicorn-conf-py-这个命令会一直在操作-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-console-webvirtmgr-console-这个命令会一直在操作-root-openstack-ops-etc-init-d-supervisord-restart-root-openstack-ops-lsof-i-8000-root-openstack-ops-lsof-i-6080" class="headerlink" title="如果supervisord服务启动了，8000和6080端口还是没起来！那么就需要手动启动&#x2F;etc&#x2F;supervisord.conf文件里配置的这两个端口的启动命令，即：[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;manage.py run_gunicorn -c &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py       &#x2F;&#x2F;这个命令会一直在操作[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;console&#x2F;webvirtmgr-console                        &#x2F;&#x2F;这个命令会一直在操作[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;supervisord restart[root@openstack ops]# lsof -i:8000[root@openstack ops]# lsof -i:6080"></a>如果supervisord服务启动了，8000和6080端口还是没起来！<br>那么就需要手动启动&#x2F;etc&#x2F;supervisord.conf文件里配置的这两个端口的启动命令，即：<br>[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;manage.py run_gunicorn -c &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py       &#x2F;&#x2F;这个命令会一直在操作<br>[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;console&#x2F;webvirtmgr-console                        &#x2F;&#x2F;这个命令会一直在操作<br>[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;supervisord restart<br>[root@openstack ops]# lsof -i:8000<br>[root@openstack ops]# lsof -i:6080</h2><h2 id="16）web访问"><a href="#16）web访问" class="headerlink" title="16）web访问"></a>16）web访问</h2><p><a href="http://111.101.186.163/login/">http://111.101.186.163/login/</a></p>
<p>这里用超级管理员登陆，只有超级管理员登陆后才能看到“基础构架”窗口</p>
<p>普通用户登陆后，只能看到“WebVirtMgr”一个窗口</p>
<p>选择“SSH链接“，设置Label，IP，用户</p>
<p>注意：Label与IP要相同</p>
<p>打开后，有报错！看来在上面使用ssh连接的配置环节有误所致！</p>
<p>解决措施：</p>
<h2 id="1-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥"><a href="#1-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥" class="headerlink" title="1)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥"></a>1)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥</h2><p>[root@openstack ops]# cd &#x2F;home&#x2F;<br>[root@openstack home]# mkdir nginx<br>[root@openstack home]# chown nginx.nginx nginx&#x2F;<br>[root@openstack home]# chmod 700 nginx&#x2F; -R<br>[root@openstack home]# su - nginx -s &#x2F;bin&#x2F;bash<br>-bash-4.1$ ssh-keygen                             #期间输入yes后直接回车，回车<br>-bash-4.1$ touch ~&#x2F;.ssh&#x2F;config &amp;&amp; echo -e “StrictHostKeyChecking&#x3D;no\nUserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null” &gt;&gt; ~&#x2F;.ssh&#x2F;config<br>-bash-4.1$ chmod 0600 ~&#x2F;.ssh&#x2F;config</p>
<h2 id="2-在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户"><a href="#2-在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户" class="headerlink" title="2)在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户"></a>2)在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户</h2><hr>
<h2 id="如果采用其他用户，比如webvirtmgr，操作如下-root-openstack-ops-useradd-webvirtmgr-root-openstack-ops-echo-“123456”-passwd-–stdin-webvirtmgr-root-openstack-ops-groupadd-libvirt-root-openstack-ops-usermod-G-libvirt-a-webvirtmgr"><a href="#如果采用其他用户，比如webvirtmgr，操作如下-root-openstack-ops-useradd-webvirtmgr-root-openstack-ops-echo-“123456”-passwd-–stdin-webvirtmgr-root-openstack-ops-groupadd-libvirt-root-openstack-ops-usermod-G-libvirt-a-webvirtmgr" class="headerlink" title="如果采用其他用户，比如webvirtmgr，操作如下:[root@openstack ops]#useradd webvirtmgr[root@openstack ops]#echo “123456” | passwd –stdin webvirtmgr[root@openstack ops]#groupadd libvirt[root@openstack ops]#usermod -G libvirt -a webvirtmgr"></a>如果采用其他用户，比如webvirtmgr，操作如下:<br>[root@openstack ops]#useradd webvirtmgr<br>[root@openstack ops]#echo “123456” | passwd –stdin webvirtmgr<br>[root@openstack ops]#groupadd libvirt<br>[root@openstack ops]#usermod -G libvirt -a webvirtmgr</h2><h2 id="3-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）"><a href="#3-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）" class="headerlink" title="3)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）"></a>3)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）</h2><p>[root@openstack ops]# su - nginx -s &#x2F;bin&#x2F;bash<br>-bash-4.1$ ssh-copy-id <a href="mailto:&#x72;&#x6f;&#111;&#x74;&#64;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#x31;&#x2e;&#x31;&#55;">&#x72;&#x6f;&#111;&#x74;&#64;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#x31;&#x2e;&#x31;&#55;</a><br>Warning: Permanently added ‘192.168.1.17’ (RSA) to the list of known hosts.<br><a href="mailto:&#114;&#x6f;&#x6f;&#116;&#x40;&#x31;&#57;&#50;&#46;&#49;&#x36;&#56;&#x2e;&#x31;&#46;&#x31;&#x37;">&#114;&#x6f;&#x6f;&#116;&#x40;&#x31;&#57;&#50;&#46;&#49;&#x36;&#56;&#x2e;&#x31;&#46;&#x31;&#x37;</a>‘s password: #输入192.168.1.17即本机的root账号<br>Now try logging into the machine, with “ssh ‘<a href="mailto:&#114;&#111;&#111;&#x74;&#64;&#x31;&#57;&#x32;&#x2e;&#49;&#54;&#56;&#x2e;&#x31;&#46;&#x31;&#55;">&#114;&#111;&#111;&#x74;&#64;&#x31;&#57;&#x32;&#x2e;&#49;&#54;&#56;&#x2e;&#x31;&#46;&#x31;&#55;</a>‘“, and check in:</p>
<p>.ssh&#x2F;authorized_keys</p>
<h2 id="to-make-sure-we-haven’t-added-extra-keys-that-you-weren’t-expecting"><a href="#to-make-sure-we-haven’t-added-extra-keys-that-you-weren’t-expecting" class="headerlink" title="to make sure we haven’t added extra keys that you weren’t expecting."></a>to make sure we haven’t added extra keys that you weren’t expecting.</h2><h2 id="这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下-root-openstack-ops-su-nginx-s-bin-bash-bash-4-1-ssh-copy-id-119-x65-x62-x76-105-114-116-109-103-114-64-x31-57-x32-x2e-x31-54-56-x2e-48-x2e-x32-51"><a href="#这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下-root-openstack-ops-su-nginx-s-bin-bash-bash-4-1-ssh-copy-id-119-x65-x62-x76-105-114-116-109-103-114-64-x31-57-x32-x2e-x31-54-56-x2e-48-x2e-x32-51" class="headerlink" title="这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下:[root@openstack ops]#su - nginx -s &#x2F;bin&#x2F;bash-bash-4.1$ssh-copy-id &#119;&#x65;&#x62;&#x76;&#105;&#114;&#116;&#109;&#103;&#114;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#x2e;&#48;&#x2e;&#x32;&#51;"></a>这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下:<br>[root@openstack ops]#su - nginx -s &#x2F;bin&#x2F;bash<br>-bash-4.1$ssh-copy-id <a href="mailto:&#119;&#x65;&#x62;&#x76;&#105;&#114;&#116;&#109;&#103;&#114;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#x2e;&#48;&#x2e;&#x32;&#51;">&#119;&#x65;&#x62;&#x76;&#105;&#114;&#116;&#109;&#103;&#114;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#x2e;&#48;&#x2e;&#x32;&#51;</a></h2><h2 id="4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置-libvirt-ssh授权"><a href="#4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置-libvirt-ssh授权" class="headerlink" title="4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置 libvirt ssh授权"></a>4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置 libvirt ssh授权</h2><p>[root@openstack ops]# vim &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla<br>[Remote libvirt SSH access]<br>Identity&#x3D;unix-user:root #注意这里采用的是root用户<br>Action&#x3D;org.libvirt.unix.manage<br>ResultAny&#x3D;yes<br>ResultInactive&#x3D;yes<br>ResultActive&#x3D;yes</p>
<h2 id="root-openstack-ops-chown-R-root-root-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla"><a href="#root-openstack-ops-chown-R-root-root-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla" class="headerlink" title="[root@openstack ops]# chown -R root.root &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla"></a>[root@openstack ops]# chown -R root.root &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla</h2><p>这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下:<br>[root@openstack ops]#vim &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla<br>[Remote libvirt SSH access]<br>Identity&#x3D;unix-user:webvirtmgr #这里就设定webvirtmgr用户<br>Action&#x3D;org.libvirt.unix.manage<br>ResultAny&#x3D;yes<br>ResultInactive&#x3D;yes<br>ResultActive&#x3D;yes</p>
<h2 id="root-openstack-ops-chown-R-webvirtmgr-webvirtmgr-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla"><a href="#root-openstack-ops-chown-R-webvirtmgr-webvirtmgr-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla" class="headerlink" title="[root@openstack ops]#chown -R webvirtmgr.webvirtmgr &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla"></a>[root@openstack ops]#chown -R webvirtmgr.webvirtmgr &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla</h2><h2 id="5）重启-libvirtd-服务"><a href="#5）重启-libvirtd-服务" class="headerlink" title="5）重启 libvirtd 服务"></a>5）重启 libvirtd 服务</h2><p>&#x2F;etc&#x2F;init.d&#x2F;libvirtd restart</p>
<p>这样上面报错的问题就迎仍而解了！</p>
<p>然后重新ssh方式连接就ok了，就不会有上面那个报错了~</p>
<p>但是，又出现了其他报错（如下）！尼玛～～  接续排查！</p>
<p>解决措施：</p>
<p> 在WebVirtMgr服务器本地使用ssh方式连接，在终端命令行里：</p>
<p>[root@openstack .ssh]# virsh -c qemu+ssh:&#x2F;&#x2F;103.10.86.17&#x2F;system list<br>The authenticity of host ‘103.10.86.17 (103.10.86.17)’ can’t be established.<br>RSA key fingerprint is 3d:c1:2e:70:e9:e5:1d:84:40:a2:63:82:af:e5:cc:cd.<br>Are you sure you want to continue connecting (yes&#x2F;no)? yes<br>error: End of file while reading data: Warning: Permanently added ‘103.10.86.17’ (RSA) to the list of known hosts.: Input&#x2F;output error<br>error: failed to connect to the hypervisor</p>
<p>看日志 tail &#x2F;var&#x2F;log&#x2F;secure | grep sshd 发现是我这里主动发出断开的.有可能检测到libvirtd有些问题导致的。<br>当时使用virt-manage可以查询到远程的信息.估计是sshd出现的问题把.</p>
<p>折腾一会，暂时没找到解决方案</p>
<p>决定先选用通过tcp协议进行迁移的（但是这种方式没有用ssh连接方式安全——）<br>等后面有时间了，再想办法解决上面ssh方式连接的错误吧</p>
<p>使用tcp进行对远程libvirtd进行连接访问的配置如下：</p>
<p>1）修改文件&#x2F;etc&#x2F;sysconfig&#x2F;libvirtd，用来启用tcp的端口<br>[root@openstack ops]# cat &#x2F;etc&#x2F;sysconfig&#x2F;libvirtd<br>……..<br>LLIBVIRTD_CONFIG&#x3D;&#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>LIBVIRTD_ARGS&#x3D;”–listen”</p>
<p>2)修改文件&#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>[root@openstack ops]#vim &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>listen_tls &#x3D; 0<br>listen_tcp &#x3D; 1<br>tcp_port &#x3D; “16509”<br>listen_addr &#x3D; “0.0.0.0”<br>auth_tcp &#x3D; “none”</p>
<p>3)运行 libvirtd<br>[root@openstack ops]#service libvirtd restart</p>
<p>如果没起效果(我的就没有生效，那么使用命令行.如果生效了，执行下面命令就会报错<br>[root@openstack ops]#libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf</p>
<p>4)查看运行进程<br>[root@openstack ops]# ps aux | grep libvirtd<br>root 16563 1.5 0.1 925880 7056 ? Sl 16:01 0:28 libvirtd -d -l –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf</p>
<p>5)查看端口<br>[root@openstack ops]# lsof -i:16509</p>
<p>6）在source host连接dest host远程libvirtd查看信息（也可以用公网ip）<br>[root@openstack ops]# virsh -c qemu+tcp:&#x2F;&#x2F;192.168.1.17&#x2F;system<br>Welcome to virsh, the virtualization interactive terminal.</p>
<p>Type: ‘help’ for help with commands<br>‘quit’ to quit</p>
<p>virsh #</p>
<p>成功使用tcp去访问libvirtd。</p>
<p>注意：</p>
<p>在使用tcp方式连接后，会出现连接终端的情况！</p>
<p>[root@openstack .ssh]# virsh -c qemu+tcp:&#x2F;&#x2F;192.168.1.17&#x2F;system<br>error: Cannot recv data: Connection reset by peer<br>error: failed to connect to the hypervisor</p>
<p>连接断开，重新连接便可。</p>
<p>[root@openstack ops]# ps aux | grep libvirtd<br>root 59619 0.6 0.0 1008128 22048 ? Sl 19:17 0:06 libvirtd –daemon –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf –listen<br>root 61081 0.0 0.0 103316 1004 pts&#x2F;2 S+ 19:33 0:00 grep –color libvirtd<br>[root@openstack ops]# kill -9 59619<br>[root@openstack ops]# ps aux | grep libvirtd<br>root 61083 0.0 0.0 103312 904 pts&#x2F;2 S+ 19:33 0:00 grep –color libvirtd<br>[root@openstack ops]# libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>[root@openstack ops]# ps aux | grep libvirtd<br>root 61086 13.5 0.0 418240 6576 ? Sl 19:33 0:00 libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>root 61176 0.0 0.0 103312 908 pts&#x2F;2 S+ 19:33 0:00 grep –color libvirtd<br>[root@openstack ops]# virsh -c qemu+tcp:&#x2F;&#x2F;192.168.1.17&#x2F;system<br>Welcome to virsh, the virtualization interactive terminal.</p>
<p>Type: ‘help’ for help with commands<br>‘quit’ to quit</p>
<p>virsh #</p>
<p>后续发现，webvirtmgr连上后，过一会儿就会断开！</p>
<p>针对这个情况，可以可以写个定时脚本，如下：</p>
<p>[root@openstack ops]# cat &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh</p>
<p>#!&#x2F;bin&#x2F;bash<br>ps -ef | grep “libvirtd –daemon –listen”|grep -v grep|awk -F” “ ‘{print $2}’|xargs kill -9<br>&#x2F;usr&#x2F;sbin&#x2F;libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf</p>
<p>[root@openstack ops]# crontab -l</p>
<ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 10;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 20;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 30;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 40;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 50;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p>一般如上配置后，webvirtmgr里的控制台是可以正常连接虚拟机的。</p>
<p>但如果webvirtmgr里通过控制台页面(vnc)连接虚拟机失败，可以按照下面的操作方法尝试解决：</p>
<p>kvm原来的安装方式是客户端需要安装vncviewer，才能看到安装页面，而webvirtmgr使用了novnc，页面通过websocket进行通信。</p>
<p>1）首先需要安装novnc<br>[root@openstack ops]# yum install -y novnc</p>
<p>2）防火墙打开vnc的6080端口<br>[root@openstack ops]# vim &#x2F;etc&#x2F;sysconfig&#x2F;iptables<br>…….<br>-A INPUT -p tcp -m state –state NEW -m tcp –dport 6080 -j ACCEPT<br>…….</p>
<p>[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;iptables restart</p>
<p>3）由上面可知，webvirtmgr进程通过supervisor管理。这里需要重启supervisor进程<br>[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;supervisord restart</p>
<p>这样，再次打开Webvirtmgr的控制台，发现就能连上虚拟机了！</p>
<hr>
<p>可以在webvirtmgr服务器上通过命令行尝试下连接：<br>[root@openstack ops]# novnc_server –help<br>Usage: novnc_server [–listen PORT] [–vnc VNC_HOST:PORT] [–cert CERT]</p>
<p>Starts the WebSockets proxy and a mini-webserver and<br>provides a cut-and-paste URL to go to.</p>
<p>–listen PORT Port for proxy&#x2F;webserver to listen on<br>Default: 6080<br>–vnc VNC_HOST:PORT VNC server host:port proxy target<br>Default: localhost:5900<br>–cert CERT Path to combined cert&#x2F;key file<br>Default: self.pem<br>–web WEB Path to web files (e.g. vnc.html)<br>Default: .&#x2F;</p>
<p>[root@openstack ops]# novnc_server –listen 192.168.1.17:6086           #端口在6080后的都可以用<br>Warning: could not find self.pem<br>Starting webserver and WebSockets proxy on port 192.168.1.17:6086<br>WARNING: no ‘numpy’ module, HyBi protocol will be slower<br>WebSocket server settings:</p>
<ul>
<li>Listen on 192.168.1.17:6086</li>
<li>Flash security policy server</li>
<li>Web server. Web root: &#x2F;usr&#x2F;share&#x2F;novnc</li>
<li>No SSL&#x2F;TLS support (no cert file)</li>
<li>proxying from 192.168.1.17:6086 to localhost:5900</li>
</ul>
<p>Navigate to this URL:</p>
<p><a href="http://kvm-server:192.168.1.17:6086/vnc.html?host=kvm-server&port=192.168.1.17:6086">http://kvm-server:192.168.1.17:6086/vnc.html?host=kvm-server&amp;port=192.168.1.17:6086</a></p>
<p>Press Ctrl-C to exit</p>
<hr>
<p><em><strong><strong><strong><strong><strong><strong><strong>当你发现自己的才华撑不起野心时，就请安静下来学习吧</strong></strong></strong></strong></strong></strong></strong></em></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/git/git_use/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/git/git_use/" class="post-title-link" itemprop="url">git crlf换行符的问题解决</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<h1 id="git-crlf换行符的问题解决"><a href="#git-crlf换行符的问题解决" class="headerlink" title="git crlf换行符的问题解决"></a>git crlf换行符的问题解决</h1><h2 id="git使用中遇到的换行符问题总结"><a href="#git使用中遇到的换行符问题总结" class="headerlink" title="git使用中遇到的换行符问题总结"></a>git使用中遇到的换行符问题总结</h2><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>项目组现在用git做版本控制，使用中遇到不同平台下换行符不同造成的问题，windows下的换行符为crlf，linux和MAX OS 下换行符是 lf。linux和MAX os就按说明设置为<code>core.autocrlf input</code>（貌似是默认值），windows设置为<code>core.autocrlf true</code>。可是有时候还是会遇到换行符的问题。review的时候就会发现有的commit的变化是所有行都被删除重建。</p>
<h4 id="git中设置core-autocrlf"><a href="#git中设置core-autocrlf" class="headerlink" title="git中设置core.autocrlf####"></a>git中设置core.autocrlf####</h4><p>假如你正在Windows上写程序，又或者你正在和其他人合作，他们在Windows上编程，而你却在其他系统上，在这些情况下，你可能会遇到行尾结束符问题。这是因为Windows使用回车和换行两个字符来结束一行，而Mac和Linux只使用换行一个字符。虽然这是小问题，但它会极大地扰乱跨平台协作。</p>
<p>Git可以在你提交时自动地把行结束符CRLF转换成LF，而在签出代码时把LF转换成CRLF。用<code>core.autocrlf</code>来打开此项功能，如果是在Windows系统上，把它设置成<code>true</code>，这样当签出代码时，LF会被转换成CRLF：</p>
<p>$ git config –global core.autocrlf true</p>
<p>Linux或Mac系统使用LF作为行结束符，因此你不想 Git 在签出文件时进行自动的转换；当一个以CRLF为行结束符的文件不小心被引入时你肯定想进行修正，把<code>core.autocrlf</code>设置成input来告诉 Git 在提交时把CRLF转换成LF，签出时不转换：</p>
<p>$ git config –global core.autocrlf input</p>
<p>这样会在Windows系统上的签出文件中保留CRLF，会在Mac和Linux系统上，包括仓库中保留LF。</p>
<p>如果你是Windows程序员，且正在开发仅运行在Windows上的项目，可以设置<code>false</code>取消此功能，把回车符记录在库中：</p>
<p>$ git config –global core.autocrlf false</p>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><ol>
<li>修改git设置 core.autocrlf&#x3D;input.检出时不转换，提交转换为lf，这样可以避免提交windows换行符的情况；</li>
<li>修改eclipse设置 windows&gt;General&gt; workspace  下 new text file line delimiter 选择Unix。</li>
<li>已有的项目可能已经存在换行符不同的问题需要修正一下。<br>如果当前开发有多个分支且各分支不同步，需要每个分支进行一次转换：选中项目  file&gt; convert line delimiter to &gt; Unix ，创建新的commit；<br>如果只有一个分支或多个分支处于同一节点。可以从master切换一个新分支，进行第2步的修改操作，然后commit ，将此分支合并到所有分支。</li>
<li>将修改过的分支push到gitlab，其他成员更新代码即可。<br>(ps:由于每个人系统不同或者就是git的问题，可能出现更新完代码换行符不变，这时以服务器上的代码为准重新clone一份最新代码即可)</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/git/git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/git/git/" class="post-title-link" itemprop="url">快速安装 GitLab 并汉化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<p>原文：  <a href="http://www.jianshu.com/p/7a0d6917e009">http://www.jianshu.com/p/7a0d6917e009</a></p>
<h1 id="快速安装-GitLab-并汉化"><a href="#快速安装-GitLab-并汉化" class="headerlink" title="快速安装 GitLab 并汉化"></a>快速安装 GitLab 并汉化</h1><p>源码安装 GitLab 步骤繁琐：需要安装依赖包，Mysql，Redis，Postfix，Ruby，Nginx……安装完毕还得一个个手动配置这些软件。源码安装容易出错，不顺利的话，一天都搞不定。源码最大的好处是私人定制，如果不做定制化，还是使用官方推荐的 omnibus packages 方式安装，网络好的话，一个小时内搞定。<br>参照官方安装文档，分别在 Ubuntu 14 和 CentOS 6 两个机器上安装，过程非常顺利，没有错误。</p>
<h1 id="在-Ubuntu-14-安装"><a href="#在-Ubuntu-14-安装" class="headerlink" title="在 Ubuntu 14 安装"></a>在 Ubuntu 14 安装</h1><p>使用国内安装源镜像，加快安装速度。修改&#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;gitlab-ce.list，添加以下行   </p>
<pre><code>deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/debian jessie main
</code></pre>
<h1 id="开始安装："><a href="#开始安装：" class="headerlink" title="开始安装："></a>开始安装：</h1><h1 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h1><pre><code>sudo apt-get install curl openssh-server ca-certificates postfix
</code></pre>
<h1 id="安装-GitLab-社区版"><a href="#安装-GitLab-社区版" class="headerlink" title="安装 GitLab 社区版"></a>安装 GitLab 社区版</h1><pre><code>apt-get install gitlab-ce
</code></pre>
<h1 id="初始化，初始化完自动启动-GitLab"><a href="#初始化，初始化完自动启动-GitLab" class="headerlink" title="初始化，初始化完自动启动 GitLab"></a>初始化，初始化完自动启动 GitLab</h1><pre><code>sudo gitlab-ctl reconfigure
</code></pre>
<h1 id="在-CentOS-6-安装"><a href="#在-CentOS-6-安装" class="headerlink" title="在 CentOS 6 安装"></a>在 CentOS 6 安装</h1><p>使用国内镜像安装，新建 &#x2F;etc&#x2F;yum.repos.d&#x2F;gitlab-ce.repo，添加以下内容</p>
<pre><code>[gitlab-ce]
name=gitlab-ce
baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6
repo_gpgcheck=0
gpgcheck=0
enabled=1
gpgkey=https://packages.gitlab.com/gpg.key
</code></pre>
<h1 id="安装步骤："><a href="#安装步骤：" class="headerlink" title="安装步骤："></a>安装步骤：</h1><h1 id="安装依赖包-1"><a href="#安装依赖包-1" class="headerlink" title="安装依赖包"></a>安装依赖包</h1><pre><code>sudo yum install curl openssh-server openssh-clients postfix cronie
</code></pre>
<h1 id="启动-postfix-邮件服务"><a href="#启动-postfix-邮件服务" class="headerlink" title="启动 postfix 邮件服务"></a>启动 postfix 邮件服务</h1><pre><code>sudo service postfix start
</code></pre>
<h1 id="检查-postfix"><a href="#检查-postfix" class="headerlink" title="检查 postfix"></a>检查 postfix</h1><pre><code>sudo chkconfig postfix on
</code></pre>
<h1 id="安装-GitLab-社区版-1"><a href="#安装-GitLab-社区版-1" class="headerlink" title="安装 GitLab 社区版"></a>安装 GitLab 社区版</h1><pre><code>sudo yum install gitlab-ce
</code></pre>
<h1 id="初始化-GitLab"><a href="#初始化-GitLab" class="headerlink" title="初始化 GitLab"></a>初始化 GitLab</h1><pre><code>sudo gitlab-ctl reconfigure
修改 host
</code></pre>
<p>添加访问的 host，修改&#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb的external_url</p>
<pre><code>external_url &#39;http://git.home.com&#39;
</code></pre>
<p>vi &#x2F;etc&#x2F;hosts，添加 host 映射</p>
<pre><code>127.0.0.1 git.home.com
</code></pre>
<p>每次修改&#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb，都要运行以下命令，让配置生效</p>
<pre><code>sudo gitlab-ctl reconfigure
</code></pre>
<p>配置本机的 host，如：192.168.113.59</p>
<p>git.home.com。最后，在浏览器打开网址<a href="http://git.home.com，登陆。默认管理员：">http://git.home.com，登陆。默认管理员：</a><br>用户名: root<br>密码: 5iveL!fe<br>安装中文语言包（汉化）<br>以下汉化步骤参考此篇文章，首先确认当前安装版本<br>cat &#x2F;opt&#x2F;gitlab&#x2F;embedded&#x2F;service&#x2F;gitlab-rails&#x2F;VERSION<br>当前安装版本是8.5.7，因此中文补丁需要打8.5版本。<br>克隆 GitLab 源码仓库：</p>
<h1 id="克隆-GitLab-com-仓库"><a href="#克隆-GitLab-com-仓库" class="headerlink" title="克隆 GitLab.com 仓库"></a>克隆 GitLab.com 仓库</h1><p>git clone <a href="https://gitlab.com/larryli/gitlab.git">https://gitlab.com/larryli/gitlab.git</a><br>＃或 Gitcafe.com 镜像，速度更快<br>git clone <a href="https://gitcafe.com/larryli/gitlab.git">https://gitcafe.com/larryli/gitlab.git</a><br>运行汉化补丁：</p>
<h1 id="8-5-版本的汉化补丁（8-5-stable是英文稳定版，8-5-zh是中文版，两个-diff-结果便是汉化补丁）"><a href="#8-5-版本的汉化补丁（8-5-stable是英文稳定版，8-5-zh是中文版，两个-diff-结果便是汉化补丁）" class="headerlink" title="8.5 版本的汉化补丁（8-5-stable是英文稳定版，8-5-zh是中文版，两个 diff 结果便是汉化补丁）"></a>8.5 版本的汉化补丁（8-5-stable是英文稳定版，8-5-zh是中文版，两个 diff 结果便是汉化补丁）</h1><p>sudo git diff origin&#x2F;8-5-stable..8-5-zh &gt; &#x2F;tmp&#x2F;8.5.diff</p>
<h1 id="停止-gitlab"><a href="#停止-gitlab" class="headerlink" title="停止 gitlab"></a>停止 gitlab</h1><p>sudo gitlab-ctl stop</p>
<h1 id="应用汉化补丁"><a href="#应用汉化补丁" class="headerlink" title="应用汉化补丁"></a>应用汉化补丁</h1><p>cd &#x2F;opt&#x2F;gitlab&#x2F;embedded&#x2F;service&#x2F;gitlab-rails<br>git apply &#x2F;tmp&#x2F;8.5.diff  </p>
<h1 id="启动gitlab"><a href="#启动gitlab" class="headerlink" title="启动gitlab"></a>启动gitlab</h1><p>sudo gitlab-ctl start<br>至此，汉化完毕。打开地址<a href="http://git.home.com,便会看到中文版的gitlab.如下/">http://git.home.com，便会看到中文版的GitLab。如下</a><br>[图片]</p>
<p>安装完成。<br>备份<br>如果是生产环境，备份是必须的。需要备份的文件：配置文件和数据文件。<br>备份配置文件<br>配置文件含密码等敏感信息，不要和数据备份文件放在一起。<br>sh -c ‘umask 0077; tar -cf $(date “+etc-gitlab-%s.tar”) -C &#x2F;etc&#x2F;gitlab’<br>备份数据文件<br>默认数据备份目录是&#x2F;var&#x2F;opt&#x2F;gitlab&#x2F;backups，手动创建备份文件：</p>
<h1 id="Omnibus-方式安装使用以下命令备份"><a href="#Omnibus-方式安装使用以下命令备份" class="headerlink" title="Omnibus 方式安装使用以下命令备份"></a>Omnibus 方式安装使用以下命令备份</h1><p>sudo gitlab-rake gitlab:backup:create<br>日常备份，添加 crontab，运行crontab -e</p>
<h1 id="每天2点执行备份"><a href="#每天2点执行备份" class="headerlink" title="每天2点执行备份"></a>每天2点执行备份</h1><p>0 2 * * * &#x2F;opt&#x2F;gitlab&#x2F;bin&#x2F;gitlab-rake gitlab:backup:create CRON&#x3D;1<br>如要修改备份周期和目录，在&#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb中修改以下两个选项</p>
<h1 id="设置备份周期为7天-604800秒"><a href="#设置备份周期为7天-604800秒" class="headerlink" title="设置备份周期为7天 - 604800秒"></a>设置备份周期为7天 - 604800秒</h1><p>gitlab_rails[‘backup_keep_time’] &#x3D; 604800</p>
<h1 id="备份目录"><a href="#备份目录" class="headerlink" title="备份目录"></a>备份目录</h1><p>gitlab_rails[‘backup_path’] &#x3D; ‘&#x2F;mnt&#x2F;backups’<br>恢复<br>恢复之前，确保备份文件所安装 GitLab 和当前要恢复的 GitLab 版本一致。首先，恢复配置文件：<br>sudo mv &#x2F;etc&#x2F;gitlab &#x2F;etc&#x2F;gitlab.$(date +%s)</p>
<h1 id="将下面配置备份文件的时间戳改为你所备份的文件的时间戳"><a href="#将下面配置备份文件的时间戳改为你所备份的文件的时间戳" class="headerlink" title="将下面配置备份文件的时间戳改为你所备份的文件的时间戳"></a>将下面配置备份文件的时间戳改为你所备份的文件的时间戳</h1><pre><code>sudo tar -xf etc-gitlab-1399948539.tar -C /
恢复数据文件
</code></pre>
<h1 id="将数据备份文件拷贝至备份目录"><a href="#将数据备份文件拷贝至备份目录" class="headerlink" title="将数据备份文件拷贝至备份目录"></a>将数据备份文件拷贝至备份目录</h1><pre><code>sudo cp 1393513186_gitlab_backup.tar /var/opt/gitlab/backups/
</code></pre>
<h1 id="停止连接数据库的进程"><a href="#停止连接数据库的进程" class="headerlink" title="停止连接数据库的进程"></a>停止连接数据库的进程</h1><pre><code>sudo gitlab-ctl stop unicorn
sudo gitlab-ctl stop sidekiq
</code></pre>
<h1 id="恢复1393513186这个备份文件，将覆盖GitLab数据库！"><a href="#恢复1393513186这个备份文件，将覆盖GitLab数据库！" class="headerlink" title="恢复1393513186这个备份文件，将覆盖GitLab数据库！"></a>恢复1393513186这个备份文件，将覆盖GitLab数据库！</h1><pre><code>sudo gitlab-rake gitlab:backup:restore BACKUP=1393513186
</code></pre>
<h1 id="启动-GitLab"><a href="#启动-GitLab" class="headerlink" title="启动 GitLab"></a>启动 GitLab</h1><pre><code>sudo gitlab-ctl start
</code></pre>
<h1 id="检查-GitLab"><a href="#检查-GitLab" class="headerlink" title="检查 GitLab"></a>检查 GitLab</h1><pre><code>sudo gitlab-rake gitlab:check SANITIZE=true
</code></pre>
<h1 id="持续集成-GitLab-CI"><a href="#持续集成-GitLab-CI" class="headerlink" title="持续集成(GitLab-CI)"></a>持续集成(GitLab-CI)</h1><pre><code>GitLab 从 8.0 之后就集成了GitLab-CI，所以不需要再另外安装                    CI。但需要安装Runner
</code></pre>
<h2 id="1-添加-Runner-安装源"><a href="#1-添加-Runner-安装源" class="headerlink" title="1.添加 Runner 安装源"></a>1.添加 Runner 安装源</h2><h1 id="For-Debian-Ubuntu"><a href="#For-Debian-Ubuntu" class="headerlink" title="For Debian&#x2F;Ubuntu"></a>For Debian&#x2F;Ubuntu</h1><pre><code>curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.deb.sh | sudo bash
</code></pre>
<h3 id="For-CentOS"><a href="#For-CentOS" class="headerlink" title="For CentOS"></a>For CentOS</h3><pre><code>curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-mul    ti-runner/script.rpm.sh | sudo bash
</code></pre>
<h2 id="安装gitlab-ci-multi-runner"><a href="#安装gitlab-ci-multi-runner" class="headerlink" title="安装gitlab-ci-multi-runner"></a>安装gitlab-ci-multi-runner</h2><h3 id="For-Debian-Ubuntu-1"><a href="#For-Debian-Ubuntu-1" class="headerlink" title="For Debian&#x2F;Ubuntu"></a>For Debian&#x2F;Ubuntu</h3><pre><code>apt-get install gitlab-ci-multi-runner
</code></pre>
<h3 id="For-CentOS-1"><a href="#For-CentOS-1" class="headerlink" title="For CentOS"></a>For CentOS</h3><pre><code>yum install gitlab-ci-multi-runner
</code></pre>
<p>2.注册 Runner。获取Token：以管理员身份登录GitLab，进入管理区域，点击侧边栏的Runner，如下图，“注册授权码”后的字符串便是Token。<br>[图片]</p>
<pre><code>sudo gitlab-ci-multi-runner register

Running in system-mode.

Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/ci):
http://git.home.com/ci
Please enter the gitlab-ci token for this runner:
xxxx             # 输入Token
Please enter the gitlab-ci description for this runner:
[xxy-web-test-02]: test-runner  # 输入runner的名称
Please enter the gitlab-ci tags for this runner (comma separated):
test,php         # 输入runner的标签，以区分不同的runner，标签间逗号分隔
Registering runner... succeeded                     runner=YDPz2or3
Please enter the executor: ssh, shell, parallels, docker, docker-ssh,     virtualbox:
shell
Runner registered successfully. Feel free to start it, but if it&#39;s running     already the config should be automatically reloaded!
注册完成便可在上图中查看你所注册的Runner。至此，所有安装完毕，Runner的构建，    后续补充。
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">qiantu</p>
  <div class="site-description" itemprop="description">You think you can, you can.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qiantu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
