<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="You think you can, you can.">
<meta property="og:type" content="website">
<meta property="og:title" content="向山看海">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="向山看海">
<meta property="og:description" content="You think you can, you can.">
<meta property="og:locale">
<meta property="article:author" content="qiantu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>向山看海</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">向山看海</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-zjump">

    <a href="/zjump/" rel="section"><i class="fa fa-zjump fa-fw"></i>zjump</a>

  </li>
        <li class="menu-item menu-item-envmanage">

    <a href="/envmanage/" rel="section"><i class="fa fa-envmanage fa-fw"></i>envmanage</a>

  </li>
        <li class="menu-item menu-item-nginxadmin">

    <a href="/nginxadmin/" rel="section"><i class="fa fa-nginxadmin fa-fw"></i>nginxadmin</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-archives fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-zjump fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-about fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-books">

    <a href="/books/" rel="section"><i class="fa fa-books fa-fw"></i>books</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/Compile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/Compile/" class="post-title-link" itemprop="url">编译原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">编译原理</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->




<h1 id="编译原理"><a href="#编译原理" class="headerlink" title="编译原理"></a>编译原理</h1><p>三步：   </p>
<ol>
<li>读书：龙虎鍄，把课后的题目会做的都做一遍。  </li>
<li>自己写一个toy compiler，编译一些简单的代码，尝试理解各部分之间如何整合。 </li>
<li>看LLVM的代码，试着在上面加一些东西。<br>这样你就入门了，但要真正学好编译器仍然是要与硬件打交道的，所以尝试去大公司编译组学习吧。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/rocketmq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/rocketmq/" class="post-title-link" itemprop="url">RocketMQ-Console-Ng  how to install</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/rocketmq/" itemprop="url" rel="index"><span itemprop="name">rocketmq</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->




<h1 id="RocketMQ-Console-Ng-how-to-install"><a href="#RocketMQ-Console-Ng-how-to-install" class="headerlink" title="RocketMQ-Console-Ng  how to install"></a>RocketMQ-Console-Ng  how to install</h1><pre><code>git clone https://github.com/apache/incubator-rocketmq-externals.git
cd incubator-rocketmq-externals
cd rocketmq-console
mvn clean package -Dmaven.test.skip=true
java -jar -Drocketmq.namesrv.addr=192.168.1.24:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false rocketmq-console-ng-1.0.0.jar
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/PowerCLI%20%E6%89%B9%E9%87%8F%E5%85%8B%E9%9A%86%EF%BC%8C%E6%89%B9%E9%87%8F%E9%85%8Dip%EF%BC%8C%E6%89%B9%E9%87%8F%E9%87%8D%E5%90%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/PowerCLI%20%E6%89%B9%E9%87%8F%E5%85%8B%E9%9A%86%EF%BC%8C%E6%89%B9%E9%87%8F%E9%85%8Dip%EF%BC%8C%E6%89%B9%E9%87%8F%E9%87%8D%E5%90%AF/" class="post-title-link" itemprop="url">PowerCLI 批量克隆，批量配ip，批量重启</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PowerCLI/" itemprop="url" rel="index"><span itemprop="name">PowerCLI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<h3 id="PowerCLI-批量克隆，批量配ip，批量重启"><a href="#PowerCLI-批量克隆，批量配ip，批量重启" class="headerlink" title="PowerCLI 批量克隆，批量配ip，批量重启"></a>PowerCLI 批量克隆，批量配ip，批量重启</h3><pre><code>#          Welcome to VMware vSphere PowerCLI!
#
#Log in to a vCenter Server or ESX host:              Connect-VIServer
#To find out what commands are available, type:       Get-VICommand
#To show searchable help for all PowerCLI commands:   Get-PowerCLIHelp
#Once you&#39;ve connected, display all virtual machines: Get-VM
#If you need more help, visit the PowerCLI community: Get-PowerCLICommunity


$vc = &#39;172.17.1.2&#39;
Connect-VIServer -Server $vc -username &quot;administrator&quot; -Password &quot;12345&quot;

$vmhost=&quot;172.17.1.10&quot;
$template=&quot;172.17.2.12.tomcat_template&quot;
$datastore=&quot;datastore2 (2)&quot;
#$datastore=&quot;datastore2 (1)&quot;
#$custsysprep = Get-OSCustomizationSpec myCustSpec
$resourcepool=&quot;server1&quot;
$sourcefile=&quot;C:\powercli\vmlist1.txt&quot;
$desfile=&quot;/tmp/&quot;
$vm_list=&quot;C:\powercli\vmlist2.txt&quot;
#Copy-VMGuestFile -Source C:\powercli\vmlist1.txt -Destination /tmp/ -VM 172.17.2.101_weapon -LocalToGuest -GuestUser nbj -GuestPassword Zzjr@2016

function MyCopyFile()
&#123;
for($file=[IO.File]::OpenText($vm_list);!($file.EndOfStream);$line=$file.ReadLine() )
&#123;
    #$line;
    #New-vm -vmhost $vmhost -Name $line -Template $template -Datastore $datastore -ResourcePool $resourcepool
    #start-vm $line
    CreateEth0($line)
    Copy-VMGuestFile -Source C:\powercli\ifcfg-eth0 -Destination /etc/sysconfig/network-scripts/ -VM $line -LocalToGuest -Force -GuestUser root -GuestPassword Zzjr#2016
    Copy-VMGuestFile -Source C:\powercli\70-persistent-net.rules -Destination /etc/udev/rules.d/ -VM $line -LocalToGuest -Force -GuestUser root -GuestPassword Zzjr#2016
    #stop-vm $line
    #Copy-VMGuestFile -Source $Sourcefile -Destination 
    #Copy-VMGuestFile -Source C:\powercli\vmlist1.txt -Destination /tmp/ -VM 172.17.2.101_weapon  -GuestUser nbj -GuestPassword Zzjr@2016

&#125;
$file.Close()
&#125;

function CreateEth0($vmname)
&#123;
$str = @&quot;
DEVICE=eth0
TYPE=Ethernet
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=static
NETMASK=255.255.255.0
GATEWAY=172.17.2.1
&quot;@

$ipaddr=&quot;IPADDR=&quot;
$ip=$vmname -replace &quot;_.*$&quot;
$ip_str=$ipaddr + $ip
$str|Out-File -filepath C:\powercli\ifcfg-eth0 -Encoding ascii 
$ip_str|Out-File  -filepath C:\powercli\ifcfg-eth0 -Encoding ascii -Append
[IO.File]::ReadAllText(&quot;C:\powercli\ifcfg-eth0&quot;) -replace &quot;`r`n&quot;, &quot;`n&quot;|Out-File -filepath C:\powercli\ifcfg-eth0 -Encoding ascii
$rules=&quot;#create by qiantu&quot;
$rules|Out-File  -filepath C:\powercli\70-persistent-net.rules -Encoding ascii
&#125;


function restart()
&#123;
for($file=[IO.File]::OpenText($vm_list);!($file.EndOfStream);$line=$file.ReadLine() )
&#123;
    #$line;
    #New-vm -vmhost $vmhost -Name $line -Template $template -Datastore $datastore -ResourcePool $resourcepool
    restart-vm $line
    #stop-vm $line
    #Copy-VMGuestFile -Source $Sourcefile -Destination 
    #Copy-VMGuestFile -Source C:\powercli\vmlist1.txt -Destination /tmp/ -VM 172.17.2.101_weapon  -GuestUser nbj -GuestPassword Zzjr@2016

&#125;
$file.Close()
&#125;

restart
#MyCopyFile
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/sls_api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/sls_api/" class="post-title-link" itemprop="url">sls_api</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-06 11:04:08" itemprop="dateModified" datetime="2023-12-06T11:04:08+08:00">2023-12-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sls-api/" itemprop="url" rel="index"><span itemprop="name">sls_api</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<p><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/sls/sls1.jpg" alt="Screenshot"><br><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/sls/sls2.jpg" alt="Screenshot"><br><img src="https://raw.githubusercontent.com/xskh2007/xskh2007.github.io/master/images/sls/sls3.jpg" alt="Screenshot"> </p>
<h1 id="3分钟内api接口耗时超过200ms，且数量超过10个（不包括apiname为精品-从购物车或商品详情页下单订单确认页数据）"><a href="#3分钟内api接口耗时超过200ms，且数量超过10个（不包括apiname为精品-从购物车或商品详情页下单订单确认页数据）" class="headerlink" title="3分钟内api接口耗时超过200ms，且数量超过10个（不包括apiname为精品_从购物车或商品详情页下单订单确认页数据）"></a>3分钟内api接口耗时超过200ms，且数量超过10个（不包括apiname为精品_从购物车或商品详情页下单订单确认页数据）</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* and apiGroupName : lkmall_prod and totalLatency &gt;200 not apiName:&#x27;精品_从购物车或商品详情页下单订单确认页数据&#x27; |select apiName ,COUNT(*) as apicount ,max(totalLatency) as apimax group by apiName HAVING apicount &gt; 10</span><br></pre></td></tr></table></figure>

<h1 id="15分钟内api接口状态非200，且数量超过10个"><a href="#15分钟内api接口状态非200，且数量超过10个" class="headerlink" title="15分钟内api接口状态非200，且数量超过10个"></a>15分钟内api接口状态非200，且数量超过10个</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* and apiGroupName : lkmall_prod and not statusCode : 200  |select path ,statusCode as statusCode, COUNT(*) as apicount group by path,statusCode HAVING apicount &gt; 10</span><br></pre></td></tr></table></figure>

<h1 id="1分钟内api接口总数量超过1000个"><a href="#1分钟内api接口总数量超过1000个" class="headerlink" title="1分钟内api接口总数量超过1000个"></a>1分钟内api接口总数量超过1000个</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* and apiGroupName : lkmall_prod  |select apiName ,COUNT(*) as apicount   group by apiName HAVING apicount &gt; 1000</span><br></pre></td></tr></table></figure>

<h1 id="1分钟-接口响应超过5秒-10次-或者1分钟-接口状态-503、504、500-10次-或者1分钟-接口状态不为-200-50次"><a href="#1分钟-接口响应超过5秒-10次-或者1分钟-接口状态-503、504、500-10次-或者1分钟-接口状态不为-200-50次" class="headerlink" title="1分钟 接口响应超过5秒 10次 或者1分钟 接口状态 503、504、500 10次 或者1分钟 接口状态不为 200 50次"></a>1分钟 接口响应超过5秒 10次 或者1分钟 接口状态 503、504、500 10次 或者1分钟 接口状态不为 200 50次</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">*</span><br><span class="line">and apiGroupName : lkmall_prod |(</span><br><span class="line">select</span><br><span class="line">        path , statusCode as statusCode, COUNT(*) as apicount</span><br><span class="line">from</span><br><span class="line">        log</span><br><span class="line">group by</span><br><span class="line">        path, statusCode</span><br><span class="line">HAVING</span><br><span class="line">        apicount &gt; 50</span><br><span class="line">        and statusCode &lt;&gt; 200)</span><br><span class="line">UNION (</span><br><span class="line">select</span><br><span class="line">path , statusCode as statusCode, COUNT(*) as apicount</span><br><span class="line">from</span><br><span class="line">log</span><br><span class="line">group by</span><br><span class="line">path, statusCode</span><br><span class="line">HAVING</span><br><span class="line">apicount &gt; 10</span><br><span class="line">and statusCode in(503, 504, 500)</span><br><span class="line">UNION (</span><br><span class="line">select</span><br><span class="line">apiName , COUNT(*) as apicount , max(totalLatency) as apimax</span><br><span class="line">from</span><br><span class="line">log</span><br><span class="line">where</span><br><span class="line">totalLatency &gt;5000</span><br><span class="line">group by</span><br><span class="line">apiName</span><br><span class="line">HAVING</span><br><span class="line">apicount &gt; 10 ))</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/hadoop%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/hadoop%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">hadoop群集安装(亲测)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hadoop/" itemprop="url" rel="index"><span itemprop="name">hadoop</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->




<h4 id="基本说明"><a href="#基本说明" class="headerlink" title="基本说明"></a>基本说明</h4><p>原文地址： <a href="http://blog.csdn.net/vinsuan1993/article/details/70155112">http://blog.csdn.net/vinsuan1993/article/details/70155112</a></p>
<p>hadoop2.0已经发布了稳定版本了，增加了很多特性，比如HDFS HA、YARN等。</p>
<p>注意：apache提供的hadoop-2.2.0的安装包是在32位操作系统编译的，因为hadoop依赖一些C++的本地库，<br>所以如果在64位的操作上安装hadoop-2.2.0就需要重新在64操作系统上重新编译<br>（建议第一次安装用32位的系统，我将编译好的64位的也上传到群共享里了，如果有兴趣的可以自己编译一下）</p>
<h4 id="前期准备就不详细说了，课堂上都介绍了"><a href="#前期准备就不详细说了，课堂上都介绍了" class="headerlink" title="前期准备就不详细说了，课堂上都介绍了"></a>前期准备就不详细说了，课堂上都介绍了</h4><ul>
<li>1.修改Linux主机名</li>
<li>2.修改IP</li>
<li>3.修改主机名和IP的映射关系<br>   ######注意######如果你们公司是租用的服务器或是使用的云主机（如华为用主机、阿里云主机等）<br>   &#x2F;etc&#x2F;hosts里面要配置的是内网IP地址和主机名的映射关系    </li>
<li>4.关闭防火墙</li>
<li>5.ssh免登陆</li>
<li>6.安装JDK，配置环境变量等</li>
</ul>
<h4 id="集群规划："><a href="#集群规划：" class="headerlink" title="集群规划："></a>集群规划：</h4><pre><code> 主机名          IP                    安装的软件                                        运行的进程
 itcast01     192.168.1.201     jdk、hadoop                             NameNode、DFSZKFailoverController
 itcast02     192.168.1.202     jdk、hadoop                             NameNode、DFSZKFailoverController
 itcast03     192.168.1.203     jdk、hadoop                             ResourceManager
 itcast04     192.168.1.204     jdk、hadoop、zookeeper          DataNode、NodeManager、JournalNode、QuorumPeerMain
 itcast05     192.168.1.205     jdk、hadoop、zookeeper          DataNode、NodeManager、JournalNode、QuorumPeerMain
 itcast06     192.168.1.206     jdk、hadoop、zookeeper          DataNode、NodeManager、JournalNode、QuorumPeerMain
</code></pre>
<h4 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h4><pre><code> 在hadoop2.0中通常由两个NameNode组成，一个处于active状态，另一个处于standby状态。Active NameNode对外提供服务，而Standby NameNode则不对外提供服务，仅同步active namenode的状态，以便能够在它失败时快速进行切换。
 hadoop2.0官方提供了两种HDFS HA的解决方案，一种是NFS，另一种是QJM。这里我们使用简单的QJM。在该方案中，主备NameNode之间通过一组JournalNode同步元数据信息，一条数据只要成功写入多数JournalNode即认为写入成功。通常配置奇数个JournalNode
 这里还配置了一个zookeeper集群，用于ZKFC（DFSZKFailoverController）故障转移，当Active NameNode挂掉了，会自动切换Standby NameNode为standby状态
</code></pre>
<h4 id="安装步骤："><a href="#安装步骤：" class="headerlink" title="安装步骤："></a>安装步骤：</h4><pre><code> 1.安装配置zooekeeper集群
      1.1解压
           tar -zxvf zookeeper-3.4.5.tar.gz -C /itcast/
      1.2修改配置
           cd /itcast/zookeeper-3.4.5/conf/
           cp zoo_sample.cfg zoo.cfg
           vim zoo.cfg
           修改：dataDir=/itcast/zookeeper-3.4.5/tmp
           在最后添加：
           server.1=itcast04:2888:3888
           server.2=itcast05:2888:3888
           server.3=itcast06:2888:3888
           保存退出
           然后创建一个tmp文件夹
           mkdir /itcast/zookeeper-3.4.5/tmp
           再创建一个空文件
           touch /itcast/zookeeper-3.4.5/tmp/myid
           最后向该文件写入ID
           echo 1 &gt; /itcast/zookeeper-3.4.5/tmp/myid
      1.3将配置好的zookeeper拷贝到其他节点(首先分别在itcast05、itcast06根目录下创建一个itcast目录：mkdir /itcast)
           scp -r /itcast/zookeeper-3.4.5/ itcast05:/itcast/
           scp -r /itcast/zookeeper-3.4.5/ itcast06:/itcast/
          
           注意：修改itcast05、itcast06对应/itcast/zookeeper-3.4.5/tmp/myid内容
           itcast05：
                echo 2 &gt; /itcast/zookeeper-3.4.5/tmp/myid
           itcast06：
                echo 3 &gt; /itcast/zookeeper-3.4.5/tmp/myid

 2.安装配置hadoop集群
      2.1解压
           tar -zxvf hadoop-2.2.0.tar.gz -C /itcast/
      2.2配置HDFS（hadoop2.0所有的配置文件都在$HADOOP_HOME/etc/hadoop目录下）
           #将hadoop添加到环境变量中
           vim /etc/profile
           export JAVA_HOME=/usr/java/jdk1.7.0_55
           export HADOOP_HOME=/itcast/hadoop-2.2.0
           export PATH=$PATH:$JAVA_HOME/bin:$HADOOP_HOME/bin
          
           #hadoop2.0的配置文件全部在$HADOOP_HOME/etc/hadoop下
           cd /itcast/hadoop-2.2.0/etc/hadoop
          
           2.2.1修改hadoo-env.sh
                export JAVA_HOME=/usr/java/jdk1.7.0_55
               
           2.2.2修改core-site.xml
                &lt;configuration&gt;
                     &lt;!-- 指定hdfs的nameservice为ns1 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;fs.defaultFS&lt;/name&gt;
                          &lt;value&gt;hdfs://ns1&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 指定hadoop临时目录 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
                          &lt;value&gt;/itcast/hadoop-2.2.0/tmp&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 指定zookeeper地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;ha.zookeeper.quorum&lt;/name&gt;
                          &lt;value&gt;itcast04:2181,itcast05:2181,itcast06:2181&lt;/value&gt;
                     &lt;/property&gt;
                &lt;/configuration&gt;
               
           2.2.3修改hdfs-site.xml
                &lt;configuration&gt;
                     &lt;!--指定hdfs的nameservice为ns1，需要和core-site.xml中的保持一致 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.nameservices&lt;/name&gt;
                          &lt;value&gt;ns1&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- ns1下面有两个NameNode，分别是nn1，nn2 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.ha.namenodes.ns1&lt;/name&gt;
                          &lt;value&gt;nn1,nn2&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- nn1的RPC通信地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.namenode.rpc-address.ns1.nn1&lt;/name&gt;
                          &lt;value&gt;itcast01:9000&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- nn1的http通信地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.namenode.http-address.ns1.nn1&lt;/name&gt;
                          &lt;value&gt;itcast01:50070&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- nn2的RPC通信地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.namenode.rpc-address.ns1.nn2&lt;/name&gt;
                          &lt;value&gt;itcast02:9000&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- nn2的http通信地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.namenode.http-address.ns1.nn2&lt;/name&gt;
                          &lt;value&gt;itcast02:50070&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 指定NameNode的元数据在JournalNode上的存放位置 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt;
                          &lt;value&gt;qjournal://itcast04:8485;itcast05:8485;itcast06:8485/ns1&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 指定JournalNode在本地磁盘存放数据的位置 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.journalnode.edits.dir&lt;/name&gt;
                          &lt;value&gt;/itcast/hadoop-2.2.0/journal&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 开启NameNode失败自动切换 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt;
                          &lt;value&gt;true&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 配置失败自动切换实现方式 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.client.failover.proxy.provider.ns1&lt;/name&gt;
                          &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 配置隔离机制方法，多个机制用换行分割，即每个机制暂用一行--&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.ha.fencing.methods&lt;/name&gt;
                          &lt;value&gt;
                               sshfence
                               shell(/bin/true)
                          &lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 使用sshfence隔离机制时需要ssh免登陆 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.ha.fencing.ssh.private-key-files&lt;/name&gt;
                          &lt;value&gt;/root/.ssh/id_rsa&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 配置sshfence隔离机制超时时间 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;dfs.ha.fencing.ssh.connect-timeout&lt;/name&gt;
                          &lt;value&gt;30000&lt;/value&gt;
                     &lt;/property&gt;
                &lt;/configuration&gt;
          
           2.2.4修改mapred-site.xml
                &lt;configuration&gt;
                     &lt;!-- 指定mr框架为yarn方式 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
                          &lt;value&gt;yarn&lt;/value&gt;
                     &lt;/property&gt;
                &lt;/configuration&gt;    
          
           2.2.5修改yarn-site.xml
                &lt;configuration&gt;
                     &lt;!-- 指定resourcemanager地址 --&gt;
                     &lt;property&gt;
                          &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;
                          &lt;value&gt;itcast03&lt;/value&gt;
                     &lt;/property&gt;
                     &lt;!-- 指定nodemanager启动时加载server的方式为shuffle server --&gt;
                     &lt;property&gt;
                          &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
                          &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
                     &lt;/property&gt;
                &lt;/configuration&gt;
          
               
           2.2.6修改slaves(slaves是指定子节点的位置，因为要在itcast01上启动HDFS、在itcast03启动yarn，所以itcast01上的slaves文件指定的是datanode的位置，itcast03上的slaves文件指定的是nodemanager的位置)
                itcast04
                itcast05
                itcast06

           2.2.7配置免密码登陆
                #首先要配置itcast01到itcast02、itcast03、itcast04、itcast05、itcast06的免密码登陆
                #在itcast01上生产一对钥匙
                ssh-keygen -t rsa
                #将公钥拷贝到其他节点，包括自己
                ssh-coyp-id itcast01
                ssh-coyp-id itcast02
                ssh-coyp-id itcast03
                ssh-coyp-id itcast04
                ssh-coyp-id itcast05
                ssh-coyp-id itcast06
               
                #配置itcast03到itcast04、itcast05、itcast06的免密码登陆
                #在itcast03上生产一对钥匙
                ssh-keygen -t rsa
                #将公钥拷贝到其他节点
                ssh-coyp-id itcast04
                ssh-coyp-id itcast05
                ssh-coyp-id itcast06
               
                #注意：两个namenode之间要配置ssh免密码登陆，别忘了配置itcast02到itcast01的免登陆
                在itcast02上生产一对钥匙
                ssh-keygen -t rsa
                ssh-coyp-id -i itcast01                   
     
      2.4将配置好的hadoop拷贝到其他节点
           scp -r /itcast/ itcast02:/
           scp -r /itcast/ itcast03:/
           scp -r /itcast/hadoop-2.2.0/ root@itcast04:/itcast/
           scp -r /itcast/hadoop-2.2.0/ root@itcast05:/itcast/
           scp -r /itcast/hadoop-2.2.0/ root@itcast06:/itcast/
     
      ###注意：严格按照下面的步骤
      2.5启动zookeeper集群（分别在itcast04、itcast05、itcast06上启动zk）
           cd /itcast/zookeeper-3.4.5/bin/
           ./zkServer.sh start
           #查看状态：一个leader，两个follower
           ./zkServer.sh status
          
      2.6启动journalnode（在itcast01上启动所有journalnode，注意：是调用的hadoop-daemons.sh这个脚本，注意是复数s的那个脚本）
           cd /itcast/hadoop-2.2.0
           sbin/hadoop-daemons.sh start journalnode  先执行这个，再执行 hdfs namenode -format
           #运行jps命令检验，itcast04、itcast05、itcast06上多了JournalNode进程
     
      2.7格式化HDFS
           #在itcast01上执行命令:
           hdfs namenode -format
           #格式化后会在根据core-site.xml中的hadoop.tmp.dir配置生成个文件，这里我配置的是/itcast/hadoop-2.2.0/tmp，然后将/itcast/hadoop-2.2.0/tmp拷贝到itcast02的/itcast/hadoop-2.2.0/下。
           scp -r tmp/ itcast02:/itcast/hadoop-2.2.0/
     
      2.8格式化ZK(在itcast01上执行即可)
           hdfs zkfc -formatZK
     
      2.9启动HDFS(在itcast01上执行)
           sbin/start-dfs.sh

      2.10启动YARN(#####注意#####：是在itcast03上执行start-yarn.sh，把namenode和resourcemanager分开是因为性能问题，因为他们都要占用大量资源，所以把他们分开了，他们分开了就要分别在不同的机器上启动)
           sbin/start-yarn.sh

 到此，hadoop2.2.0配置完毕，可以统计浏览器访问:
      http://192.168.1.201:50070
      NameNode &#39;itcast01:9000&#39; (active)
      http://192.168.1.202:50070
      NameNode &#39;itcast02:9000&#39; (standby)

 验证HDFS HA
      首先向hdfs上传一个文件
      hadoop fs -put /etc/profile /profile
      hadoop fs -ls /
      然后再kill掉active的NameNode
      kill -9 &lt;pid of NN&gt;
      通过浏览器访问：http://192.168.1.202:50070
      NameNode &#39;itcast02:9000&#39; (active)
      这个时候itcast02上的NameNode变成了active
      在执行命令：
      hadoop fs -ls /
      -rw-r--r--   3 root supergroup       1926 2014-02-06 15:36 /profile
      刚才上传的文件依然存在！！！
      手动启动那个挂掉的NameNode
      sbin/hadoop-daemon.sh start namenode
      通过浏览器访问：http://192.168.1.201:50070
      NameNode &#39;itcast01:9000&#39; (standby)

 验证YARN：
      运行一下hadoop提供的demo中的WordCount程序：
      hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.2.0.jar wordcount /profile /out

 OK，大功告成！！！
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/anything/%E9%A2%86%E5%85%8B%E7%B2%BE%E9%80%89api%E6%AF%8F%E7%A7%92%E8%AF%B7%E6%B1%82%E6%95%B0(1%E5%88%86%E9%92%9F%E5%86%85%E6%9C%80%E5%A4%A7%E5%80%BC)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/anything/%E9%A2%86%E5%85%8B%E7%B2%BE%E9%80%89api%E6%AF%8F%E7%A7%92%E8%AF%B7%E6%B1%82%E6%95%B0(1%E5%88%86%E9%92%9F%E5%86%85%E6%9C%80%E5%A4%A7%E5%80%BC)/" class="post-title-link" itemprop="url">领克精选api每秒请求数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 17:51:39" itemprop="dateModified" datetime="2023-12-05T17:51:39+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sls/" itemprop="url" rel="index"><span itemprop="name">sls</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">* and apiGroupName:lkmall_prod |</span><br><span class="line">select</span><br><span class="line">  max(apicount) as maxcount,</span><br><span class="line">  substr(a1, 1, 16)</span><br><span class="line">from</span><br><span class="line">  (</span><br><span class="line">    SELECT</span><br><span class="line">      count(1) as apicount,</span><br><span class="line">      date_format(</span><br><span class="line">        date_add(</span><br><span class="line">          &#x27;hour&#x27;,</span><br><span class="line">          8,</span><br><span class="line">          date_parse (</span><br><span class="line">            split_part (requestHandleTime, &#x27;.&#x27;, 1),</span><br><span class="line">            &#x27;%Y-%m-%dT%H:%i:%s&#x27;</span><br><span class="line">          )</span><br><span class="line">        ),</span><br><span class="line">        &#x27;%Y-%m-%d %H:%i:%s&#x27;</span><br><span class="line">      ) as a1</span><br><span class="line">    from</span><br><span class="line">      log</span><br><span class="line">    GROUP by</span><br><span class="line">      split_part (requestHandleTime, &#x27;.&#x27;, 1)</span><br><span class="line">  ) as qiantu</span><br><span class="line">group by</span><br><span class="line">  substr(a1, 1, 16)</span><br></pre></td></tr></table></figure>
<h1 id="优化后显示具体path-top5"><a href="#优化后显示具体path-top5" class="headerlink" title="优化后显示具体path top5"></a>优化后显示具体path top5</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">* and apiGroupName:lkmall_prod | </span><br><span class="line">with</span><br><span class="line">  T1 AS (</span><br><span class="line">    SELECT</span><br><span class="line">      count(1) as apicount,</span><br><span class="line">      DATE_FORMAT(__time__, &#x27;%Y-%m-%d %H:%i:%s&#x27;) as apitime</span><br><span class="line">    from</span><br><span class="line">      log</span><br><span class="line">    where</span><br><span class="line">      __time__ &lt; to_unixtime(date_add(&#x27;minute&#x27;, -1, now()))  AND __time__ &gt; to_unixtime(date_add(&#x27;minute&#x27;, -2, now()))</span><br><span class="line">    GROUP by</span><br><span class="line">      DATE_FORMAT(__time__, &#x27;%Y-%m-%d %H:%i:%s&#x27;)</span><br><span class="line">  ),</span><br><span class="line">  T2 AS (</span><br><span class="line">    SELECT</span><br><span class="line">      max(T1.apicount) as maxcount</span><br><span class="line">    FROM</span><br><span class="line">      T1</span><br><span class="line">  ),</span><br><span class="line">  T3 AS (</span><br><span class="line">    SELECT</span><br><span class="line">      count(1) as apicount,</span><br><span class="line">      DATE_FORMAT(__time__, &#x27;%Y-%m-%d %H:%i:%s&#x27;) as apitime,</span><br><span class="line">      path</span><br><span class="line">    from</span><br><span class="line">      log</span><br><span class="line">    GROUP by</span><br><span class="line">      DATE_FORMAT(__time__, &#x27;%Y-%m-%d %H:%i:%s&#x27;),</span><br><span class="line">      path</span><br><span class="line">  )</span><br><span class="line">select</span><br><span class="line">  T2.maxcount,</span><br><span class="line">  T3.*</span><br><span class="line">from</span><br><span class="line">  T1</span><br><span class="line">  JOIN T2 ON T1.apicount = T2.maxcount</span><br><span class="line">  JOIN T3 ON T1.apitime = T3.apitime</span><br><span class="line">order by</span><br><span class="line">  T3.apicount desc</span><br><span class="line">limit</span><br><span class="line">  5</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/git/git_use/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/git/git_use/" class="post-title-link" itemprop="url">git crlf换行符的问题解决</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->

<h1 id="git-crlf换行符的问题解决"><a href="#git-crlf换行符的问题解决" class="headerlink" title="git crlf换行符的问题解决"></a>git crlf换行符的问题解决</h1><h2 id="git使用中遇到的换行符问题总结"><a href="#git使用中遇到的换行符问题总结" class="headerlink" title="git使用中遇到的换行符问题总结"></a>git使用中遇到的换行符问题总结</h2><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>项目组现在用git做版本控制，使用中遇到不同平台下换行符不同造成的问题，windows下的换行符为crlf，linux和MAX OS 下换行符是 lf。linux和MAX os就按说明设置为<code>core.autocrlf input</code>（貌似是默认值），windows设置为<code>core.autocrlf true</code>。可是有时候还是会遇到换行符的问题。review的时候就会发现有的commit的变化是所有行都被删除重建。</p>
<h4 id="git中设置core-autocrlf"><a href="#git中设置core-autocrlf" class="headerlink" title="git中设置core.autocrlf####"></a>git中设置core.autocrlf####</h4><p>假如你正在Windows上写程序，又或者你正在和其他人合作，他们在Windows上编程，而你却在其他系统上，在这些情况下，你可能会遇到行尾结束符问题。这是因为Windows使用回车和换行两个字符来结束一行，而Mac和Linux只使用换行一个字符。虽然这是小问题，但它会极大地扰乱跨平台协作。</p>
<p>Git可以在你提交时自动地把行结束符CRLF转换成LF，而在签出代码时把LF转换成CRLF。用<code>core.autocrlf</code>来打开此项功能，如果是在Windows系统上，把它设置成<code>true</code>，这样当签出代码时，LF会被转换成CRLF：</p>
<p>$ git config –global core.autocrlf true</p>
<p>Linux或Mac系统使用LF作为行结束符，因此你不想 Git 在签出文件时进行自动的转换；当一个以CRLF为行结束符的文件不小心被引入时你肯定想进行修正，把<code>core.autocrlf</code>设置成input来告诉 Git 在提交时把CRLF转换成LF，签出时不转换：</p>
<p>$ git config –global core.autocrlf input</p>
<p>这样会在Windows系统上的签出文件中保留CRLF，会在Mac和Linux系统上，包括仓库中保留LF。</p>
<p>如果你是Windows程序员，且正在开发仅运行在Windows上的项目，可以设置<code>false</code>取消此功能，把回车符记录在库中：</p>
<p>$ git config –global core.autocrlf false</p>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><ol>
<li>修改git设置 core.autocrlf&#x3D;input.检出时不转换，提交转换为lf，这样可以避免提交windows换行符的情况；</li>
<li>修改eclipse设置 windows&gt;General&gt; workspace  下 new text file line delimiter 选择Unix。</li>
<li>已有的项目可能已经存在换行符不同的问题需要修正一下。<br>如果当前开发有多个分支且各分支不同步，需要每个分支进行一次转换：选中项目  file&gt; convert line delimiter to &gt; Unix ，创建新的commit；<br>如果只有一个分支或多个分支处于同一节点。可以从master切换一个新分支，进行第2步的修改操作，然后commit ，将此分支合并到所有分支。</li>
<li>将修改过的分支push到gitlab，其他成员更新代码即可。<br>(ps:由于每个人系统不同或者就是git的问题，可能出现更新完代码换行符不变，这时以服务器上的代码为准重新clone一份最新代码即可)</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/git/git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/git/git/" class="post-title-link" itemprop="url">快速安装 GitLab 并汉化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->



<p>原文：  <a href="http://www.jianshu.com/p/7a0d6917e009">http://www.jianshu.com/p/7a0d6917e009</a></p>
<h1 id="快速安装-GitLab-并汉化"><a href="#快速安装-GitLab-并汉化" class="headerlink" title="快速安装 GitLab 并汉化"></a>快速安装 GitLab 并汉化</h1><p>源码安装 GitLab 步骤繁琐：需要安装依赖包，Mysql，Redis，Postfix，Ruby，Nginx……安装完毕还得一个个手动配置这些软件。源码安装容易出错，不顺利的话，一天都搞不定。源码最大的好处是私人定制，如果不做定制化，还是使用官方推荐的 omnibus packages 方式安装，网络好的话，一个小时内搞定。<br>参照官方安装文档，分别在 Ubuntu 14 和 CentOS 6 两个机器上安装，过程非常顺利，没有错误。</p>
<h1 id="在-Ubuntu-14-安装"><a href="#在-Ubuntu-14-安装" class="headerlink" title="在 Ubuntu 14 安装"></a>在 Ubuntu 14 安装</h1><p>使用国内安装源镜像，加快安装速度。修改&#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;gitlab-ce.list，添加以下行   </p>
<pre><code>deb https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/debian jessie main
</code></pre>
<h1 id="开始安装："><a href="#开始安装：" class="headerlink" title="开始安装："></a>开始安装：</h1><h1 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h1><pre><code>sudo apt-get install curl openssh-server ca-certificates postfix
</code></pre>
<h1 id="安装-GitLab-社区版"><a href="#安装-GitLab-社区版" class="headerlink" title="安装 GitLab 社区版"></a>安装 GitLab 社区版</h1><pre><code>apt-get install gitlab-ce
</code></pre>
<h1 id="初始化，初始化完自动启动-GitLab"><a href="#初始化，初始化完自动启动-GitLab" class="headerlink" title="初始化，初始化完自动启动 GitLab"></a>初始化，初始化完自动启动 GitLab</h1><pre><code>sudo gitlab-ctl reconfigure
</code></pre>
<h1 id="在-CentOS-6-安装"><a href="#在-CentOS-6-安装" class="headerlink" title="在 CentOS 6 安装"></a>在 CentOS 6 安装</h1><p>使用国内镜像安装，新建 &#x2F;etc&#x2F;yum.repos.d&#x2F;gitlab-ce.repo，添加以下内容</p>
<pre><code>[gitlab-ce]
name=gitlab-ce
baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6
repo_gpgcheck=0
gpgcheck=0
enabled=1
gpgkey=https://packages.gitlab.com/gpg.key
</code></pre>
<h1 id="安装步骤："><a href="#安装步骤：" class="headerlink" title="安装步骤："></a>安装步骤：</h1><h1 id="安装依赖包-1"><a href="#安装依赖包-1" class="headerlink" title="安装依赖包"></a>安装依赖包</h1><pre><code>sudo yum install curl openssh-server openssh-clients postfix cronie
</code></pre>
<h1 id="启动-postfix-邮件服务"><a href="#启动-postfix-邮件服务" class="headerlink" title="启动 postfix 邮件服务"></a>启动 postfix 邮件服务</h1><pre><code>sudo service postfix start
</code></pre>
<h1 id="检查-postfix"><a href="#检查-postfix" class="headerlink" title="检查 postfix"></a>检查 postfix</h1><pre><code>sudo chkconfig postfix on
</code></pre>
<h1 id="安装-GitLab-社区版-1"><a href="#安装-GitLab-社区版-1" class="headerlink" title="安装 GitLab 社区版"></a>安装 GitLab 社区版</h1><pre><code>sudo yum install gitlab-ce
</code></pre>
<h1 id="初始化-GitLab"><a href="#初始化-GitLab" class="headerlink" title="初始化 GitLab"></a>初始化 GitLab</h1><pre><code>sudo gitlab-ctl reconfigure
修改 host
</code></pre>
<p>添加访问的 host，修改&#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb的external_url</p>
<pre><code>external_url &#39;http://git.home.com&#39;
</code></pre>
<p>vi &#x2F;etc&#x2F;hosts，添加 host 映射</p>
<pre><code>127.0.0.1 git.home.com
</code></pre>
<p>每次修改&#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb，都要运行以下命令，让配置生效</p>
<pre><code>sudo gitlab-ctl reconfigure
</code></pre>
<p>配置本机的 host，如：192.168.113.59</p>
<p>git.home.com。最后，在浏览器打开网址<a href="http://git.home.com，登陆。默认管理员：">http://git.home.com，登陆。默认管理员：</a><br>用户名: root<br>密码: 5iveL!fe<br>安装中文语言包（汉化）<br>以下汉化步骤参考此篇文章，首先确认当前安装版本<br>cat &#x2F;opt&#x2F;gitlab&#x2F;embedded&#x2F;service&#x2F;gitlab-rails&#x2F;VERSION<br>当前安装版本是8.5.7，因此中文补丁需要打8.5版本。<br>克隆 GitLab 源码仓库：</p>
<h1 id="克隆-GitLab-com-仓库"><a href="#克隆-GitLab-com-仓库" class="headerlink" title="克隆 GitLab.com 仓库"></a>克隆 GitLab.com 仓库</h1><p>git clone <a href="https://gitlab.com/larryli/gitlab.git">https://gitlab.com/larryli/gitlab.git</a><br>＃或 Gitcafe.com 镜像，速度更快<br>git clone <a href="https://gitcafe.com/larryli/gitlab.git">https://gitcafe.com/larryli/gitlab.git</a><br>运行汉化补丁：</p>
<h1 id="8-5-版本的汉化补丁（8-5-stable是英文稳定版，8-5-zh是中文版，两个-diff-结果便是汉化补丁）"><a href="#8-5-版本的汉化补丁（8-5-stable是英文稳定版，8-5-zh是中文版，两个-diff-结果便是汉化补丁）" class="headerlink" title="8.5 版本的汉化补丁（8-5-stable是英文稳定版，8-5-zh是中文版，两个 diff 结果便是汉化补丁）"></a>8.5 版本的汉化补丁（8-5-stable是英文稳定版，8-5-zh是中文版，两个 diff 结果便是汉化补丁）</h1><p>sudo git diff origin&#x2F;8-5-stable..8-5-zh &gt; &#x2F;tmp&#x2F;8.5.diff</p>
<h1 id="停止-gitlab"><a href="#停止-gitlab" class="headerlink" title="停止 gitlab"></a>停止 gitlab</h1><p>sudo gitlab-ctl stop</p>
<h1 id="应用汉化补丁"><a href="#应用汉化补丁" class="headerlink" title="应用汉化补丁"></a>应用汉化补丁</h1><p>cd &#x2F;opt&#x2F;gitlab&#x2F;embedded&#x2F;service&#x2F;gitlab-rails<br>git apply &#x2F;tmp&#x2F;8.5.diff  </p>
<h1 id="启动gitlab"><a href="#启动gitlab" class="headerlink" title="启动gitlab"></a>启动gitlab</h1><p>sudo gitlab-ctl start<br>至此，汉化完毕。打开地址<a href="http://git.home.com,便会看到中文版的gitlab.如下/">http://git.home.com，便会看到中文版的GitLab。如下</a><br>[图片]</p>
<p>安装完成。<br>备份<br>如果是生产环境，备份是必须的。需要备份的文件：配置文件和数据文件。<br>备份配置文件<br>配置文件含密码等敏感信息，不要和数据备份文件放在一起。<br>sh -c ‘umask 0077; tar -cf $(date “+etc-gitlab-%s.tar”) -C &#x2F;etc&#x2F;gitlab’<br>备份数据文件<br>默认数据备份目录是&#x2F;var&#x2F;opt&#x2F;gitlab&#x2F;backups，手动创建备份文件：</p>
<h1 id="Omnibus-方式安装使用以下命令备份"><a href="#Omnibus-方式安装使用以下命令备份" class="headerlink" title="Omnibus 方式安装使用以下命令备份"></a>Omnibus 方式安装使用以下命令备份</h1><p>sudo gitlab-rake gitlab:backup:create<br>日常备份，添加 crontab，运行crontab -e</p>
<h1 id="每天2点执行备份"><a href="#每天2点执行备份" class="headerlink" title="每天2点执行备份"></a>每天2点执行备份</h1><p>0 2 * * * &#x2F;opt&#x2F;gitlab&#x2F;bin&#x2F;gitlab-rake gitlab:backup:create CRON&#x3D;1<br>如要修改备份周期和目录，在&#x2F;etc&#x2F;gitlab&#x2F;gitlab.rb中修改以下两个选项</p>
<h1 id="设置备份周期为7天-604800秒"><a href="#设置备份周期为7天-604800秒" class="headerlink" title="设置备份周期为7天 - 604800秒"></a>设置备份周期为7天 - 604800秒</h1><p>gitlab_rails[‘backup_keep_time’] &#x3D; 604800</p>
<h1 id="备份目录"><a href="#备份目录" class="headerlink" title="备份目录"></a>备份目录</h1><p>gitlab_rails[‘backup_path’] &#x3D; ‘&#x2F;mnt&#x2F;backups’<br>恢复<br>恢复之前，确保备份文件所安装 GitLab 和当前要恢复的 GitLab 版本一致。首先，恢复配置文件：<br>sudo mv &#x2F;etc&#x2F;gitlab &#x2F;etc&#x2F;gitlab.$(date +%s)</p>
<h1 id="将下面配置备份文件的时间戳改为你所备份的文件的时间戳"><a href="#将下面配置备份文件的时间戳改为你所备份的文件的时间戳" class="headerlink" title="将下面配置备份文件的时间戳改为你所备份的文件的时间戳"></a>将下面配置备份文件的时间戳改为你所备份的文件的时间戳</h1><pre><code>sudo tar -xf etc-gitlab-1399948539.tar -C /
恢复数据文件
</code></pre>
<h1 id="将数据备份文件拷贝至备份目录"><a href="#将数据备份文件拷贝至备份目录" class="headerlink" title="将数据备份文件拷贝至备份目录"></a>将数据备份文件拷贝至备份目录</h1><pre><code>sudo cp 1393513186_gitlab_backup.tar /var/opt/gitlab/backups/
</code></pre>
<h1 id="停止连接数据库的进程"><a href="#停止连接数据库的进程" class="headerlink" title="停止连接数据库的进程"></a>停止连接数据库的进程</h1><pre><code>sudo gitlab-ctl stop unicorn
sudo gitlab-ctl stop sidekiq
</code></pre>
<h1 id="恢复1393513186这个备份文件，将覆盖GitLab数据库！"><a href="#恢复1393513186这个备份文件，将覆盖GitLab数据库！" class="headerlink" title="恢复1393513186这个备份文件，将覆盖GitLab数据库！"></a>恢复1393513186这个备份文件，将覆盖GitLab数据库！</h1><pre><code>sudo gitlab-rake gitlab:backup:restore BACKUP=1393513186
</code></pre>
<h1 id="启动-GitLab"><a href="#启动-GitLab" class="headerlink" title="启动 GitLab"></a>启动 GitLab</h1><pre><code>sudo gitlab-ctl start
</code></pre>
<h1 id="检查-GitLab"><a href="#检查-GitLab" class="headerlink" title="检查 GitLab"></a>检查 GitLab</h1><pre><code>sudo gitlab-rake gitlab:check SANITIZE=true
</code></pre>
<h1 id="持续集成-GitLab-CI"><a href="#持续集成-GitLab-CI" class="headerlink" title="持续集成(GitLab-CI)"></a>持续集成(GitLab-CI)</h1><pre><code>GitLab 从 8.0 之后就集成了GitLab-CI，所以不需要再另外安装                    CI。但需要安装Runner
</code></pre>
<h2 id="1-添加-Runner-安装源"><a href="#1-添加-Runner-安装源" class="headerlink" title="1.添加 Runner 安装源"></a>1.添加 Runner 安装源</h2><h1 id="For-Debian-Ubuntu"><a href="#For-Debian-Ubuntu" class="headerlink" title="For Debian&#x2F;Ubuntu"></a>For Debian&#x2F;Ubuntu</h1><pre><code>curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.deb.sh | sudo bash
</code></pre>
<h3 id="For-CentOS"><a href="#For-CentOS" class="headerlink" title="For CentOS"></a>For CentOS</h3><pre><code>curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-mul    ti-runner/script.rpm.sh | sudo bash
</code></pre>
<h2 id="安装gitlab-ci-multi-runner"><a href="#安装gitlab-ci-multi-runner" class="headerlink" title="安装gitlab-ci-multi-runner"></a>安装gitlab-ci-multi-runner</h2><h3 id="For-Debian-Ubuntu-1"><a href="#For-Debian-Ubuntu-1" class="headerlink" title="For Debian&#x2F;Ubuntu"></a>For Debian&#x2F;Ubuntu</h3><pre><code>apt-get install gitlab-ci-multi-runner
</code></pre>
<h3 id="For-CentOS-1"><a href="#For-CentOS-1" class="headerlink" title="For CentOS"></a>For CentOS</h3><pre><code>yum install gitlab-ci-multi-runner
</code></pre>
<p>2.注册 Runner。获取Token：以管理员身份登录GitLab，进入管理区域，点击侧边栏的Runner，如下图，“注册授权码”后的字符串便是Token。<br>[图片]</p>
<pre><code>sudo gitlab-ci-multi-runner register

Running in system-mode.

Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/ci):
http://git.home.com/ci
Please enter the gitlab-ci token for this runner:
xxxx             # 输入Token
Please enter the gitlab-ci description for this runner:
[xxy-web-test-02]: test-runner  # 输入runner的名称
Please enter the gitlab-ci tags for this runner (comma separated):
test,php         # 输入runner的标签，以区分不同的runner，标签间逗号分隔
Registering runner... succeeded                     runner=YDPz2or3
Please enter the executor: ssh, shell, parallels, docker, docker-ssh,     virtualbox:
shell
Runner registered successfully. Feel free to start it, but if it&#39;s running     already the config should be automatically reloaded!
注册完成便可在上图中查看你所注册的Runner。至此，所有安装完毕，Runner的构建，    后续补充。
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/python/Python-Jenkins%20API%E4%BD%BF%E7%94%A8%20%E2%80%94%E2%80%94%20%E5%9C%A8%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%93%8D%E6%8E%A7Jenkins/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/python/Python-Jenkins%20API%E4%BD%BF%E7%94%A8%20%E2%80%94%E2%80%94%20%E5%9C%A8%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%93%8D%E6%8E%A7Jenkins/" class="post-title-link" itemprop="url">Python-Jenkins API使用 —— 在后端代码中操控Jenkins</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jenkins/" itemprop="url" rel="index"><span itemprop="name">jenkins</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->





<h4 id="Python-Jenkins-API使用-——-在后端代码中操控Jenkins"><a href="#Python-Jenkins-API使用-——-在后端代码中操控Jenkins" class="headerlink" title="Python-Jenkins API使用 —— 在后端代码中操控Jenkins"></a>Python-Jenkins API使用 —— 在后端代码中操控Jenkins</h4><p>最近在工作中需要用到在后台代码中触发Jenkins任务的构建，于是想到Jenkins是否有一些已经封装好的API类库提供，用于处理跟Jenkins相关的操作。下面就简单介绍下我的发现。</p>
<h4 id="Linux-Curl"><a href="#Linux-Curl" class="headerlink" title="Linux Curl"></a>Linux Curl</h4><p>首先找到的是Jenkins官网的wiki：<a href="https://wiki.jenkins-ci.org/display/JENKINS/Remote+access+API">https://wiki.jenkins-ci.org/display/JENKINS/Remote+access+API</a></p>
<p>在官网首页就有关于触发job的方法：</p>
<p>个人尝试了下，该方式是通过命令行直接调curl去发POST请求的方式来触发job的构建。对于用openid管理的Jenkins，需要带上参数–user USER:PASSWORD，其中的USER和PASSWORD不是你的openID登录的账号密码，而是登录后显示在Jenkins中的User Id和API Token，它们的的查看方式如下：</p>
<p>用openID登录jenkins —&gt; 点击右上角的用户名，进入用户个人页面 —&gt;  点击左边的设置，打开设置页面 —&gt; API Token，Show Api Token…</p>
<p>如果需要参数化构建job，则要加上–data-urlencode json&#x3D;’{“parameter”: [{“name”:”param_name1”,”value”:”param_value1”}, {“name”:”param_name2”,”value”:”param_value2”}]}’</p>
<p>显然，这种方式比较繁琐，很容易出现因格式不正确导致触发任务失败，而且这种方式不能帮助我们获取更多的关于job的信息以便于我们后续对job的状态进行跟踪。</p>
<h4 id="Python-Jenkins"><a href="#Python-Jenkins" class="headerlink" title="Python-Jenkins"></a>Python-Jenkins</h4><p>继续寻找，然后我在Jenkins官网上找到了Python-Jenkins API，仔细阅读后发现，它几乎涵盖了大部分Jenkins的操作，大大方便了我们在后台进行对Jenkins的一些列操作。</p>
<p>Python-Jenkins官网：<a href="https://pypi.python.org/pypi/python-jenkins/">https://pypi.python.org/pypi/python-jenkins/</a></p>
<p>Python-Jenkins Doc：<a href="http://python-jenkins.readthedocs.io/en/latest/index.html">http://python-jenkins.readthedocs.io/en/latest/index.html</a></p>
<p>下面简单介绍下如何使用Python-Jenkins：</p>
<h4 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h4><pre><code>sudo pip install python-jenkins
</code></pre>
<h4 id="2-进入python命令环境或创建新的-py文件jenkinsApiTest-py"><a href="#2-进入python命令环境或创建新的-py文件jenkinsApiTest-py" class="headerlink" title="2. 进入python命令环境或创建新的.py文件jenkinsApiTest.py"></a>2. 进入python命令环境或创建新的.py文件jenkinsApiTest.py</h4><pre><code>import jenkins
#定义远程的jenkins master server的url，以及port
jenkins_server_url=&#39;xxxx:xxxx&#39;
#定义用户的User Id 和 API Token，获取方式同上文
user_id=&#39;xxxx&#39;
api_token=&#39;xxxx&#39;
#实例化jenkins对象，连接远程的jenkins master server
server=jenkins.Jenkins(jenkins_server_url, username=user_id, password=api_token)
#构建job名为job_name的job（不带构建参数）
server.build_job(job_name)
#String参数化构建job名为job_name的job, 参数param_dict为字典形式，如：param_dict= &#123;&quot;param1&quot;：“value1”， “param2”：“value2”&#125;
server.build_job(job_name, parameters=param_dict)
#获取job名为job_name的job的相关信息
server.get_job_info(job_name)
#获取job名为job_name的job的最后次构建号
server.get_job_info(job_name)[&#39;lastBuild&#39;][&#39;number&#39;]
#获取job名为job_name的job的某次构建的执行结果状态
server.get_build_info(job_name,build_number)[&#39;result&#39;]　　
#判断job名为job_name的job的某次构建是否还在构建中
server.get_build_info(job_name,build_number)[&#39;building&#39;]
</code></pre>
<p>　　3. 更多其他的API可以参考Python-Jenkins API：<a href="http://python-jenkins.readthedocs.io/en/latest/api.html">http://python-jenkins.readthedocs.io/en/latest/api.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/python/Django%E4%B8%AD%E5%86%85%E7%BD%AE%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B61%EF%BC%8DUser%20Model/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/06/15/python/Django%E4%B8%AD%E5%86%85%E7%BD%AE%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B61%EF%BC%8DUser%20Model/" class="post-title-link" itemprop="url">Django中内置的权限控制1－User Model</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/django/" itemprop="url" rel="index"><span itemprop="name">django</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- toc -->


<h2 id="Django中内置的权限控制1－User-Model"><a href="#Django中内置的权限控制1－User-Model" class="headerlink" title="Django中内置的权限控制1－User Model"></a>Django中内置的权限控制1－User Model</h2><p>在Django的世界中，在权限管理中有内置的Authentication系统。用来管理帐户，组，和许可。还有基于cookie的用户session。这篇blog主要用来探讨这套内置的Authentication系统。</p>
<p>Django内置的权限系统包括以下三个部分：  </p>
<pre><code>用户（Users）
许可（Permissions）：用来定义一个用户（user）是否能够做某项任务（task）
组（Groups）：一种可以批量分配许可到多个用户的通用方式
</code></pre>
<p>首先需要在Django中安装这个组件：</p>
<pre><code>将&#39;django.contrib.auth&#39;和&#39;django.contrib.contenttypes&#39;放到settings.py中的INSTALLED_APPS中。（使用contenttypes的原因是auth中的Permission模型依赖于contenttypes）
执行manage.py syncdb
</code></pre>
<p>装好了就可以开始使用了；我们可以执行manage.py shell来启动脚本，对其中的一些API进行学习和使用。</p>
<p>首先最重要的开始就是User模型<br>User模型对应于一个用户，一个帐户，位于’django.contrib.auth.models’模块中。</p>
<p>User对象有两个多对多的属性分别是：groups和user_permissions：</p>
<pre><code>&gt;&gt;&gt;from django.contrib.auth.models import User
&gt;&gt;&gt;es = User.objects.create_user(&#39;esperyong&#39;,&#39;esperyong@gmail.com&#39;,&#39;123456&#39;)
&gt;&gt;&gt;es.groups
&lt;django.db.models.fields.related.ManyRelatedManager at 0x10d0642d0&gt;
&gt;&gt;&gt;es.user_permissions
&lt;django.db.models.fields.related.ManyRelatedManager at 0x10d014c50&gt;
</code></pre>
<p>从上面的代码中的后两行输出我们可以看到，User的这两个多对多属性，都是关于ManyRelatedManager的引用。因此我们可以像对所有对多关系属性一样使用：</p>
<p>直接将一个列表赋值给该属性：</p>
<pre><code>es.groups = [group_list]
es.user_permissions = [permission_list]
</code></pre>
<p>使用add方法将对象加入：</p>
<pre><code>es.groups.add(group, group, ...)
es.user_permissions.add(permission, permission, ...)
</code></pre>
<p>使用remove方法将对象删除：</p>
<pre><code>es.groups.remove(group, group, ...)
es.user_permissions.remove(permission, permission, ...)
</code></pre>
<p>使用clear方法将所有对象删除：</p>
<pre><code>es.groups.clear()
es.user_permissions.clear()
</code></pre>
<p>　　</p>
<p>User对象有以下几个属性：</p>
<pre><code>username:字符串类型。必填。30个字符以内。
first_name:字符串类型。可选。30个字符以内。
last_name:字符串类型。可选。30个字符以内。
email:可选。
password:明文密码的hash或者是某种元数据。该属性不应该直接赋值明文密码，而应该    通过set_password()方法进行赋值，在后面有详细说明TODO。
is_staff:Boolean类型。用这个来判断是否用户可以登录进入admin site。
is_active:Boolean类型。用来判断该用户是否是可用激活状态。在删除一个帐户的时候    ，可以选择将这个属性置为False，而不是真正删除。这样如果应用有外键引用到这个用    户，外键就不会被破坏。
is_superuser:Boolean类型。该属性用来表示该用户拥有所有的许可，而无需明确的赋    予给他。
last_login:datetime类型。最近一次登陆时间。
date_joined：datetime类型。创建时间。
</code></pre>
<p>除了DjangoModel对象的通用方法之外，User对象有以下特有方法：</p>
<pre><code>is_anonymous():
永远返回False.用来将User对象和AnonymousUser(未登录的匿名用户)对象作区分用的识    别方法。通常，最好用is_authenticated()方法。
is_authenticated():
永远返回True。该方法不代表该用户有任何的许可，也不代表该用户是active的，而只    是表明该用户提供了正确的username和password。
get_full_name():
返回一个字符串，是first_name和last_name中间加一个空格组成。
set_password(raw_password):
调用该方法时候传入一个明文密码，该方法会进行hash转换。该方法调用之后并不会保    存User对象。
check_password(raw_password)：
如果传入的明文密码是正确的返回True。该方法和set_password是一对，也会考虑hash    转换。
set_unusable_password()：
将用户设置为没有密码的状态。调用该方法后，check_password()方法将会永远返回fal    se。但是如果，调用set_password()方法重新设置密码后，该方法将会失效，has_usabl    e_password()也会返回True。
has_usable_password()：
在调用set_unusable_password()方法之后，该方法返回False，正常情况下返回True。
get_group_permissions(obj=None)：
返回该用户通过组所拥有的许可（字符串列表每一个代表一个许可）。obj如果指定，将    会返回关于该对象的许可，而不是模型。
get_all_permissions(obj=None):
返回该用户所拥有的所有的许可，包括通过组的和通过用户赋予的许可。
has_perm(perm,obj=None)：
如果用户有传入的perm，则返回True。perm可以是一个格式为：&#39;&lt;app     label&gt;.&lt;permission codename&gt;&#39;的字符串。如果User对象为inactive，该方法永远返回    False。和前面一样，如果传入obj，则判断该用户对于这个对象是否有这个许可。
has_perms(perm_list,obj=None):
和has_perm一样，不同的地方是第一个参数是一个perm列表，只有用户拥有传入的每一    个perm，返回值才是True。
has_module_perms(package_name)：
传入的是Django app label，按照&#39;&lt;app label&gt;.&lt;permission     codename&gt;&#39;格式。当用户拥有该app     label下面所有的perm时，返回值为True。如果用户为inactive，返回值永远为False。
email_user(subject,message,from_email=None)：
发送一封邮件给这个用户，依靠的当然是该用户的email属性。如果from_email不提供的    话，Django会使用settings中的DEFAULT_FROM_EMAIL发送。
get_profile()：
返回一个和Site相关的profile对象，用来存储额外的用户信息。这个返回值会在另一片    博文中详细描述。
</code></pre>
<p>User对象的Manager，UserManager： </p>
<p>和其他的模型一样，User模型类的objects属性也是一个Manager对象，但是User的Manager对象是自定义的，增加了一些方法：</p>
<pre><code>create_user(username,email=None,password=None):该方法创建保存一个is_active=True的User对象并返回。username不能够为空，否则抛出ValueError异常。email和password都是可选的。email的domain部分会被自动转变为小写。password如果没有提供，则User对象的set_unusable_password()方法将会被调用。
make_random_password(length=10,allowed_chars=&#39;abcdefghjkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ23456789&#39;):该方法返回一个给定长度和允许字符集的密码。其中默认的allowed_chars有一些字符没有，比如i,l等等。
</code></pre>
<h2 id="Django-admin定制化，User字段扩展-转载"><a href="#Django-admin定制化，User字段扩展-转载" class="headerlink" title="Django admin定制化，User字段扩展[转载]"></a>Django admin定制化，User字段扩展[转载]</h2><p>前言</p>
<p>参考上篇博文，我们利用了OneToOneField的方式使用了django自带的user，<a href="http://www.cnblogs.com/caseast/p/5909248.html">http://www.cnblogs.com/caseast/p/5909248.html</a> ， 但这么用有个问题，就是每次增删改查数据，因为有外键的存在都要查询两次（当然可以用select_related方式减少查询次数，参考: Django models对象的select_related方法（减少查询次数） ），另外在admin中需要维护2张表，先创建User，再在UserProfile中进行关联操作。本篇就来介绍一下，如何定制User和admin达到以下目的：1.扩展django自带的User，且不通过OneToOne的方式。2.修改User中的字段，让诸如email这种字段变为必选项（默认为可选）。3.admin表单定制，让不同权限的用户显示不同的页面。<br>期间踩了很多坑，统一做一次整理，admin可定制的地方很多，但是定制的方法肯定不如自己写的后台那么灵活，需要大体了解django的User和admin的工作模式和源码，怎么取舍还看自己的需求了。</p>
<p>代码实现</p>
<p>扩展User的方法大概有4种，参考这个国外博客：<a href="https://simpleisbetterthancomplex.com/tutorial/2016/07/22/how-to-extend-django-user-model.html#proxy">https://simpleisbetterthancomplex.com/tutorial/2016/07/22/how-to-extend-django-user-model.html#proxy</a> ，我用的是里边描述的第四种方法。<br>models.py</p>
<pre><code>from django.db import models
from django.contrib.auth.models import AbstractUser, Group
# Create your models here.

&#39;&#39;&#39; OneToOne的扩展写法,原来的写法
class UserProfile(models.Model):
    user = models.OneToOneField(User)
    name = models.CharField(u&#39;姓名&#39;, max_length=32, blank=False, null=False)

    class Meta:
        verbose_name = u&#39;用户详情&#39;
        verbose_name_plural = u&quot;用户详情&quot;
&#39;&#39;&#39;

class MyUser(AbstractUser): #     继承AbstractUser类，实际上django的User也是继承他，我们要做的就是用自己的类代    替django自己的User
    name = models.CharField(u&#39;中文名&#39;, max_length=32, blank=False,     null=False)

    class Meta:
        verbose_name = u&#39;用户详情&#39;
        verbose_name_plural = u&quot;用户详情&quot;
</code></pre>
<p>这里附上Django User类部分源码</p>
<pre><code>class User(AbstractUser):
    &quot;&quot;&quot;
    Users within the Django authentication system are represented by this     model.
    Username, password and email are required. Other fields are optional.
    &quot;&quot;&quot;
    class Meta(AbstractUser.Meta):
        swappable = &#39;AUTH_USER_MODEL&#39;
</code></pre>
<p>光做以上这些还不够，我们需要告诉django，我们不用你的User了，要用自己的，所以需要在settings.py里重新设定一个变量<br>settings.py</p>
<pre><code>AUTH_USER_MODEL = &quot;web_sso.MyUser&quot;  # 我们的app叫web_sso，这个MyUser就是models定义的那个类
</code></pre>
<p>看下扩展完的效果，可以看到，我们不用再像之前一样维护“用户”和“用户详情”两张表了，但还是有很多小问题需要解决。</p>
<p>长话短说，直接看一下，我的admin.py改了哪些东西吧.<br>admin.py</p>
<pre><code>from django.contrib import admin
from web_sso import models
from django.contrib.auth.admin import UserAdmin  # 从django继承过来后进行定制
from django.utils.translation import ugettext_lazy as _
from django.contrib.auth.forms import UserCreationForm, UserChangeForm #     admin中涉及到的两个表单


class User_exAdmin(admin.ModelAdmin):  # 验证码部分展示
    list_display = (&#39;valid_code&#39;, &#39;valid_time&#39;, &#39;email&#39;)


# custom user admin
class MyUserCreationForm(UserCreationForm):  #     增加用户表单重新定义，继承自UserCreationForm
    def __init__(self, *args, **kwargs):
        super(MyUserCreationForm, self).__init__(*args, **kwargs)
        self.fields[&#39;email&#39;].required = True   #     为了让此字段在admin中为必选项，自定义一个form
        self.fields[&#39;name&#39;].required = True  #     其实这个name字段可以不用设定required，因为在models中的MyUser类中已经设定了bla    nk=False，但email字段在系统自带User的models中已经设定为
        # email = models.EmailField(_(&#39;email address&#39;),     blank=True)，除非直接改源码的django（不建议这么做），不然还是自定义一个表单做    一下继承吧。


class MyUserChangeForm(UserChangeForm):  #     编辑用户表单重新定义，继承自UserChangeForm
    def __init__(self, *args, **kwargs):
        super(MyUserChangeForm, self).__init__(*args, **kwargs)
        self.fields[&#39;email&#39;].required = True
        self.fields[&#39;name&#39;].required = True


class CustomUserAdmin(UserAdmin):
    def __init__(self, *args, **kwargs):
        super(CustomUserAdmin, self).__init__(*args, **kwargs)
        self.list_display = (&#39;username&#39;, &#39;name&#39;, &#39;email&#39;, &#39;is_active&#39;,     &#39;is_staff&#39;, &#39;is_superuser&#39;)
        self.search_fields = (&#39;username&#39;, &#39;email&#39;, &#39;name&#39;)
        self.form = MyUserChangeForm  #  编辑用户表单，使用自定义的表单
        self.add_form = MyUserCreationForm  # 添加用户表单，使用自定义的表单
        # 以上的属性都可以在django源码的UserAdmin类中找到，我们做以覆盖

    def changelist_view(self, request, extra_context=None):  #     这个方法在源码的admin/options.py文件的ModelAdmin这个类中定义，我们要重新定义    它，以达到不同权限的用户，返回的表单内容不同
        if not request.user.is_superuser:  #     非super用户不能设定编辑是否为super用户
            self.fieldsets = ((None, &#123;&#39;fields&#39;: (&#39;username&#39;, &#39;password&#39;,)&#125;),
                              (_(&#39;Personal info&#39;), &#123;&#39;fields&#39;: (&#39;name&#39;,     &#39;email&#39;)&#125;),  # _ 将(&#39;&#39;)里的内容国际化,这样可以让admin里的文字自动随着LANGUAGE    _CODE切换中英文
                              (_(&#39;Permissions&#39;), &#123;&#39;fields&#39;: (&#39;is_active&#39;,     &#39;is_staff&#39;, &#39;groups&#39;)&#125;),
                              (_(&#39;Important dates&#39;), &#123;&#39;fields&#39;:     (&#39;last_login&#39;, &#39;date_joined&#39;)&#125;),
                              )  #     这里(&#39;Permissions&#39;)中没有&#39;is_superuser&#39;,此字段定义UserChangeForm表单中的具体    显示内容，并可以分类显示
            self.add_fieldsets = ((None, &#123;&#39;classes&#39;: (&#39;wide&#39;,),
                                          &#39;fields&#39;: (&#39;username&#39;, &#39;name&#39;,     &#39;password1&#39;, &#39;password2&#39;, &#39;email&#39;, &#39;is_active&#39;,
                                                     &#39;is_staff&#39;, &#39;groups&#39;),
                                          &#125;),
                                  )      #此字段定义UserCreationForm表单中的具体显示内容
        else:  # super账户可以做任何事
            self.fieldsets = ((None, &#123;&#39;fields&#39;: (&#39;username&#39;, &#39;password&#39;,)&#125;),
                              (_(&#39;Personal info&#39;), &#123;&#39;fields&#39;: (&#39;name&#39;,     &#39;email&#39;)&#125;),
                              (_(&#39;Permissions&#39;), &#123;&#39;fields&#39;: (&#39;is_active&#39;,     &#39;is_staff&#39;, &#39;is_superuser&#39;, &#39;groups&#39;)&#125;),
                              (_(&#39;Important dates&#39;), &#123;&#39;fields&#39;:     (&#39;last_login&#39;, &#39;date_joined&#39;)&#125;),
                              )
            self.add_fieldsets = ((None, &#123;&#39;classes&#39;: (&#39;wide&#39;,),
                                          &#39;fields&#39;: (&#39;username&#39;, &#39;name&#39;,     &#39;password1&#39;, &#39;password2&#39;, &#39;email&#39;, &#39;is_active&#39;,
                                                     &#39;is_staff&#39;,     &#39;is_superuser&#39;, &#39;groups&#39;),
                                          &#125;),
                                  )
        return super(CustomUserAdmin, self).changelist_view(request,     extra_context)


admin.site.register(models.MyUser, CustomUserAdmin)  # 注册一下
admin.site.register(models.User_ex, User_exAdmin)
</code></pre>
<p>效果展示</p>
<p>首页面</p>
<p>设定组权限管理</p>
<p>编辑用户页面<br>管理员：</p>
<p>非管理员：(没有设定超级用户的权限)</p>
<p>新增用户页面</p>
<p>通过以上，基本可以实现一个用户管理后台的需求了。</p>
<p>参考资料</p>
<p><a href="https://simpleisbetterthancomplex.com/tutorial/2016/07/22/how-to-extend-django-user-model.html#proxy">https://simpleisbetterthancomplex.com/tutorial/2016/07/22/how-to-extend-django-user-model.html#proxy</a><br><a href="http://www.cnblogs.com/daliangtou/p/5435385.html">http://www.cnblogs.com/daliangtou/p/5435385.html</a><br><a href="https://docs.djangoproject.com/en/1.9/topics/auth/customizing/#django.contrib.auth.models.PermissionsMixin.has_perms">https://docs.djangoproject.com/en/1.9/topics/auth/customizing/#django.contrib.auth.models.PermissionsMixin.has_perms</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">qiantu</p>
  <div class="site-description" itemprop="description">You think you can, you can.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qiantu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
