<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)公司机房有一台2U的服务器（64G内存，32核），由于近期新增业务比较多，测试机也要新增，服务器资源十分有限。所以打算在这台2U服务器上部署kvm虚拟化，虚出多台VM出来，以应对新的测试需求。当KVM宿主机越来越多，需要对宿主机的状态进行调控，决定采用WebVirtMgr作为kvm虚拟化的web管理工具，图形化的WEB，让人能更方便">
<meta property="og:type" content="article">
<meta property="og:title" content="kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)">
<meta property="og:url" content="http://yoursite.com/2017/06/15/cloud/cloud/index.html">
<meta property="og:site_name" content="向山看海">
<meta property="og:description" content="kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)公司机房有一台2U的服务器（64G内存，32核），由于近期新增业务比较多，测试机也要新增，服务器资源十分有限。所以打算在这台2U服务器上部署kvm虚拟化，虚出多台VM出来，以应对新的测试需求。当KVM宿主机越来越多，需要对宿主机的状态进行调控，决定采用WebVirtMgr作为kvm虚拟化的web管理工具，图形化的WEB，让人能更方便">
<meta property="og:locale">
<meta property="article:published_time" content="2017-06-15T06:17:27.000Z">
<meta property="article:modified_time" content="2023-12-05T02:19:43.390Z">
<meta property="article:author" content="qiantu">
<meta property="article:tag" content="kvm">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2017/06/15/cloud/cloud/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>kvm虚拟化管理平台WebVirtMgr部署-完整记录(1) | 向山看海</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">向山看海</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-zjump">

    <a href="/zjump/" rel="section"><i class="fa fa-zjump fa-fw"></i>zjump</a>

  </li>
        <li class="menu-item menu-item-envmanage">

    <a href="/envmanage/" rel="section"><i class="fa fa-envmanage fa-fw"></i>envmanage</a>

  </li>
        <li class="menu-item menu-item-nginxadmin">

    <a href="/nginxadmin/" rel="section"><i class="fa fa-nginxadmin fa-fw"></i>nginxadmin</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-archives fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-zjump fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-about fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-books">

    <a href="/books/" rel="section"><i class="fa fa-books fa-fw"></i>books</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/cloud/cloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="qiantu">
      <meta itemprop="description" content="You think you can, you can.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="向山看海">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 14:17:27" itemprop="dateCreated datePublished" datetime="2017-06-15T14:17:27+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-05 10:19:43" itemprop="dateModified" datetime="2023-12-05T10:19:43+08:00">2023-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kvm/" itemprop="url" rel="index"><span itemprop="name">kvm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <!-- toc -->


<h2 id="kvm虚拟化管理平台WebVirtMgr部署-完整记录-1"><a href="#kvm虚拟化管理平台WebVirtMgr部署-完整记录-1" class="headerlink" title="kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)"></a>kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)</h2><p>公司机房有一台2U的服务器（64G内存，32核），由于近期新增业务比较多，测试机也要新增，服务器资源十分有限。所以打算在这台2U服务器上部署kvm虚拟化，虚出多台VM出来，以应对新的测试需求。<br>当KVM宿主机越来越多，需要对宿主机的状态进行调控，决定采用WebVirtMgr作为kvm虚拟化的web管理工具，图形化的WEB，让人能更方便的查看kvm 宿主机的情况和操作<br>WebVirtMgr是近两年来发展较快，比较活跃，非常清新的一个KVM管理平台，提供对宿主机和虚机的统一管理，它有别于kvm自带的图形管理工具（virtual machine manager），让kvm管理变得更为可视化，对中小型kvm应用场景带来了更多方便。<br>WebVirtMgr采用几乎纯Python开发，其前端是基于Python的Django，后端是基于Libvirt的Python接口，将日常kvm的管理操作变的更加的可视化。</p>
<h2 id="WebVirtMgr特点"><a href="#WebVirtMgr特点" class="headerlink" title="WebVirtMgr特点"></a>WebVirtMgr特点</h2><p>操作简单，易于使用<br>通过libvirt的API接口对kvm进行管理<br>提供对虚拟机生命周期管理<br>WebVirtMgr 功能</p>
<h2 id="宿主机管理支持以下功能"><a href="#宿主机管理支持以下功能" class="headerlink" title="宿主机管理支持以下功能"></a>宿主机管理支持以下功能</h2><p>CPU利用率<br>内存利用率<br>网络资源池管理<br>存储资源池管理<br>虚拟机镜像<br>虚拟机克隆<br>快照管理<br>日志管理<br>虚机迁移  </p>
<h2 id="虚拟机管理支持以下功能"><a href="#虚拟机管理支持以下功能" class="headerlink" title="虚拟机管理支持以下功能"></a>虚拟机管理支持以下功能</h2><p>CPU利用率<br>内存利用率<br>光盘管理<br>关&#x2F;开&#x2F;暂停虚拟机<br>安装虚拟机<br>VNC console连接<br>创建快照  </p>
<h2 id="下面对部署过程进行记录，希望能帮助到有用到的朋友们。"><a href="#下面对部署过程进行记录，希望能帮助到有用到的朋友们。" class="headerlink" title="下面对部署过程进行记录，希望能帮助到有用到的朋友们。"></a>下面对部署过程进行记录，希望能帮助到有用到的朋友们。</h2><p>这里我将webvirtmgr服务器和kvm服务器放在同一台机器上部署的，即单机部署<br>系统：Centos 6.8<br>内存:64G<br>CPU:32核<br>ip：192.168.1.17（内网），111.101.186.163（外网）  </p>
<h2 id="一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装："><a href="#一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装：" class="headerlink" title="一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装："></a>一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装：</h2><p>kvm虚拟化管理平台WebVirtMgr部署-虚拟化环境安装-完整记录(0)  </p>
<h2 id="二、Kvm的管理工具webvirtmgr安装和使用"><a href="#二、Kvm的管理工具webvirtmgr安装和使用" class="headerlink" title="二、Kvm的管理工具webvirtmgr安装和使用"></a>二、Kvm的管理工具webvirtmgr安装和使用</h2><h3 id="1）安装支持的软件源"><a href="#1）安装支持的软件源" class="headerlink" title="1）安装支持的软件源"></a>1）安装支持的软件源</h3><p>[root@openstack ops]#yum -y install <a href="http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm">http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm</a>  </p>
<h3 id="2）安装相关软件"><a href="#2）安装相关软件" class="headerlink" title="2）安装相关软件"></a>2）安装相关软件</h3><hr>
<h2 id="如果报错说没有下面安装的某些软件，则下载http-pan-baidu-com-s-1bX3vkE-（密码：6ucs）将下载的yum-tar-gz解压后的文件替换到-etc-yum-repos-d目录下，然后执行yum-clean-all-yum-makecache"><a href="#如果报错说没有下面安装的某些软件，则下载http-pan-baidu-com-s-1bX3vkE-（密码：6ucs）将下载的yum-tar-gz解压后的文件替换到-etc-yum-repos-d目录下，然后执行yum-clean-all-yum-makecache" class="headerlink" title="如果报错说没有下面安装的某些软件，则下载http://pan.baidu.com/s/1bX3vkE （密码：6ucs）将下载的yum.tar.gz解压后的文件替换到&#x2F;etc&#x2F;yum.repos.d目录下，然后执行yum clean all &amp;&amp; yum makecache  "></a>如果报错说没有下面安装的某些软件，则下载<a href="http://pan.baidu.com/s/1bX3vkE">http://pan.baidu.com/s/1bX3vkE</a> （密码：6ucs）<br>将下载的yum.tar.gz解压后的文件替换到&#x2F;etc&#x2F;yum.repos.d目录下，然后执行yum clean all &amp;&amp; yum makecache  </h2><p>[root@openstack ops]#yum -y install git python-pip libvirt-python libxml2-python python-websockify supervisor nginx  </p>
<h3 id="3）从git-hub中下载相关的webvirtmgr代码"><a href="#3）从git-hub中下载相关的webvirtmgr代码" class="headerlink" title="3）从git-hub中下载相关的webvirtmgr代码"></a>3）从git-hub中下载相关的webvirtmgr代码</h3><p>[root@openstack ops]#cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;<br>[root@openstack src]#git clone git:&#x2F;&#x2F;github.com&#x2F;retspen&#x2F;webvirtmgr.git    （下载地址：<a href="https://pan.baidu.com/s/1pLS3kCj">https://pan.baidu.com/s/1pLS3kCj</a>      获取密码：8efm）</p>
<h3 id="4）安装webvirtmgr"><a href="#4）安装webvirtmgr" class="headerlink" title="4）安装webvirtmgr"></a>4）安装webvirtmgr</h3><p>[root@openstack src]#cd webvirtmgr&#x2F;<br>[root@openstack webvirtmgr]#pip install -r requirements.txt  </p>
<h3 id="5）安装数据库"><a href="#5）安装数据库" class="headerlink" title="5）安装数据库"></a>5）安装数据库</h3><p>[root@openstack webvirtmgr]#yum install python-sqlite2   </p>
<h3 id="6）对django进行环境配置"><a href="#6）对django进行环境配置" class="headerlink" title="6）对django进行环境配置"></a>6）对django进行环境配置</h3><p>[root@openstack webvirtmgr]#pwd<br>&#x2F;usr&#x2F;local&#x2F;src&#x2F;webvirtmgr<br>[root@openstack webvirtmgr]#.&#x2F;manage.py syncdb           &#x2F;&#x2F;默认是python执行，如下报错，换用其他版本的python  </p>
<hr>
<p>注意此处用默认的python执行上面命令，一般会报错，如下：<br>ImportError: No module named django.core.management   </p>
<h3 id="这个一般是由于python版本引起的，因为系统自带有好几个版本的python"><a href="#这个一般是由于python版本引起的，因为系统自带有好几个版本的python" class="headerlink" title="这个一般是由于python版本引起的，因为系统自带有好几个版本的python"></a>这个一般是由于python版本引起的，因为系统自带有好几个版本的python</h3><p>[root@openstack webvirtmgr]# python       &#x2F;&#x2F;按Tab键自查找<br>python python2.6<br>python2 python2.6-config python-config<br>[root@openstack webvirtmgr]# python -V<br>Python 2.6.6  </p>
<p>由此可看出，系统默认的Python版本是2.6.6<br>说明上面命令默认是python2.6执行的  </p>
<p>既然使用python2.6执行上面的命令报错，那就换用其他版本python2执行（如果当前是python3.3.0，那么就将下面的&#x2F;usr&#x2F;bin&#x2F;python2换成&#x2F;usr&#x2F;bin&#x2F;python2.6）<br>[root@openstack webvirtmgr]#&#x2F;usr&#x2F;bin&#x2F;python2 manage.py syncdb     &#x2F;&#x2F;最终发现使用python2执行这个命令就不报错了<br>…………<br>…………<br>You just installed Django’s auth system, which means you don’t have any superusers defined.<br>Would you like to create one now? (yes&#x2F;no): yes<br>Username (leave blank to use ‘root’): admin<br>Email address: <a href="mailto:&#119;&#97;&#x6e;&#103;&#x73;&#x68;&#x69;&#98;&#111;&#x40;&#x31;&#x36;&#51;&#46;&#99;&#x6f;&#x6d;">&#119;&#97;&#x6e;&#103;&#x73;&#x68;&#x69;&#98;&#111;&#x40;&#x31;&#x36;&#51;&#46;&#99;&#x6f;&#x6d;</a><br>Password:*********<br>Password (again):*********  </p>
<hr>
<p>[root@openstack webvirtmgr]#&#x2F;usr&#x2F;bin&#x2F;python2 manage.py collectstatic          &#x2F;&#x2F;生成配置文件（同样使用python2版本执行，不要使用默认的python执行）<br>WARNING:root:No local_settings file found.</p>
<p>You have requested to collect static files at the destination<br>location as specified in your settings.</p>
<p>This will overwrite existing files!<br>Are you sure you want to do this?</p>
<p>Type ‘yes’ to continue, or ‘no’ to cancel: yes<br>……….<br>……….</p>
<p>[root@openstack webvirtmgr]#&#x2F;usr&#x2F;bin&#x2F;python2 manage.py createsuperuser  &#x2F;&#x2F;添加管理员账号（同样使用python2版本执行，不要使用默认的python执行）<br>WARNING:root:No local_settings file found.<br>Username: ops                                                   &#x2F;&#x2F;这个是管理员账号，用上面的admin和这个管理员账号都可以登陆webvirtmgr的web界面管理平台<br>Email address: <a href="mailto:&#119;&#x61;&#x6e;&#103;&#x73;&#x68;&#x69;&#x62;&#x6f;&#64;&#x31;&#x36;&#51;&#x2e;&#x63;&#x6f;&#109;">&#119;&#x61;&#x6e;&#103;&#x73;&#x68;&#x69;&#x62;&#x6f;&#64;&#x31;&#x36;&#51;&#x2e;&#x63;&#x6f;&#109;</a><br>Password:<br>Password (again):<br>Superuser created successfully.</p>
<h2 id="7）拷贝web到-相关目录"><a href="#7）拷贝web到-相关目录" class="headerlink" title="7）拷贝web到 相关目录"></a>7）拷贝web到 相关目录</h2><p>[root@openstack ops]#mkdir -pv &#x2F;var&#x2F;www<br>[root@openstack ops]#cp -Rv &#x2F;usr&#x2F;local&#x2F;src&#x2F;webvirtmgr &#x2F;var&#x2F;www&#x2F;webvirtmgr</p>
<h2 id="8）设置ssh"><a href="#8）设置ssh" class="headerlink" title="8）设置ssh"></a>8）设置ssh</h2><p>[root@openstack ops]#ssh-keygen -r rsa             &#x2F;&#x2F;产生公私钥<br>[root@openstack ops]#ssh-copy-id 192.168.1.17        &#x2F;&#x2F;由于这里webvirtmgr和kvm服务部署在同一台机器，所以这里本地信任。如果kvm部署在其他机器，那么这个是它的ip<br>[root@openstack ops]#ssh 192.168.1.17 -L localhost:8000:localhost:8000 -L localhost:6080:localhost:60</p>
<h2 id="9）编辑nginx配置文件"><a href="#9）编辑nginx配置文件" class="headerlink" title="9）编辑nginx配置文件"></a>9）编辑nginx配置文件</h2><p>提前确保&#x2F;etc&#x2F;nginx&#x2F;nginx.conf文件里开启了“include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;”</p>
<p>[root@openstack ops]#vim &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;webvirtmgr.conf           &#x2F;&#x2F;添加下面内容到文件中<br>server {<br>listen 80 default_server;</p>
<p>server_name $hostname;<br>#access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;webvirtmgr_access_log;</p>
<p>location &#x2F;static&#x2F; {<br>root &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;webvirtmgr; # or &#x2F;srv instead of &#x2F;var<br>expires max;<br>}</p>
<p>location &#x2F; {<br>proxy_pass <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000</a>;<br>proxy_set_header X-Real-IP $remote_addr;<br>proxy_set_header X-Forwarded-for $proxy_add_x_forwarded_for;<br>proxy_set_header Host $host:$server_port;<br>proxy_set_header X-Forwarded-Proto $remote_addr;<br>proxy_connect_timeout 600;<br>proxy_read_timeout 600;<br>proxy_send_timeout 600;<br>client_max_body_size 1024M; # Set higher depending on your needs<br>}<br>}</p>
<p>[root@openstack ops]#mv &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf.bak</p>
<h2 id="10）启动nginx"><a href="#10）启动nginx" class="headerlink" title="10）启动nginx"></a>10）启动nginx</h2><p>[root@openstack ops]#&#x2F;etc&#x2F;init.d&#x2F;nginx restart</p>
<h2 id="11）修改防火墙规则"><a href="#11）修改防火墙规则" class="headerlink" title="11）修改防火墙规则"></a>11）修改防火墙规则</h2><p>[root@ops ~]#vim &#x2F;etc&#x2F;sysconfig&#x2F;selinux<br>……<br>SELINUX&#x3D;disabled</p>
<p>[root@ops ~]#setenforce 0<br>setenforce: SELinux is disabled<br>[root@ops ~]#getenforce<br>Disabled</p>
<p>[root@openstack ops]#&#x2F;usr&#x2F;sbin&#x2F;setsebool httpd_can_network_connect true</p>
<h2 id="12）设置-supervisor-如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问"><a href="#12）设置-supervisor-如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问" class="headerlink" title="12）设置 supervisor (如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问)"></a>12）设置 supervisor (如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问)</h2><p>[root@openstack ops]#chown -R nginx:nginx &#x2F;var&#x2F;www&#x2F;webvirtmgr</p>
<p>[root@openstack ops]#vim &#x2F;etc&#x2F;supervisord.conf     &#x2F;&#x2F;在文件末尾添加,注意将默认的python改为python2，因为上面只有用这个版本执行才不报错！<br>[program:webvirtmgr]<br>command&#x3D;&#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;manage.py run_gunicorn -c &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py                     &#x2F;&#x2F;启动8000端口<br>directory&#x3D;&#x2F;var&#x2F;www&#x2F;webvirtmgr<br>autostart&#x3D;true<br>autorestart&#x3D;true<br>logfile&#x3D;&#x2F;var&#x2F;log&#x2F;supervisor&#x2F;webvirtmgr.log<br>log_stderr&#x3D;true<br>user&#x3D;nginx</p>
<p>[program:webvirtmgr-console]<br>command&#x3D;&#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;console&#x2F;webvirtmgr-console                               &#x2F;&#x2F;启动6080端口（这是控制台vnc端口）<br>directory&#x3D;&#x2F;var&#x2F;www&#x2F;webvirtmgr<br>autostart&#x3D;true<br>autorestart&#x3D;true<br>stdout_logfile&#x3D;&#x2F;var&#x2F;log&#x2F;supervisor&#x2F;webvirtmgr-console.log<br>redirect_stderr&#x3D;true<br>user&#x3D;nginx<br>[root@openstack ops]#vim &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py    &#x2F;&#x2F;确保下面bind绑定的是本机的8000端口，这个在nginx配置中定义了，被代理的端口<br>bind &#x3D; ‘127.0.0.1:8000’</p>
<h2 id="13）设置开机启动"><a href="#13）设置开机启动" class="headerlink" title="13）设置开机启动"></a>13）设置开机启动</h2><p>[root@openstack ops]#chkconfig supervisord on<br>[root@openstack ops]#vim &#x2F;etc&#x2F;rc.local<br>&#x2F;usr&#x2F;sbin&#x2F;setsebool httpd_can_network_connect true</p>
<h2 id="14）启动进程"><a href="#14）启动进程" class="headerlink" title="14）启动进程"></a>14）启动进程</h2><p>[root@openstack ops]#&#x2F;etc&#x2F;init.d&#x2F;supervisord restart<br>15）查看进程<br>[root@openstack ops]#netstat -lnpt    &#x2F;&#x2F;即可以看到6080和8000已经启动<br>[root@openstack ops]# lsof -i:6080<br>COMMAND PID USER FD TYPE DEVICE SIZE&#x2F;OFF NODE NAME<br>python2 53476 nginx 3u IPv4 364124 0t0 TCP *:6080 (LISTEN)<br>[root@openstack ops]#lsof -i:8000</p>
<hr>
<p>一般来说，只要上面的supervisord服务启动了，8000和6080端口就起来了。<br>因为在&#x2F;etc&#x2F;supervisord.conf文件里配置了这两个端口的启动设置</p>
<h2 id="如果supervisord服务启动了，8000和6080端口还是没起来！那么就需要手动启动-etc-supervisord-conf文件里配置的这两个端口的启动命令，即：-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-manage-py-run-gunicorn-c-var-www-webvirtmgr-conf-gunicorn-conf-py-这个命令会一直在操作-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-console-webvirtmgr-console-这个命令会一直在操作-root-openstack-ops-etc-init-d-supervisord-restart-root-openstack-ops-lsof-i-8000-root-openstack-ops-lsof-i-6080"><a href="#如果supervisord服务启动了，8000和6080端口还是没起来！那么就需要手动启动-etc-supervisord-conf文件里配置的这两个端口的启动命令，即：-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-manage-py-run-gunicorn-c-var-www-webvirtmgr-conf-gunicorn-conf-py-这个命令会一直在操作-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-console-webvirtmgr-console-这个命令会一直在操作-root-openstack-ops-etc-init-d-supervisord-restart-root-openstack-ops-lsof-i-8000-root-openstack-ops-lsof-i-6080" class="headerlink" title="如果supervisord服务启动了，8000和6080端口还是没起来！那么就需要手动启动&#x2F;etc&#x2F;supervisord.conf文件里配置的这两个端口的启动命令，即：[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;manage.py run_gunicorn -c &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py       &#x2F;&#x2F;这个命令会一直在操作[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;console&#x2F;webvirtmgr-console                        &#x2F;&#x2F;这个命令会一直在操作[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;supervisord restart[root@openstack ops]# lsof -i:8000[root@openstack ops]# lsof -i:6080"></a>如果supervisord服务启动了，8000和6080端口还是没起来！<br>那么就需要手动启动&#x2F;etc&#x2F;supervisord.conf文件里配置的这两个端口的启动命令，即：<br>[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;manage.py run_gunicorn -c &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py       &#x2F;&#x2F;这个命令会一直在操作<br>[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;console&#x2F;webvirtmgr-console                        &#x2F;&#x2F;这个命令会一直在操作<br>[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;supervisord restart<br>[root@openstack ops]# lsof -i:8000<br>[root@openstack ops]# lsof -i:6080</h2><h2 id="16）web访问"><a href="#16）web访问" class="headerlink" title="16）web访问"></a>16）web访问</h2><p><a href="http://111.101.186.163/login/">http://111.101.186.163/login/</a></p>
<p>这里用超级管理员登陆，只有超级管理员登陆后才能看到“基础构架”窗口</p>
<p>普通用户登陆后，只能看到“WebVirtMgr”一个窗口</p>
<p>选择“SSH链接“，设置Label，IP，用户</p>
<p>注意：Label与IP要相同</p>
<p>打开后，有报错！看来在上面使用ssh连接的配置环节有误所致！</p>
<p>解决措施：</p>
<h2 id="1-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥"><a href="#1-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥" class="headerlink" title="1)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥"></a>1)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥</h2><p>[root@openstack ops]# cd &#x2F;home&#x2F;<br>[root@openstack home]# mkdir nginx<br>[root@openstack home]# chown nginx.nginx nginx&#x2F;<br>[root@openstack home]# chmod 700 nginx&#x2F; -R<br>[root@openstack home]# su - nginx -s &#x2F;bin&#x2F;bash<br>-bash-4.1$ ssh-keygen                             #期间输入yes后直接回车，回车<br>-bash-4.1$ touch ~&#x2F;.ssh&#x2F;config &amp;&amp; echo -e “StrictHostKeyChecking&#x3D;no\nUserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null” &gt;&gt; ~&#x2F;.ssh&#x2F;config<br>-bash-4.1$ chmod 0600 ~&#x2F;.ssh&#x2F;config</p>
<h2 id="2-在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户"><a href="#2-在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户" class="headerlink" title="2)在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户"></a>2)在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户</h2><hr>
<h2 id="如果采用其他用户，比如webvirtmgr，操作如下-root-openstack-ops-useradd-webvirtmgr-root-openstack-ops-echo-“123456”-passwd-–stdin-webvirtmgr-root-openstack-ops-groupadd-libvirt-root-openstack-ops-usermod-G-libvirt-a-webvirtmgr"><a href="#如果采用其他用户，比如webvirtmgr，操作如下-root-openstack-ops-useradd-webvirtmgr-root-openstack-ops-echo-“123456”-passwd-–stdin-webvirtmgr-root-openstack-ops-groupadd-libvirt-root-openstack-ops-usermod-G-libvirt-a-webvirtmgr" class="headerlink" title="如果采用其他用户，比如webvirtmgr，操作如下:[root@openstack ops]#useradd webvirtmgr[root@openstack ops]#echo “123456” | passwd –stdin webvirtmgr[root@openstack ops]#groupadd libvirt[root@openstack ops]#usermod -G libvirt -a webvirtmgr"></a>如果采用其他用户，比如webvirtmgr，操作如下:<br>[root@openstack ops]#useradd webvirtmgr<br>[root@openstack ops]#echo “123456” | passwd –stdin webvirtmgr<br>[root@openstack ops]#groupadd libvirt<br>[root@openstack ops]#usermod -G libvirt -a webvirtmgr</h2><h2 id="3-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）"><a href="#3-在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）" class="headerlink" title="3)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）"></a>3)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）</h2><p>[root@openstack ops]# su - nginx -s &#x2F;bin&#x2F;bash<br>-bash-4.1$ ssh-copy-id <a href="mailto:&#x72;&#x6f;&#111;&#x74;&#64;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#x31;&#x2e;&#x31;&#55;">&#x72;&#x6f;&#111;&#x74;&#64;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#56;&#46;&#x31;&#x2e;&#x31;&#55;</a><br>Warning: Permanently added ‘192.168.1.17’ (RSA) to the list of known hosts.<br><a href="mailto:&#114;&#x6f;&#x6f;&#116;&#x40;&#x31;&#57;&#50;&#46;&#49;&#x36;&#56;&#x2e;&#x31;&#46;&#x31;&#x37;">&#114;&#x6f;&#x6f;&#116;&#x40;&#x31;&#57;&#50;&#46;&#49;&#x36;&#56;&#x2e;&#x31;&#46;&#x31;&#x37;</a>‘s password: #输入192.168.1.17即本机的root账号<br>Now try logging into the machine, with “ssh ‘<a href="mailto:&#114;&#111;&#111;&#x74;&#64;&#x31;&#57;&#x32;&#x2e;&#49;&#54;&#56;&#x2e;&#x31;&#46;&#x31;&#55;">&#114;&#111;&#111;&#x74;&#64;&#x31;&#57;&#x32;&#x2e;&#49;&#54;&#56;&#x2e;&#x31;&#46;&#x31;&#55;</a>‘“, and check in:</p>
<p>.ssh&#x2F;authorized_keys</p>
<h2 id="to-make-sure-we-haven’t-added-extra-keys-that-you-weren’t-expecting"><a href="#to-make-sure-we-haven’t-added-extra-keys-that-you-weren’t-expecting" class="headerlink" title="to make sure we haven’t added extra keys that you weren’t expecting."></a>to make sure we haven’t added extra keys that you weren’t expecting.</h2><h2 id="这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下-root-openstack-ops-su-nginx-s-bin-bash-bash-4-1-ssh-copy-id-119-x65-x62-x76-105-114-116-109-103-114-64-x31-57-x32-x2e-x31-54-56-x2e-48-x2e-x32-51"><a href="#这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下-root-openstack-ops-su-nginx-s-bin-bash-bash-4-1-ssh-copy-id-119-x65-x62-x76-105-114-116-109-103-114-64-x31-57-x32-x2e-x31-54-56-x2e-48-x2e-x32-51" class="headerlink" title="这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下:[root@openstack ops]#su - nginx -s &#x2F;bin&#x2F;bash-bash-4.1$ssh-copy-id &#119;&#x65;&#x62;&#x76;&#105;&#114;&#116;&#109;&#103;&#114;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#x2e;&#48;&#x2e;&#x32;&#51;"></a>这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下:<br>[root@openstack ops]#su - nginx -s &#x2F;bin&#x2F;bash<br>-bash-4.1$ssh-copy-id <a href="mailto:&#119;&#x65;&#x62;&#x76;&#105;&#114;&#116;&#109;&#103;&#114;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#x2e;&#48;&#x2e;&#x32;&#51;">&#119;&#x65;&#x62;&#x76;&#105;&#114;&#116;&#109;&#103;&#114;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#x2e;&#48;&#x2e;&#x32;&#51;</a></h2><h2 id="4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置-libvirt-ssh授权"><a href="#4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置-libvirt-ssh授权" class="headerlink" title="4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置 libvirt ssh授权"></a>4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置 libvirt ssh授权</h2><p>[root@openstack ops]# vim &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla<br>[Remote libvirt SSH access]<br>Identity&#x3D;unix-user:root #注意这里采用的是root用户<br>Action&#x3D;org.libvirt.unix.manage<br>ResultAny&#x3D;yes<br>ResultInactive&#x3D;yes<br>ResultActive&#x3D;yes</p>
<h2 id="root-openstack-ops-chown-R-root-root-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla"><a href="#root-openstack-ops-chown-R-root-root-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla" class="headerlink" title="[root@openstack ops]# chown -R root.root &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla"></a>[root@openstack ops]# chown -R root.root &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla</h2><p>这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下:<br>[root@openstack ops]#vim &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla<br>[Remote libvirt SSH access]<br>Identity&#x3D;unix-user:webvirtmgr #这里就设定webvirtmgr用户<br>Action&#x3D;org.libvirt.unix.manage<br>ResultAny&#x3D;yes<br>ResultInactive&#x3D;yes<br>ResultActive&#x3D;yes</p>
<h2 id="root-openstack-ops-chown-R-webvirtmgr-webvirtmgr-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla"><a href="#root-openstack-ops-chown-R-webvirtmgr-webvirtmgr-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla" class="headerlink" title="[root@openstack ops]#chown -R webvirtmgr.webvirtmgr &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla"></a>[root@openstack ops]#chown -R webvirtmgr.webvirtmgr &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla</h2><h2 id="5）重启-libvirtd-服务"><a href="#5）重启-libvirtd-服务" class="headerlink" title="5）重启 libvirtd 服务"></a>5）重启 libvirtd 服务</h2><p>&#x2F;etc&#x2F;init.d&#x2F;libvirtd restart</p>
<p>这样上面报错的问题就迎仍而解了！</p>
<p>然后重新ssh方式连接就ok了，就不会有上面那个报错了~</p>
<p>但是，又出现了其他报错（如下）！尼玛～～  接续排查！</p>
<p>解决措施：</p>
<p> 在WebVirtMgr服务器本地使用ssh方式连接，在终端命令行里：</p>
<p>[root@openstack .ssh]# virsh -c qemu+ssh:&#x2F;&#x2F;103.10.86.17&#x2F;system list<br>The authenticity of host ‘103.10.86.17 (103.10.86.17)’ can’t be established.<br>RSA key fingerprint is 3d:c1:2e:70:e9:e5:1d:84:40:a2:63:82:af:e5:cc:cd.<br>Are you sure you want to continue connecting (yes&#x2F;no)? yes<br>error: End of file while reading data: Warning: Permanently added ‘103.10.86.17’ (RSA) to the list of known hosts.: Input&#x2F;output error<br>error: failed to connect to the hypervisor</p>
<p>看日志 tail &#x2F;var&#x2F;log&#x2F;secure | grep sshd 发现是我这里主动发出断开的.有可能检测到libvirtd有些问题导致的。<br>当时使用virt-manage可以查询到远程的信息.估计是sshd出现的问题把.</p>
<p>折腾一会，暂时没找到解决方案</p>
<p>决定先选用通过tcp协议进行迁移的（但是这种方式没有用ssh连接方式安全——）<br>等后面有时间了，再想办法解决上面ssh方式连接的错误吧</p>
<p>使用tcp进行对远程libvirtd进行连接访问的配置如下：</p>
<p>1）修改文件&#x2F;etc&#x2F;sysconfig&#x2F;libvirtd，用来启用tcp的端口<br>[root@openstack ops]# cat &#x2F;etc&#x2F;sysconfig&#x2F;libvirtd<br>……..<br>LLIBVIRTD_CONFIG&#x3D;&#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>LIBVIRTD_ARGS&#x3D;”–listen”</p>
<p>2)修改文件&#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>[root@openstack ops]#vim &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>listen_tls &#x3D; 0<br>listen_tcp &#x3D; 1<br>tcp_port &#x3D; “16509”<br>listen_addr &#x3D; “0.0.0.0”<br>auth_tcp &#x3D; “none”</p>
<p>3)运行 libvirtd<br>[root@openstack ops]#service libvirtd restart</p>
<p>如果没起效果(我的就没有生效，那么使用命令行.如果生效了，执行下面命令就会报错<br>[root@openstack ops]#libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf</p>
<p>4)查看运行进程<br>[root@openstack ops]# ps aux | grep libvirtd<br>root 16563 1.5 0.1 925880 7056 ? Sl 16:01 0:28 libvirtd -d -l –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf</p>
<p>5)查看端口<br>[root@openstack ops]# lsof -i:16509</p>
<p>6）在source host连接dest host远程libvirtd查看信息（也可以用公网ip）<br>[root@openstack ops]# virsh -c qemu+tcp:&#x2F;&#x2F;192.168.1.17&#x2F;system<br>Welcome to virsh, the virtualization interactive terminal.</p>
<p>Type: ‘help’ for help with commands<br>‘quit’ to quit</p>
<p>virsh #</p>
<p>成功使用tcp去访问libvirtd。</p>
<p>注意：</p>
<p>在使用tcp方式连接后，会出现连接终端的情况！</p>
<p>[root@openstack .ssh]# virsh -c qemu+tcp:&#x2F;&#x2F;192.168.1.17&#x2F;system<br>error: Cannot recv data: Connection reset by peer<br>error: failed to connect to the hypervisor</p>
<p>连接断开，重新连接便可。</p>
<p>[root@openstack ops]# ps aux | grep libvirtd<br>root 59619 0.6 0.0 1008128 22048 ? Sl 19:17 0:06 libvirtd –daemon –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf –listen<br>root 61081 0.0 0.0 103316 1004 pts&#x2F;2 S+ 19:33 0:00 grep –color libvirtd<br>[root@openstack ops]# kill -9 59619<br>[root@openstack ops]# ps aux | grep libvirtd<br>root 61083 0.0 0.0 103312 904 pts&#x2F;2 S+ 19:33 0:00 grep –color libvirtd<br>[root@openstack ops]# libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>[root@openstack ops]# ps aux | grep libvirtd<br>root 61086 13.5 0.0 418240 6576 ? Sl 19:33 0:00 libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf<br>root 61176 0.0 0.0 103312 908 pts&#x2F;2 S+ 19:33 0:00 grep –color libvirtd<br>[root@openstack ops]# virsh -c qemu+tcp:&#x2F;&#x2F;192.168.1.17&#x2F;system<br>Welcome to virsh, the virtualization interactive terminal.</p>
<p>Type: ‘help’ for help with commands<br>‘quit’ to quit</p>
<p>virsh #</p>
<p>后续发现，webvirtmgr连上后，过一会儿就会断开！</p>
<p>针对这个情况，可以可以写个定时脚本，如下：</p>
<p>[root@openstack ops]# cat &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh</p>
<p>#!&#x2F;bin&#x2F;bash<br>ps -ef | grep “libvirtd –daemon –listen”|grep -v grep|awk -F” “ ‘{print $2}’|xargs kill -9<br>&#x2F;usr&#x2F;sbin&#x2F;libvirtd –daemon –listen –config &#x2F;etc&#x2F;libvirt&#x2F;libvirtd.conf</p>
<p>[root@openstack ops]# crontab -l</p>
<ul>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 10;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 20;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 30;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 40;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li><ul>
<li>sleep 50;&#x2F;bin&#x2F;bash -x &#x2F;usr&#x2F;local&#x2F;src&#x2F;libvirtd.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p>一般如上配置后，webvirtmgr里的控制台是可以正常连接虚拟机的。</p>
<p>但如果webvirtmgr里通过控制台页面(vnc)连接虚拟机失败，可以按照下面的操作方法尝试解决：</p>
<p>kvm原来的安装方式是客户端需要安装vncviewer，才能看到安装页面，而webvirtmgr使用了novnc，页面通过websocket进行通信。</p>
<p>1）首先需要安装novnc<br>[root@openstack ops]# yum install -y novnc</p>
<p>2）防火墙打开vnc的6080端口<br>[root@openstack ops]# vim &#x2F;etc&#x2F;sysconfig&#x2F;iptables<br>…….<br>-A INPUT -p tcp -m state –state NEW -m tcp –dport 6080 -j ACCEPT<br>…….</p>
<p>[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;iptables restart</p>
<p>3）由上面可知，webvirtmgr进程通过supervisor管理。这里需要重启supervisor进程<br>[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;supervisord restart</p>
<p>这样，再次打开Webvirtmgr的控制台，发现就能连上虚拟机了！</p>
<hr>
<p>可以在webvirtmgr服务器上通过命令行尝试下连接：<br>[root@openstack ops]# novnc_server –help<br>Usage: novnc_server [–listen PORT] [–vnc VNC_HOST:PORT] [–cert CERT]</p>
<p>Starts the WebSockets proxy and a mini-webserver and<br>provides a cut-and-paste URL to go to.</p>
<p>–listen PORT Port for proxy&#x2F;webserver to listen on<br>Default: 6080<br>–vnc VNC_HOST:PORT VNC server host:port proxy target<br>Default: localhost:5900<br>–cert CERT Path to combined cert&#x2F;key file<br>Default: self.pem<br>–web WEB Path to web files (e.g. vnc.html)<br>Default: .&#x2F;</p>
<p>[root@openstack ops]# novnc_server –listen 192.168.1.17:6086           #端口在6080后的都可以用<br>Warning: could not find self.pem<br>Starting webserver and WebSockets proxy on port 192.168.1.17:6086<br>WARNING: no ‘numpy’ module, HyBi protocol will be slower<br>WebSocket server settings:</p>
<ul>
<li>Listen on 192.168.1.17:6086</li>
<li>Flash security policy server</li>
<li>Web server. Web root: &#x2F;usr&#x2F;share&#x2F;novnc</li>
<li>No SSL&#x2F;TLS support (no cert file)</li>
<li>proxying from 192.168.1.17:6086 to localhost:5900</li>
</ul>
<p>Navigate to this URL:</p>
<p><a href="http://kvm-server:192.168.1.17:6086/vnc.html?host=kvm-server&port=192.168.1.17:6086">http://kvm-server:192.168.1.17:6086/vnc.html?host=kvm-server&amp;port=192.168.1.17:6086</a></p>
<p>Press Ctrl-C to exit</p>
<hr>
<p><em><strong><strong><strong><strong><strong><strong><strong>当你发现自己的才华撑不起野心时，就请安静下来学习吧</strong></strong></strong></strong></strong></strong></strong></em></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/kvm/" rel="tag"># kvm</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/06/15/git/git_use/" rel="prev" title="git crlf换行符的问题解决">
      <i class="fa fa-chevron-left"></i> git crlf换行符的问题解决
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/06/15/cloud/k8s/" rel="next" title="Kubernetes 安装">
      Kubernetes 安装 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#kvm%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0WebVirtMgr%E9%83%A8%E7%BD%B2-%E5%AE%8C%E6%95%B4%E8%AE%B0%E5%BD%95-1"><span class="nav-number">1.</span> <span class="nav-text">kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WebVirtMgr%E7%89%B9%E7%82%B9"><span class="nav-number">2.</span> <span class="nav-text">WebVirtMgr特点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%BF%E4%B8%BB%E6%9C%BA%E7%AE%A1%E7%90%86%E6%94%AF%E6%8C%81%E4%BB%A5%E4%B8%8B%E5%8A%9F%E8%83%BD"><span class="nav-number">3.</span> <span class="nav-text">宿主机管理支持以下功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AE%A1%E7%90%86%E6%94%AF%E6%8C%81%E4%BB%A5%E4%B8%8B%E5%8A%9F%E8%83%BD"><span class="nav-number">4.</span> <span class="nav-text">虚拟机管理支持以下功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E9%9D%A2%E5%AF%B9%E9%83%A8%E7%BD%B2%E8%BF%87%E7%A8%8B%E8%BF%9B%E8%A1%8C%E8%AE%B0%E5%BD%95%EF%BC%8C%E5%B8%8C%E6%9C%9B%E8%83%BD%E5%B8%AE%E5%8A%A9%E5%88%B0%E6%9C%89%E7%94%A8%E5%88%B0%E7%9A%84%E6%9C%8B%E5%8F%8B%E4%BB%AC%E3%80%82"><span class="nav-number">5.</span> <span class="nav-text">下面对部署过程进行记录，希望能帮助到有用到的朋友们。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E9%A6%96%E5%85%88%E8%A6%81%E5%AE%89%E8%A3%85KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E7%8E%AF%E5%A2%83%EF%BC%8C%E5%8F%82%E8%80%83%E4%B8%8B%E9%9D%A2%E7%9A%84%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="nav-number">6.</span> <span class="nav-text">一、首先要安装KVM虚拟化环境，参考下面的一篇博客进行安装：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Kvm%E7%9A%84%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7webvirtmgr%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-number">7.</span> <span class="nav-text">二、Kvm的管理工具webvirtmgr安装和使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E5%AE%89%E8%A3%85%E6%94%AF%E6%8C%81%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%BA%90"><span class="nav-number">7.1.</span> <span class="nav-text">1）安装支持的软件源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6"><span class="nav-number">7.2.</span> <span class="nav-text">2）安装相关软件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E6%9E%9C%E6%8A%A5%E9%94%99%E8%AF%B4%E6%B2%A1%E6%9C%89%E4%B8%8B%E9%9D%A2%E5%AE%89%E8%A3%85%E7%9A%84%E6%9F%90%E4%BA%9B%E8%BD%AF%E4%BB%B6%EF%BC%8C%E5%88%99%E4%B8%8B%E8%BD%BDhttp-pan-baidu-com-s-1bX3vkE-%EF%BC%88%E5%AF%86%E7%A0%81%EF%BC%9A6ucs%EF%BC%89%E5%B0%86%E4%B8%8B%E8%BD%BD%E7%9A%84yum-tar-gz%E8%A7%A3%E5%8E%8B%E5%90%8E%E7%9A%84%E6%96%87%E4%BB%B6%E6%9B%BF%E6%8D%A2%E5%88%B0-etc-yum-repos-d%E7%9B%AE%E5%BD%95%E4%B8%8B%EF%BC%8C%E7%84%B6%E5%90%8E%E6%89%A7%E8%A1%8Cyum-clean-all-yum-makecache"><span class="nav-number">8.</span> <span class="nav-text">如果报错说没有下面安装的某些软件，则下载http:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1bX3vkE （密码：6ucs）将下载的yum.tar.gz解压后的文件替换到&#x2F;etc&#x2F;yum.repos.d目录下，然后执行yum clean all &amp;&amp; yum makecache  </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E4%BB%8Egit-hub%E4%B8%AD%E4%B8%8B%E8%BD%BD%E7%9B%B8%E5%85%B3%E7%9A%84webvirtmgr%E4%BB%A3%E7%A0%81"><span class="nav-number">8.1.</span> <span class="nav-text">3）从git-hub中下载相关的webvirtmgr代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%EF%BC%89%E5%AE%89%E8%A3%85webvirtmgr"><span class="nav-number">8.2.</span> <span class="nav-text">4）安装webvirtmgr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%EF%BC%89%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">8.3.</span> <span class="nav-text">5）安装数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%EF%BC%89%E5%AF%B9django%E8%BF%9B%E8%A1%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">8.4.</span> <span class="nav-text">6）对django进行环境配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%99%E4%B8%AA%E4%B8%80%E8%88%AC%E6%98%AF%E7%94%B1%E4%BA%8Epython%E7%89%88%E6%9C%AC%E5%BC%95%E8%B5%B7%E7%9A%84%EF%BC%8C%E5%9B%A0%E4%B8%BA%E7%B3%BB%E7%BB%9F%E8%87%AA%E5%B8%A6%E6%9C%89%E5%A5%BD%E5%87%A0%E4%B8%AA%E7%89%88%E6%9C%AC%E7%9A%84python"><span class="nav-number">8.5.</span> <span class="nav-text">这个一般是由于python版本引起的，因为系统自带有好几个版本的python</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7%EF%BC%89%E6%8B%B7%E8%B4%9Dweb%E5%88%B0-%E7%9B%B8%E5%85%B3%E7%9B%AE%E5%BD%95"><span class="nav-number">9.</span> <span class="nav-text">7）拷贝web到 相关目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8%EF%BC%89%E8%AE%BE%E7%BD%AEssh"><span class="nav-number">10.</span> <span class="nav-text">8）设置ssh</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9%EF%BC%89%E7%BC%96%E8%BE%91nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">11.</span> <span class="nav-text">9）编辑nginx配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10%EF%BC%89%E5%90%AF%E5%8A%A8nginx"><span class="nav-number">12.</span> <span class="nav-text">10）启动nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11%EF%BC%89%E4%BF%AE%E6%94%B9%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99"><span class="nav-number">13.</span> <span class="nav-text">11）修改防火墙规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12%EF%BC%89%E8%AE%BE%E7%BD%AE-supervisor-%E5%A6%82%E6%9E%9Ciptables%E9%98%B2%E7%81%AB%E5%A2%99%E5%BC%80%E5%90%AF%E7%9A%84%E8%AF%9D%EF%BC%8C%E5%B0%B1%E5%BF%85%E9%A1%BB%E8%A6%81%E5%BC%80%E9%80%9A80%E3%80%818000%E3%80%816080%E7%AB%AF%E5%8F%A3%E8%AE%BF%E9%97%AE"><span class="nav-number">14.</span> <span class="nav-text">12）设置 supervisor (如果iptables防火墙开启的话，就必须要开通80、8000、6080端口访问)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13%EF%BC%89%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8"><span class="nav-number">15.</span> <span class="nav-text">13）设置开机启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14%EF%BC%89%E5%90%AF%E5%8A%A8%E8%BF%9B%E7%A8%8B"><span class="nav-number">16.</span> <span class="nav-text">14）启动进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E6%9E%9Csupervisord%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E4%BA%86%EF%BC%8C8000%E5%92%8C6080%E7%AB%AF%E5%8F%A3%E8%BF%98%E6%98%AF%E6%B2%A1%E8%B5%B7%E6%9D%A5%EF%BC%81%E9%82%A3%E4%B9%88%E5%B0%B1%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E5%90%AF%E5%8A%A8-etc-supervisord-conf%E6%96%87%E4%BB%B6%E9%87%8C%E9%85%8D%E7%BD%AE%E7%9A%84%E8%BF%99%E4%B8%A4%E4%B8%AA%E7%AB%AF%E5%8F%A3%E7%9A%84%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%8D%B3%EF%BC%9A-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-manage-py-run-gunicorn-c-var-www-webvirtmgr-conf-gunicorn-conf-py-%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4%E4%BC%9A%E4%B8%80%E7%9B%B4%E5%9C%A8%E6%93%8D%E4%BD%9C-root-openstack-ops-usr-bin-python2-var-www-webvirtmgr-console-webvirtmgr-console-%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4%E4%BC%9A%E4%B8%80%E7%9B%B4%E5%9C%A8%E6%93%8D%E4%BD%9C-root-openstack-ops-etc-init-d-supervisord-restart-root-openstack-ops-lsof-i-8000-root-openstack-ops-lsof-i-6080"><span class="nav-number">17.</span> <span class="nav-text">如果supervisord服务启动了，8000和6080端口还是没起来！那么就需要手动启动&#x2F;etc&#x2F;supervisord.conf文件里配置的这两个端口的启动命令，即：[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;manage.py run_gunicorn -c &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;conf&#x2F;gunicorn.conf.py       &#x2F;&#x2F;这个命令会一直在操作[root@openstack ops]# &#x2F;usr&#x2F;bin&#x2F;python2 &#x2F;var&#x2F;www&#x2F;webvirtmgr&#x2F;console&#x2F;webvirtmgr-console                        &#x2F;&#x2F;这个命令会一直在操作[root@openstack ops]# &#x2F;etc&#x2F;init.d&#x2F;supervisord restart[root@openstack ops]# lsof -i:8000[root@openstack ops]# lsof -i:6080</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16%EF%BC%89web%E8%AE%BF%E9%97%AE"><span class="nav-number">18.</span> <span class="nav-text">16）web访问</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%9C%A8webvirtmgr%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%89%E4%B8%8A%EF%BC%88%E8%BF%99%E9%87%8Ckvm%E5%92%8CWebVirtMgr%E9%83%A8%E7%BD%B2%E5%9C%A8%E5%90%8C%E4%B8%80%E5%8F%B0%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%89%E5%88%9B%E5%BB%BAnginx%E7%94%A8%E6%88%B7%E5%AE%B6%E7%9B%AE%E5%BD%95%EF%BC%88%E9%BB%98%E8%AE%A4nginx%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85%E6%97%B6%E6%98%AF%E6%B2%A1%E6%9C%89nginx%E5%AE%B6%E7%9B%AE%E5%BD%95%E7%9A%84%EF%BC%89%EF%BC%8C%E7%94%9F%E6%88%90nginx%E7%9A%84%E5%85%AC%E7%A7%81%E9%92%A5"><span class="nav-number">19.</span> <span class="nav-text">1)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上）创建nginx用户家目录（默认nginx服务安装时是没有nginx家目录的），生成nginx的公私钥</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%9C%A8kvm%EF%BC%88%E5%AE%A2%E6%9C%8D%E7%AB%AF%EF%BC%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%EF%BC%88%E8%BF%99%E9%87%8Ckvm%E5%92%8CWebVirtMgr%E9%83%A8%E7%BD%B2%E5%9C%A8%E5%90%8C%E4%B8%80%E5%8F%B0%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%89%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7%EF%BC%8C%E8%BF%99%E9%87%8C%E9%BB%98%E8%AE%A4%E9%87%87%E7%94%A8root%E7%94%A8%E6%88%B7"><span class="nav-number">20.</span> <span class="nav-text">2)在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置用户，这里默认采用root用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E6%9E%9C%E9%87%87%E7%94%A8%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7%EF%BC%8C%E6%AF%94%E5%A6%82webvirtmgr%EF%BC%8C%E6%93%8D%E4%BD%9C%E5%A6%82%E4%B8%8B-root-openstack-ops-useradd-webvirtmgr-root-openstack-ops-echo-%E2%80%9C123456%E2%80%9D-passwd-%E2%80%93stdin-webvirtmgr-root-openstack-ops-groupadd-libvirt-root-openstack-ops-usermod-G-libvirt-a-webvirtmgr"><span class="nav-number">21.</span> <span class="nav-text">如果采用其他用户，比如webvirtmgr，操作如下:[root@openstack ops]#useradd webvirtmgr[root@openstack ops]#echo “123456” | passwd –stdin webvirtmgr[root@openstack ops]#groupadd libvirt[root@openstack ops]#usermod -G libvirt -a webvirtmgr</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%9C%A8webvirtmgr%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%89%E4%B8%8A%EF%BC%88%E8%BF%99%E9%87%8Ckvm%E5%92%8CWebVirtMgr%E9%83%A8%E7%BD%B2%E5%9C%A8%E5%90%8C%E4%B8%80%E5%8F%B0%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%89%EF%BC%8C%E5%B0%86nginx%E7%94%A8%E6%88%B7%E7%9A%84ssh-key%E4%B8%8A%E4%BC%A0%E5%88%B0kvm%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%EF%BC%88%E8%BF%99%E9%87%8Ckvm%E5%92%8CWebVirtMgr%E9%83%A8%E7%BD%B2%E5%9C%A8%E5%90%8C%E4%B8%80%E5%8F%B0%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%89"><span class="nav-number">22.</span> <span class="nav-text">3)在webvirtmgr服务器（服务端）上（这里kvm和WebVirtMgr部署在同一台机器上），将nginx用户的ssh-key上传到kvm服务器上（这里kvm和WebVirtMgr部署在同一台机器上）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#to-make-sure-we-haven%E2%80%99t-added-extra-keys-that-you-weren%E2%80%99t-expecting"><span class="nav-number">23.</span> <span class="nav-text">to make sure we haven’t added extra keys that you weren’t expecting.</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%99%E9%87%8C%E9%87%87%E7%94%A8%E7%9A%84%E6%98%AFroot%E7%94%A8%E6%88%B7%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%87%87%E7%94%A8%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7%EF%BC%8C%E6%AF%94%E5%A6%82%E4%B8%8A%E9%9D%A2%E5%81%87%E8%AE%BE%E7%9A%84webvirtmgr%E7%94%A8%E6%88%B7%EF%BC%8C%E6%93%8D%E4%BD%9C%E5%A6%82%E4%B8%8B-root-openstack-ops-su-nginx-s-bin-bash-bash-4-1-ssh-copy-id-119-x65-x62-x76-105-114-116-109-103-114-64-x31-57-x32-x2e-x31-54-56-x2e-48-x2e-x32-51"><span class="nav-number">24.</span> <span class="nav-text">这里采用的是root用户，如果采用其他用户，比如上面假设的webvirtmgr用户，操作如下:[root@openstack ops]#su - nginx -s &#x2F;bin&#x2F;bash-bash-4.1$ssh-copy-id webvirtmgr@192.168.0.23</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%EF%BC%89%E5%9C%A8kvm%EF%BC%88%E5%AE%A2%E6%9C%8D%E7%AB%AF%EF%BC%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%EF%BC%88%E8%BF%99%E9%87%8Ckvm%E5%92%8CWebVirtMgr%E9%83%A8%E7%BD%B2%E5%9C%A8%E5%90%8C%E4%B8%80%E5%8F%B0%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%89%E9%85%8D%E7%BD%AE-libvirt-ssh%E6%8E%88%E6%9D%83"><span class="nav-number">25.</span> <span class="nav-text">4）在kvm（客服端）服务器上（这里kvm和WebVirtMgr部署在同一台机器上）配置 libvirt ssh授权</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#root-openstack-ops-chown-R-root-root-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla"><span class="nav-number">26.</span> <span class="nav-text">[root@openstack ops]# chown -R root.root &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#root-openstack-ops-chown-R-webvirtmgr-webvirtmgr-etc-polkit-1-localauthority-50-local-d-50-libvirt-remote-access-pkla"><span class="nav-number">27.</span> <span class="nav-text">[root@openstack ops]#chown -R webvirtmgr.webvirtmgr &#x2F;etc&#x2F;polkit-1&#x2F;localauthority&#x2F;50-local.d&#x2F;50-libvirt-remote-access.pkla</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%EF%BC%89%E9%87%8D%E5%90%AF-libvirtd-%E6%9C%8D%E5%8A%A1"><span class="nav-number">28.</span> <span class="nav-text">5）重启 libvirtd 服务</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">qiantu</p>
  <div class="site-description" itemprop="description">You think you can, you can.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qiantu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
